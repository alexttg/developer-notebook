import openai
import streamlit as st

# è®¾ç½® Streamlit çš„é¡µé¢æ ‡é¢˜å’Œå›¾æ ‡
st.set_page_config(page_title="OpenAI é—®ç­”æœºå™¨äºº", page_icon=":robot_face:")

# è®¾ç½®åº”ç”¨çš„æ ‡é¢˜å’Œå­æ ‡é¢˜
st.title("OpenAI é—®ç­”æœºå™¨äºº :robot_face:")
st.subheader("ä½¿ç”¨ OpenAI API è¿›è¡Œæ™ºèƒ½é—®ç­”ï¼ğŸ˜„")

# ä½¿ç”¨å•é€‰æŒ‰é’®è¯¢é—®ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰ OpenAI API çš„å¯†é’¥
has_key = st.radio(label="æ‚¨æ˜¯å¦æ‹¥æœ‰ä»»ä½• OpenAI API å¯†é’¥ï¼Ÿ", options=["æ²¡æœ‰", "æœ‰"])

if has_key == "æœ‰":
    # åˆ›å»º OpenAI API å¯†é’¥çš„è¾“å…¥æ¡†
    openai_key = st.text_input("è¯·è¾“å…¥æ‚¨çš„ OpenAI API å¯†é’¥:", key="openai_key")
    # è®¾ç½® OpenAI API å¯†é’¥
    openai.api_key = openai_key
else:
    # è®¾ç½®é»˜è®¤çš„ OpenAI API å¯†é’¥
    openai.api_key = "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"

# åˆ›å»ºç”¨æˆ·é—®é¢˜çš„è¾“å…¥æ¡†
user_input = st.text_input("è¯·è¾“å…¥æ‚¨çš„é—®é¢˜:", key="input")

# å¦‚æœç”¨æˆ·å•å‡»â€œè¯¢é—®â€æŒ‰é’®ï¼Œåˆ™ç”Ÿæˆå¹¶æ˜¾ç¤ºç­”æ¡ˆ
if st.button("è¯¢é—®", key="ask_button"):
    st.markdown("---")
    res_box = st.empty()
    report = []
    # å¾ªç¯å“åº”
    for completions in openai.Completion.create(model='text-davinci-003',
                                               prompt=user_input,
                                               max_tokens=4000,
                                               temperature=0.5,
                                               stream=True):
        report.append(completions.choices[0].text)
        res_box.markdown(f'{"".join(report).strip()}')
    st.markdown("---")

# æ·»åŠ å…³äºä¿¡æ¯ä»¥åŠåˆ° OpenAI API æ–‡æ¡£çš„é“¾æ¥
st.subheader("å…³äº")
st.write("æœ¬åº”ç”¨ç¨‹åºä½¿ç”¨ OpenAI API ç”Ÿæˆç”¨æˆ·é—®é¢˜çš„ç­”æ¡ˆã€‚")
st.write("æ›´å¤šä¿¡æ¯ï¼Œè¯¦è§ [OpenAI API æ–‡æ¡£](https://beta.openai.com/docs/api-reference) ã€‚")

# æ·»åŠ é¡µè„šä¿¡æ¯
st.markdown("---")
st.write("ç”± klsjun åˆ›ä½œ", "https://github.com/klsjun")


å¸®æˆ‘æŠŠä¸Šé¢çš„ä»£ç é£æ ¼å’Œæ ·å¼å˜åŒ–ä¸€ä¸‹ï¼Œå˜å¾—æ›´åŠ å¥½çœ‹å’Œå®Œå–„ï¼Œæœ€å¥½å’Œä»¥å‰æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œä½†æ˜¯åŠŸèƒ½å’Œä½¿ç”¨ä¸Šæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«