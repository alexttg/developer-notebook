{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\u5173\u4e8e\u6211","text":""},{"location":"#_1","title":"\u23f0\u5173\u4e8e\u6211","text":""},{"location":"#_2","title":"\u4e2a\u4eba\u7b80\u4ecb","text":"\ud83d\udcd6 \u5b66\u4e60   \u957f\u6c99      <p>\u8ba1\u7b97\u673a\u5e94\u7528\u6280\u672f \u00b7 \u672c\u79d1</p> \ud83d\udc68\u200d\ud83d\udcbb \u5de5\u4f5c  \u5e7f\u5dde to  \u957f\u6c99    <p>\u670d\u52a1\u7aef\u5f00\u53d1</p> \ud83d\udce5 \u90ae\u7bb1    tz1353685716@gmail.com"},{"location":"#python","title":"Python\u6280\u672f","text":"<p>Python \u57fa\u7840</p> <p>\u719f\u6089 Python \u7684\u57fa\u672c\u8bed\u6cd5\u548c\u8bed\u6cd5\u7ed3\u6784\u3002 \u719f\u6089 Python \u7684\u6838\u5fc3\u6570\u636e\u7c7b\u578b\uff0c\u4e86\u89e3<code>Virtualenv</code>\u3001<code>Conda</code> \u7b49 \u73af\u5883\u7ba1\u7406\u5de5\u5177 \u719f\u6089 Python \u7684 i/o \u64cd\u4f5c module \uff08os\u3001shutil\u3001io\u3001\u4ee5\u53ca os.path\uff09\u7684\u7528\u6cd5\u548c\u67b6\u6784\u8bbe\u8ba1\u3002</p> <p>Python Web \u5f00\u53d1</p> <p>\u719f\u6089 Flask \u6216 Django \u7b49 web \u6846\u67b6\u7684\u57fa\u672c\u7528\u6cd5\u548c\u67b6\u6784\u8bbe\u8ba1 \u719f\u6089 web \u5f00\u53d1\u7684\u76f8\u5173\u6280\u672f\uff08RESTful API\u3001HTTP \u534f\u8bae\u3001WebSocket\u3001JSON\u3001XML\uff09\u3002</p> <p>Python \u81ea\u52a8\u5316</p> <p>\u719f\u6089 Python \u81ea\u52a8\u5316\u4efb\u52a1\u7684\u4e3b\u8981\u5e94\u7528\uff0c\u5982\u6279\u91cf\u5904\u7406\u6587\u4ef6 <code>openpyxl</code>\u5e93\u4f7f\u7528 \u719f\u6089\u5e38\u7528\u722c\u866b\u5e93\uff0c<code>Requests</code>\u3001<code>BeautifulSoup</code> \u7b49\uff0c\u5e76\u6709\u8fc7\u5b9e\u9645\u6587\u7ae0\u3001\u89c6\u9891\u722c\u866b\u5f00\u53d1\u7ecf\u9a8c</p>"},{"location":"#java","title":"Java \u6280\u672f","text":"<p>Java \u57fa\u7840</p> <ul> <li>\u5bf9\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u6709\u6df1\u5165\u7406\u89e3</li> <li>\u719f\u7ec3\u638c\u63e1 Java \u96c6\u5408\u3001IO\u3001\u5f02\u5e38\u3001\u53cd\u5c04\u3001\u81ea\u5b9a\u4e49\u6ce8\u89e3\u7b49</li> <li>\u719f\u6089 \u5e38\u89c1\u96c6\u5408\u539f\u7406\u3002</li> </ul> <p>Java \u591a\u7ebf\u7a0b\uff1a\u5e76\u53d1\u7f16\u7a0b</p> <ul> <li>\u719f\u6089 synchronized \u539f\u7406 volatile \u539f\u7406\u3001ThreadLocal \u539f\u7406\u3001Atomic \u539f\u5b50\u7c7b\u3001AQS\u3001CAS \u9501\u539f\u7406</li> <li>\u719f\u6089 \u5e38\u7528\u5e76\u53d1\u7c7b\u5e93 Semaphore / CountDownLatch / CyclicBarrie \u539f\u7406\u3002</li> <li>\u719f\u6089 \u7ebf\u7a0b\u6c60\u7684\u4f7f\u7528\u548c\u53c2\u6570\u8c03\u6574\u3002</li> </ul> <p>JVM \u6838\u5fc3\u77e5\u8bc6</p> <ul> <li> <p>\u719f\u6089 Java\u5185\u5b58\u533a\u57df\u3001\u7c7b\u52a0\u8f7d\u5668\u3001\u5b57\u8282\u7801\u3001\u865a\u62df\u673a\u5783\u573e\u6536\u96c6\u7b97\u6cd5\u3001\u865a\u62df\u5783\u573e\u6536\u96c6\u5668</p> </li> <li> <p>\u5b9e\u9645\u5904\u7406 \u751f\u4ea7\u73af\u5883\u4e0b\u6392\u67e5 CPU \u98d9\u9ad8\u3001\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\u3002</p> </li> </ul> <p>JavaWeb \u5f00\u53d1</p> <ul> <li>\u719f\u6089 Tomcat\u3001Servlet\u3001Cookies\u3001Session\u3001Filter\u3001JSP \u77e5\u8bc6</li> <li>\u719f\u6089 Ajax\u3001JSON\u3001XML \u7b49\u5e38\u89c1 Web \u76f8\u5173\u6280\u672f</li> </ul>"},{"location":"#_3","title":"\u6d41\u884c\u6846\u67b6 / \u4e2d\u95f4\u4ef6","text":"<p>Spring \u751f\u6001\u7cfb\u6846\u67b6</p> <ul> <li>\u719f\u7ec3 Spring\u3001SpringMVC\u3001SpringBoot \u5f00\u53d1\uff0c\u5e76\u5bf9\u5176\u6838\u5fc3\u539f\u7406 / \u6e90\u7801\u6709\u4e00\u5b9a\u7684\u4e86\u89e3</li> <li>\u4e86\u89e3/\u719f\u6089 SpringCloud / Alibaba \u6280\u672f\u6808\uff08\u4f7f\u7528\u7ecf\u9a8c\uff0c\u4f46\u975e\u76ee\u524d\u535a\u4e3b\u6240\u5c5e\u516c\u53f8\u4e3b\u529b\u6280\u672f\u6808\uff09</li> <li>\u4e86\u89e3 SpringSecurity\u3001Shiro \u7b49\u8ba4\u8bc1\u6388\u6743\u6846\u67b6\uff08\u4f7f\u7528\u7ecf\u9a8c\uff09</li> </ul> <p>RPC \u6846\u67b6</p> <ul> <li>\u719f\u6089 Dubbo \u7684\u8bed\u6cd5\u3001\u914d\u7f6e\u3001\u8c03\u7528\u65b9\u5f0f\u3002</li> </ul> <p>ORM \u6846\u67b6</p> <ul> <li>\u719f\u7ec3 MyBatis\u3001MybatisPlus</li> <li>\u4e86\u89e3 JPA</li> </ul> <p>\u6d88\u606f\u4e2d\u95f4\u4ef6</p> <ul> <li>\u719f\u6089 RabbitMQ\u3001RocketMQ \u7684\u8bed\u6cd5\u548c\u4f7f\u7528\uff0c\u5177\u6709\u4e2d\u5927\u578b\u9879\u76ee\u4f7f\u7528\u548c\u914d\u7f6e\u7ecf\u9a8c</li> <li>\u4e86\u89e3 Kafka \u7684\u57fa\u672c\u6982\u5ff5\u548c\u4f7f\u7528</li> </ul> <p>\u7f13\u5b58\u4e2d\u95f4\u4ef6</p> <ul> <li>\u719f\u6089 Redis \u8bed\u6cd5\u548c\u4f7f\u7528\u4e86\uff0c\u5177\u6709\u5927\u91cf\u4f7f\u7528\u7ecf\u9a8c</li> <li>\u5177\u6709 Lua \u811a\u672c + Redis \u7684\u5f00\u53d1\u7ecf\u9a8c</li> </ul> <p>\u641c\u7d22\u4e2d\u95f4\u4ef6</p> <ul> <li>\u719f\u6089 ELasticSearch\u8bed\u6cd5\uff0c\u5177\u6709 JAVA \u4e0e Python \u96c6\u6210\u7ecf\u9a8c\u3002</li> <li>\u5177\u6709 painless \u811a\u672c + ELasticSearch\u7684\u5f00\u53d1\u7ecf\u9a8c</li> <li>ELasticSearch + Grafana \u6570\u636e\u53ef\u89c6\u5316\u96c6\u6210\u7ecf\u9a8c</li> </ul> <p>\u6570\u636e\u5e93</p> <p>MySQL</p> <ul> <li>\u719f\u6089 \u5173\u7cfb\u578b\u6570\u636e\u5e93 MySQL \u6570\u636e\u5e93\u5f00\u53d1\uff0c\u80fd\u591f\u719f\u7ec3\u7f16\u5199\u5e38\u7528 SQL \u8bed\u53e5</li> <li>\u719f\u6089 MySQL \u5e38\u89c1\u4f18\u5316\u624b\u6bb5\uff08\u7d22\u5f15\u3001SQL\u4f18\u5316\u3001\u5206\u5e93\u5206\u8868\uff09</li> <li>\u719f\u6089 MySQL \u6838\u5fc3\u539f\u7406\uff08\u67b6\u6784\u3001\u5b58\u50a8\u3001\u5f15\u64ce\u7b49\uff09</li> </ul> <p> <p></p>"},{"location":"Arthas/","title":"Arthas\u4f7f\u7528","text":"<p>Arthas \u662f\u4e00\u6b3e\u7ebf\u4e0a\u76d1\u63a7\u8bca\u65ad\u4ea7\u54c1\uff0c\u901a\u8fc7\u5168\u5c40\u89c6\u89d2\u5b9e\u65f6\u67e5\u770b\u5e94\u7528 load\u3001\u5185\u5b58\u3001gc\u3001\u7ebf\u7a0b\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u5e76\u80fd\u5728\u4e0d\u4fee\u6539\u5e94\u7528\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u4e1a\u52a1\u95ee\u9898\u8fdb\u884c\u8bca\u65ad\uff0c\u5305\u62ec\u67e5\u770b\u65b9\u6cd5\u8c03\u7528\u7684\u51fa\u5165\u53c2\u3001\u5f02\u5e38\uff0c\u76d1\u6d4b\u65b9\u6cd5\u6267\u884c\u8017\u65f6\uff0c\u7c7b\u52a0\u8f7d\u4fe1\u606f\u7b49\uff0c\u5927\u5927\u63d0\u5347\u7ebf\u4e0a\u95ee\u9898\u6392\u67e5\u6548\u7387\u3002</p> <p>Arthas\u5b98\u65b9\u6587\u6863</p>"},{"location":"Arthas/#arthas_1","title":"Arthas\u4e0b\u8f7d\u4e0e\u4f7f\u7528","text":"<pre><code>curl -O https://arthas.aliyun.com/arthas-boot.jar\n</code></pre> <p>\u542f\u52a8Arthas</p> <pre><code>java -jar arthas-boot.jar\n</code></pre> <p>\u8f93\u5165id\u5e8f\u53f7\u9009\u62e9\u60f3\u8981\u76d1\u63a7\u7684\u8fdb\u7a0b</p> <p></p> <p>\u672c\u673a\u5b89\u88c5\u7684\u662fopenJDK\u6ca1\u6709jsp\u3001jstack\u3001jstat\u7b49\u76f8\u5173\u547d\u4ee4\uff0c\u5b89\u88c5\u540e\u4fbf\u53ef\u6b63\u5e38\u8fd0\u884c</p> <p></p> <p>\u5b89\u88c5</p> <pre><code>yum install java-1.8.0-openjdk-devel -y\n</code></pre>"},{"location":"Arthas/#arthas_2","title":"Arthas\u7ebf\u4e0a\u6392\u67e5\u95ee\u9898\u5e38\u7528\u7684\u51e0\u4e2a\u547d\u4ee4","text":"<ul> <li>memory    \u67e5\u770bJVM \u5185\u5b58\u4fe1\u606f</li> <li>sysprop   \u67e5\u770b\u5f53\u524dJVM\u7684\u7cfb\u7edf\u5c5e\u6027</li> <li>thread    \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u6267\u884c\u60c5\u51b5</li> <li>trace \u65b9\u6cd5\u5185\u90e8\u8c03\u7528\u8def\u5f84\uff0c\u5e76\u8f93\u51fa\u65b9\u6cd5\u8def\u5f84\u4e0a\u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8017\u65f6</li> <li>watch \u51fd\u6570\u6267\u884c\u6570\u636e\u89c2\u6d4b</li> <li>tt    \u5b98\u65b9\u89e3\u91ca\u4e3a\u65f6\u7a7a\u96a7\u9053\uff0c\u8bb0\u5f55\u4e0b\u6307\u5b9a\u65b9\u6cd5\u6bcf\u6b21\u8c03\u7528\u7684\u5165\u53c2\u548c\u8fd4\u56de\u4fe1\u606f\uff0c\u5e76\u80fd\u5bf9\u8fd9\u4e9b\u4e0d\u540c\u7684\u65f6\u95f4\u4e0b\u8c03\u7528\u8fdb\u884c\u89c2\u6d4b</li> </ul>"},{"location":"Arthas/#1memory-jvm","title":"1.memory \u67e5\u770bJVM \u5185\u5b58\u4fe1\u606f","text":"<pre><code>memory\n</code></pre>"},{"location":"Arthas/#2thread","title":"2.thread \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u6267\u884c\u60c5\u51b5","text":"<pre><code>thread\n</code></pre>"},{"location":"Arthas/#3trace","title":"3.trace \u67e5\u770b\u65b9\u6cd5\u8017\u65f6","text":"<p>\u53c2\u6570</p> <p>\u25cf -n: \u547d\u4ee4\u6355\u6349\u6b21\u6570\uff0c\u8fbe\u5230\u8bbe\u7f6e\u6b21\u6570\u540e\u81ea\u52a8\u9000\u51fa\u8be5\u547d\u4ee4</p> <p>\u25cf --skipJDKMethod\uff1a\u662f\u5426jdk\u91cc\u7684\u51fd\u6570\u8c03\u7528</p> <p>\u4f8b\uff1a\u67e5\u770bcom.example.demo.service.AdminService\u7c7b\u4e2dgetUsers\u5404\u65b9\u6cd5\u6267\u884c\u8017\u65f6</p> <pre><code>trace com.example.demo.service.AdminService getUsers  -n 5 --skipJDKMethod false\n</code></pre> <p></p>"},{"location":"Arthas/#4-watch","title":"4 watch \u65b9\u6cd5\u51fa\u5165\u53c2","text":"<p>\u25cf -n: \u547d\u4ee4\u6355\u6349\u6b21\u6570\uff0c\u8fbe\u5230\u8bbe\u7f6e\u6b21\u6570\u540e\u81ea\u52a8\u9000\u51fa\u8be5\u547d\u4ee4</p> <p>\u25cf express\uff1a\u9ed8\u8ba4\u503c{params,returnObj,throwExp}\uff0c\u5206\u522b\u4ee3\u8868\uff0c\u5165\u53c2\u3001\u51fa\u53c2\u3001\u5f02\u5e38</p> <p>\u25cf -x\uff1a\u8868\u793a\u8f93\u51fa\u7ed3\u679c\u7684\u5c5e\u6027\u904d\u5386\u6df1\u5ea6\uff0c\u9ed8\u8ba4\u4e3a 1\uff0c\u6700\u5927\u503c\u662f4</p> <p>\u25cf -b\uff1a\u5728\u65b9\u6cd5\u8c03\u7528\u524d\u6267\u884c\u76d1\u63a7</p> <p>\u25cf -f\uff1a\u5728\u65b9\u6cd5\u8c03\u7528\u540e\u6267\u884c\u76d1\u63a7\uff08\u9ed8\u8ba4\uff09</p> <p>\u25cf -e\uff1a\u5728\u65b9\u6cd5\u8c03\u7528\u524d\u6267\u884c\u76d1\u63a7</p> <p>\u25cf -s\uff1a \u5728\u65b9\u6cd5\u8fd4\u56de\u540e\u6267\u884c</p> <p>\u4f8b\uff1a</p> <pre><code>watch com.example.demo.service.AdminService getUsers '{params,returnObj,throwExp}'  -n 5  -x 3\n</code></pre> <p>\u53ef\u6dfb\u52a0cost\u53c2\u6570\u8fdb\u884c\u65b9\u6cd5\u8017\u65f6\u8fc7\u6ee4</p> <pre><code>watch com.example.demo.service.AdminService getUsers '{params,returnObj,throwExp}' '#cost&gt;200' -x 3\n</code></pre> <pre><code>watch com.example.demo.service.AdminService getUsers '{params,returnObj,throwExp}'  -n 5  -x 3 \nPress Q or Ctrl+C to abort.\nAffect(class count: 2 , method count: 2) cost in 70 ms, listenerId: 4\nmethod=com.example.demo.service.AdminService.getUsers location=AtExit\nts=2022-07-07 23:01:34; [cost=77.637229ms] result=@ArrayList[\n@Object[][\n@Integer[1],\n@Integer[10],\n@String[],\nnull,\n],\n@PageResponseVo[\ndata=@ArrayList[\n@User[User(id=159, username=\u521811, sex=1, payType=6, jobType=0, idCard=2222, hiredate=Wed Jun 22 15:59:09 CST 2022, mobile=4444, departmentId=1, currentStatus=0, bankCode=, createTime=Wed Jun 22 15:59:09 CST 2022, updateTime=Wed Jun 22 15:59:09 CST 2022, dateStatus=0)],\n@User[User(id=158, username=\u6881\u68422, sex=1, payType=6, jobType=0, idCard=333, hiredate=Wed Jun 22 15:56:45 CST 2022, mobile=422, departmentId=1, currentStatus=0, bankCode=, createTime=Wed Jun 22 15:56:45 CST 2022, updateTime=Wed Jun 22 15:56:45 CST 2022, dateStatus=0)],\n],\ncode=@Integer[1],\nmsg=@String[\u64cd\u4f5c\u6210\u529f],\ntotal=@Long[113],\n],\nnull,\n]\n</code></pre>"},{"location":"Arthas/#5-tt","title":"5 tt \u8bb0\u5f55\u4e0b\u6307\u5b9a\u65b9\u6cd5\u6bcf\u6b21\u8c03\u7528\u7684\u5165\u53c2\u548c\u8fd4\u56de\u4fe1\u606f","text":"<p>\u25cf -n: \u547d\u4ee4\u6355\u6349\u6b21\u6570\uff0c\u8fbe\u5230\u8bbe\u7f6e\u6b21\u6570\u540e\u81ea\u52a8\u9000\u51fa\u8be5\u547d\u4ee4</p> <p>\u25cf -t :\u8fd9\u4e2a\u53c2\u6570\u7684\u8868\u660e\u5e0c\u671b\u8bb0\u5f55\u4e0b\u7c7b *Test \u7684 print \u65b9\u6cd5\u7684\u6bcf\u6b21\u6267\u884c\u60c5\u51b5\u3002</p> <p>\u25cf -w: --watch-express \u89c2\u5bdf\u65f6\u7a7a\u96a7\u9053\u4f7f\u7528ognl \u8868\u8fbe\u5f0f</p> <p>\u25cf -p:\u6307\u5b9a\u8c03\u7528\u6b21\u6570</p> <p>\u4f8b\uff1a</p> <pre><code>tt -t com.soomey.controller.authorized.merchant.setting.SettingController loadFormConfig -n 5\n</code></pre> <p> \u518d\u6b21\u8f93\u5165\u89c2\u5bdf\u7684\u5e8f\u53f7 <code>tt -p -i 1000</code> \u5219\u53ef\u4ee5\u53ef\u4ee5\u67e5\u770b\u5e8f\u53f7\u4e3a1000\u8bb0\u5f55\u7684\u5177\u4f53\u8c03\u7528\u4fe1\u606f\uff0c\u51fa\u5165\u53c2\u4e0e\u65b9\u6cd5\u8017\u65f6\u7b49\u7b49  \u8fd8\u53ef\u4ee5\u4f7f\u7528 <code>-w</code>\u4e0e\u65f6\u7a7a\u96a7\u9053\u4f7f\u7528ognl \u8868\u8fbe\u5f0f\u6267\u884c\u5176\u4ed6\u65b9\u65b9\u6cd5</p> <p>\u4f8b\uff1a \u6267\u884c\u8c03\u7528\u5e8f\u53f7\u4e3a1000\u7684controller\u4e2d\u7684getDerivativePictureSettingData()\u65b9\u6cd5</p> <pre><code>tt -i 1000 -w 'target.getDerivativePictureSettingData()'\n</code></pre>"},{"location":"Arthas/#6-scognl","title":"6 sc+ognl\u8868\u8fbe\u5f0f\u6267\u884c\u9759\u6001\u65b9\u6cd5","text":"<p><code>sc</code>\u67e5\u770b JVM \u5df2\u52a0\u8f7d\u7684\u7c7b\u4fe1\u606f</p> <pre><code>sc -d com.soomey.util.MogujieUtils\n</code></pre> <p></p> <p>\u83b7\u53d6\u5230\u7c7b\u52a0\u8f7d\u5668hashcode\u503c\uff0c\u6839\u636eognl\u8868\u8fbe\u5f0f\u5373\u53ef\u6267\u884c\u5f53\u524d\u7c7b\u4e2d\u67d0\u4e2a\u65b9\u6cd5</p> <pre><code>ognl -c 54ba4f78 '@com.soomey.util.MogujieUtils@getDecryptId(\"85C47D13A725FF56178934CE4038D38E\",\"114q\")'\n</code></pre> <p>\u6216\u8005\u6839\u636eognl\u8868\u8fbe\u5f0f\u67e5\u770b\u67d0\u4e2a\u7c7b\u4e2d\u6210\u5458\u53d8\u91cf</p> <pre><code>ognl -c 54ba4f78 '@com.soomey.util.ResourceStorageUtils@ossBucketNames.toString()'\n</code></pre>"},{"location":"Arthas%E6%8F%92%E4%BB%B6/","title":"Arthas\u5b9e\u9645\u5f00\u53d1\u4e2d\u4f7f\u7528","text":""},{"location":"Arthas%E6%8F%92%E4%BB%B6/#arthas-idea","title":"Arthas idea \u63d2\u4ef6","text":"<p>\u7531\u4e8eArthas \u547d\u4ee4\u8fc7\u4e8e\u7e41\u7410\uff0c\u4f7f\u7528\u8d77\u6765\u7a0d\u5fae\u6709\u4e9b\u9ebb\u70e6\uff0c\u6709\u4e9b\u65f6\u5019\u53ea\u9700\u8981\u7b80\u5355\u6267\u884c\u67d0\u4e9b\u547d\u4ee4\uff0c\u90a3\u4e48\u53ef\u4ee5\u501f\u52a9idea \u63d2\u4ef6arthas idea \u6765\u5feb\u901f\u751f\u6210\u9700\u8981\u6700\u4fbf\u6377\u7684\u547d\u4ee4  </p> <p>1.\u4e0b\u8f7d Arthas  plugin   2\u3001\u9009\u62e9\u9700\u8981\u76d1\u63a7\u7684\u65b9\u6cd5\uff0c  3.\u9009\u62e9\u5bf9\u8be5\u65b9\u6cd5\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4  4.\u590d\u5236\u547d\u4ee4\u7a0d\u505a\u6309\u81ea\u5df1\u9700\u6c42\u7a0d\u505a\u4fee\u6539  5.\u642c\u8fd0\u5230Arthas\u63a7\u5236\u53f0 </p> <p>\u7ebf\u4e0a\u65f6\u95f4\u60c5\u51b5\u4f7f\u7528</p> <p>\u7ebf\u4e0a\u8bf7\u6c42\u8fc7\u591a\uff0c\u4e3a\u4e86\u51cf\u8f7b\u6392\u9664\u8303\u56f4\uff0c\u90a3\u4e48\u9700\u8981\u6839\u636e\u8bf7\u6c42\u7684\u5165\u53c2\u3001\u51fa\u53c2\u6765\u7f29\u5c0f\u76d1\u63a7\u8bbf\u95ee\uff0c\u4ece\u800c\u6765\u5b9e\u73b0\u95ee\u9898\u7684\u5b9a\u4f4d \u7cfb\u7edf\u5361\u987f\uff0c\u5728\u7279\u5b9a\u7684\u65f6\u95f4\u4e0e\u7279\u5b9a\u7684\u7528\u6237\uff0c \u6bd4\u5982\u67d0\u4e2a\u7528\u6237\u53cd\u5e94\u7cfb\u7edf\u5361\u987f\uff0c\u90a3\u4e48\u4f7f\u7528Arthas\u67e5\u770b\u65b9\u6cd5\u5177\u4f53\u8017\u65f6 \u67e5\u8be2pictures()\u65b9\u6cd5\u53c2\u6570id\u4e3a1\u7684\u65b9\u6cd5\u6267\u884c\u8017\u65f6</p> <p></p> <pre><code>trace com.soomey.controller.authorized.merchant.ProductController pictures 'params[2]==1'\n</code></pre> <p></p>"},{"location":"CPU/","title":"\u670d\u52a1\u5668CPU\u6ee1\u8f7d\u6392\u67e5","text":""},{"location":"CPU/#cpu","title":"\u670d\u52a1\u5668CPU\u6ee1\u8f7d\u6392\u67e5","text":"<p>\u7ebf\u4e0a\u8fd0\u884c\u7684\u9879\u76ee\u5ffd\u7136\u6709\u5927\u6279\u5ba2\u6237\u53cd\u9988\u7cfb\u7edf\u5361\u987f\uff0c\u751a\u81f3\u6709\u4e9b\u9879\u76ee\u65e0\u6cd5\u6253\u5f00\uff0c\u4e8e\u662f\u9488\u5bf9\u8be5\u95ee\u9898\u9010\u6b65\u6392\u67e5</p> <p>\u9996\u5148\u4f7f\u7528 ping \u67e5\u770b\u7f51\u7edc\u72b6\u6001</p> <pre><code>ping  \u76ee\u6807\u7ad9\u70b9\n</code></pre> <p>\u53d1\u73b0\u7f51\u7edc\u8fd4\u56de\u6570\u636e\u5e76\u65e0\u5f02\u5e38</p> <p>\u901a\u8fc7\u963f\u91cc\u4e91\u76d1\u63a7\u67e5\u770b\u670d\u52a1\u5668\u72b6\u6001\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>top</code> \u547d\u4ee4\u6216\u8005 <code>htop</code> \u547d\u4ee4\u6765\u68c0\u67e5 CPU \u4f7f\u7528\u7387 </p> <p>\u53d1\u73b0 CPU \u4f7f\u7528\u7387\u8fc7\u9ad8\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u670d\u52a1\u5668\u6027\u80fd\u4e25\u91cd\u4e0b\u964d\u3002</p>"},{"location":"CPU/#arthas","title":"\u8fdb\u5165\u7ec8\u7aef\u670d\u52a1\u5668\u4f7f\u7528Arthas","text":"<p>\uff08\u76ee\u524d\u6700\u5feb\u6377\u7684\u65b9\u5f0f\uff09</p> <p>\u5b89\u88c5</p> <pre><code>curl -O https://arthas.aliyun.com/arthas-boot.jar\njava -jar arthas-boot.jar\n</code></pre> <p>\u67e5\u770b\u5806\u6808\u4fe1\u606f</p> <pre><code>dashboard\n</code></pre> <p>\u8f93\u51fa</p> <pre><code>ID    NAME                               GROUP            PRIORITY    STATE      %CPU        DELTA_TIME TIME        INTERRUPTE DAEMON      \n170   PPA-15654608                       main             5           RUNNABLE   4.28        0.213      3:9.959     false      true        \n-1    C2 CompilerThread0                 -                -1          -          3.95        0.197      5:4.039     false      true        \n22039 ForkJoinPool.commonPool-worker-13  main             5           WAITING    0.69        0.034      2:44.081    false      true        \n-1    VM Thread                          -                -1          -          0.37        0.018      1:1.155     false      true        \n25729 ForkJoinPool.commonPool-worker-3   main             5           RUNNABLE   0.31        0.015      1:49.257    false      true        \n47433 process reaper                     system           10          TIMED_WAIT 0.31        0.015      0:0.051     false      true        \n47433 process reaper                     system           10          RUNNABLE   0.29        0.014      0:0.027     false      true        \n47434 process reaper                     system           10          RUNNABLE   0.28        0.014      0:0.035     false      true        \n21680 ForkJoinPool.commonPool-worker-1   main             5           WAITING    0.28        0.014      2:42.162    false      true        \n26964 ForkJoinPool.commonPool-worker-7   main             5           WAITING    0.23        0.011      1:23.245    false      true        \n29964 ForkJoinPool.commonPool-worker-19  main             5           WAITING    0.23        0.011      1:19.606    false      true        \nMemory                        used      total     max       usage     GC                                                                   \nheap                          4878M     8192M     8192M     59.55%    gc.g1_young_generation.count       5175                              \ng1_eden_space                 1792M     3204M     -1        55.93%    gc.g1_young_generation.time(ms)    216104                            \ng1_old_gen                    3062M     4964M     8192M     37.38%    gc.g1_old_generation.count         0                                 \ng1_survivor_space             24M       24M       -1        100.00%   gc.g1_old_generation.time(ms)      0                                 \nnonheap                       286M      349M      -1        81.95%                                                                         \ncodeheap_'non-nmethods'       2M        2M        5M        43.45%                                                                         \nmetaspace                     162M      212M      -1        76.72%                                                                         \ncodeheap_'profiled_nmethods'  51M       56M       117M      43.98%                                                                         \ncompressed_class_space        18M       26M       1024M     1.83%                                                                          \nRuntime                                                                                                                                    \nos.name                                                               Linux                                                                \nos.version                                                            3.10.0-957.5.1.el7.x86_64                                            \njava.version                                                          11.0.3                                                               \njava.home                                                             /usr/lib/jvm/java-11-openjdk-11.0.3.7-0.el7_6.x86_64                 \nsystemload.average                                                    13.59                                                                \nprocessors                                                            8                                                                    \ntimestamp/uptime                                                      Thu Feb 23 16:39:27 CST 2023/22652s                                  \nID    NAME                               GROUP            PRIORITY    STATE      %CPU        DELTA_TIME TIME        INTERRUPTE DAEMON      \n172   Catalina-utility-2                 main             1           RUNNABLE   21.91       1.096      24:25.122   false      false       \n170   PPA-15654608                       main             5           RUNNABLE   11.63       0.582      3:10.541    false      true        \n-1    C2 CompilerThread0                 -                -1          -          7.38        0.369      5:4.408     false      true        \n166   PPA-15654551                       main             5           RUNNABLE   4.7         0.235      3:1.917     false      true        \n171   PPA-15654869                       main             5           WAITING    3.5         0.175      2:28.741    false      true        \n22039 ForkJoinPool.commonPool-worker-13  main             5           WAITING    0.47        0.023      2:44.104    false      true        \n21680 ForkJoinPool.commonPool-worker-1   main             5           WAITING    0.46        0.023      2:42.186    false      true        \n-1    VM Thread                          -                -1          -          0.43        0.021      1:1.176     false      true        \n25729 ForkJoinPool.commonPool-worker-3   main             5           WAITING    0.4         0.020      1:49.277    false      true        \n47450 process reaper                     system           10          RUNNABLE   0.4         0.019      0:0.041     false      true        \n30243 ForkJoinPool.commonPool-worker-9   main             5           WAITING    0.39        0.019      1:6.710     false      true        \nMemory                        used      total     max       usage     GC                                                                   \nheap                          5970M     8192M     8192M     72.88%    gc.g1_young_generation.count       5175                              \ng1_eden_space                 2840M     3204M     -1        88.64%    gc.g1_young_generation.time(ms)    216104                            \ng1_old_gen                    3106M     4964M     8192M     37.92%    gc.g1_old_generation.count         0                                 \ng1_survivor_space             24M       24M       -1        100.00%   gc.g1_old_generation.time(ms)      0                                 \nnonheap                       286M      349M      -1        81.99%                                                                         \ncodeheap_'non-nmethods'       2M        2M        5M        43.45%                                                                         \nmetaspace                     162M      212M      -1        76.72%                                                                         \ncodeheap_'profiled_nmethods'  51M       56M       117M      44.05%                                                                         \ncompressed_class_space        18M       26M       1024M     1.83%                                                                          \nRuntime                                                                                                                                    \nos.name                                                               Linux                                                                \nos.version                                                            3.10.0-957.5.1.el7.x86_64                                            \njava.version                                                          11.0.3                                                               \njava.home                                                             /usr/lib/jvm/java-11-openjdk-11.0.3.7-0.el7_6.x86_64                 \nsystemload.average                                                    15.22                                                                \nprocessors                                                            8                                                                    \ntimestamp/uptime                                                      Thu Feb 23 16:39:31 CST 2023/22657s           \n</code></pre> <p>\u4f7f\u7528arthas\u547d\u4ee4\uff0c\u67e5\u627e\u6700\u8017\u65f6\u524d5\u4e2a\u7ebf\u7a0b\u5806\u6808\u4fe1\u606f</p> <pre><code>thread -n 5\n</code></pre> <p>\u8f93\u51fa</p> <pre><code>\"PVRC-10835394\" Id=105 cpuUsage=27.63% deltaTime=68ms time=2962472ms RUNNABLE\n    at java.base@11.0.3/java.lang.Integer.formatUnsignedInt(Integer.java:385)\n    at java.base@11.0.3/java.lang.Integer.toUnsignedString0(Integer.java:344)\n    at java.base@11.0.3/java.lang.Integer.toHexString(Integer.java:262)\n    at org.apache.http.impl.conn.Wire.wire(Wire.java:77)\n    at org.apache.http.impl.conn.Wire.input(Wire.java:117)\n    at org.apache.http.impl.conn.LoggingInputStream.read(LoggingInputStream.java:88)\n    at org.apache.http.impl.io.SessionInputBufferImpl.streamRead(SessionInputBufferImpl.java:139)\n    at org.apache.http.impl.io.SessionInputBufferImpl.read(SessionInputBufferImpl.java:200)\n    at org.apache.http.impl.io.ContentLengthInputStream.read(ContentLengthInputStream.java:178)\n    at org.apache.http.conn.EofSensorInputStream.read(EofSensorInputStream.java:135)\n    at java.base@11.0.3/java.util.zip.CheckedInputStream.read(CheckedInputStream.java:83)\n    at java.base@11.0.3/java.io.FilterInputStream.read(FilterInputStream.java:133)\n    at com.aliyun.oss.event.ProgressInputStream.read(ProgressInputStream.java:116)\n    at java.base@11.0.3/java.util.zip.CheckedInputStream.read(CheckedInputStream.java:83)\n    at java.base@11.0.3/java.io.FilterInputStream.read(FilterInputStream.java:107)\n    at com.aliyun.oss.internal.OSSObjectOperation.getObject(OSSObjectOperation.java:308)\n    at com.aliyun.oss.OSSClient.getObject(OSSClient.java:545)\n    at com.soomey.util.OssUtils.persistFile(OssUtils.java:177)\n    at com.soomey.util.OssUtils.get(OssUtils.java:109)\n    at com.soomey.util.ResourceStorageUtils.retrieveIfNecessary(ResourceStorageUtils.java:107)\n    at com.soomey.entity.core.ProductPicture.path(ProductPicture.java:389)\n    at cn.deepdraw.masaimara.domain.productrenderer.product.Utilities.setPureColorBackgroundFeature(Utilities.java:77)\n    at com.soomey.masaimara.bean.product.DefaultPictureFilter.lambda$setPureColorBackgroundFeature$1(DefaultPictureFilter.java:25)\n    at com.soomey.masaimara.bean.product.DefaultPictureFilter$$Lambda$1518/0x0000000840b46840.accept(Unknown Source)\n    at java.base@11.0.3/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\n    at java.base@11.0.3/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:177)\n    at java.base@11.0.3/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1654)\n    at java.base@11.0.3/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)\n    at java.base@11.0.3/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)\n    at java.base@11.0.3/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\n    at java.base@11.0.3/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\n    at java.base@11.0.3/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n    at java.base@11.0.3/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:497)\n    at com.soomey.masaimara.bean.product.DefaultPictureFilter.setPureColorBackgroundFeature(DefaultPictureFilter.java:25)\n    at com.soomey.masaimara.bean.product.DefaultPictureFilter.filter(DefaultPictureFilter.java:19)\n    at com.soomey.masaimara.bean.template.AbstractRenderer.preHandleProduct(AbstractRenderer.java:75)\n    at com.soomey.masaimara.bean.template.AbstractRenderer.render(AbstractRenderer.java:61)\n    at cn.deepdraw.masaimara.application.detailpage.DetailPageRenderingTask.renderAsHtml(DetailPageRenderingTask.java:105)\n    at cn.deepdraw.masaimara.application.detailpage.DetailPageRenderingTask.render(DetailPageRenderingTask.java:77)\n    at cn.deepdraw.masaimara.application.detailpage.DetailPageRenderingTask.call(DetailPageRenderingTask.java:63)\n    at cn.deepdraw.masaimara.application.detailpage.ProductVisionResourceCreator.call(ProductVisionResourceCreator.java:13)\n    at cn.deepdraw.masaimara.application.detailpage.DetailPageRenderingTask.call(DetailPageRenderingTask.java:30)\n    at com.soomey.bean.task.CallableTask.run(CallableTask.java:43)\n    at com.soomey.bean.task.WeighableTask.run(WeighableTask.java:49)\n    at com.soomey.bean.task.WeighableTaskQueue$PoolWorker.run(WeighableTaskQueue.java:131)\n\n\n\"C2 CompilerThread0\" [Internal] cpuUsage=25.92% deltaTime=64ms time=300015ms\n</code></pre> <p>\u627e\u51fa\u5bf9\u5e94\u65b9\u6cd5\u8fdb\u884c\u4f18\u5316</p> <p></p> <p>\u6839\u636e\u4ee5\u4e0a\u6808\u5806\u4fe1\u606f\u627e\u5230\u53d1\u73b0\u5bfc\u81f4\u63a5\u53e3\u5361\u987f\u4e3b\u8981\u4e3a/masaimara/ppa\u6539\u63a5\u53e3\u5bfc\u81f4\uff0c\u8be5\u63a5\u53e3\u4e3b\u8981\u662f\u63a5\u6536masaimara\u670d\u52a1\u56fe\u7247\u5206\u6790\u6570\u636e\u8fdb\u884cdb\u843d\u5e93\uff0c\u6ca1\u6709\u91c7\u7528\u5206\u6279\u6279\u91cf\u63d2\u5165\u7684\u65b9\u5f0f\u63d2\u5165\uff0c\u5bfc\u81f4\u5360\u7528\u8fc7\u7684\u6c60\u6ca1\u6709\u91ca\u653e</p>"},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/","title":"Centos\u5b89\u88c5python3.8","text":""},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#yum","title":"\u4f7f\u7528 yum \u547d\u4ee4\u5b89\u88c5\u5fc5\u8981\u7684\u4f9d\u8d56\u9879","text":"<pre><code>sudo yum install gcc openssl-devel bzip2-devel libffi-devel\n</code></pre>"},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#python-38","title":"\u4e0b\u8f7d Python 3.8 \u7684\u6e90\u4ee3\u7801\u5305","text":"<pre><code>cd ~\nwget https://www.python.org/ftp/python/3.8.0/Python-3.8.0.tgz\n</code></pre>"},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#_1","title":"\u89e3\u538b\u6e90\u4ee3\u7801\u5305\u5e76\u8fdb\u5165\u89e3\u538b\u540e\u7684\u76ee\u5f55","text":"<pre><code>tar xzf Python-3.8.0.tgz\ncd Python-3.8.0\n</code></pre>"},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#python","title":"\u914d\u7f6e Python \u5b89\u88c5\u9009\u9879","text":"<pre><code>./configure --enable-optimizations\n</code></pre>"},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#python_1","title":"\u7f16\u8bd1 Python","text":"<pre><code>make\n</code></pre>"},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#python_2","title":"\u5b89\u88c5 Python","text":"<pre><code>sudo make altinstall\n</code></pre> <p>\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u9a8c\u8bc1 Python \u662f\u5426\u5df2\u6210\u529f\u66f4\u65b0</p> <pre><code>python3.8 --version\n</code></pre>"},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#pip","title":"\u66f4\u65b0pip","text":"<pre><code> python3.8 -m pip install --upgrade pip\n</code></pre>"},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#_2","title":"\u914d\u7f6e\u865a\u62df\u73af\u5883","text":""},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#virtualenv","title":"\u5b89\u88c5virtualenv","text":"<pre><code>pip install virtualenv\n</code></pre>"},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#_3","title":"\u521b\u5efa\u865a\u62df\u73af\u5883","text":"<pre><code>virtualenv -p /usr/local/bin/python3.8 myenv\n</code></pre>"},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#_4","title":"\u6fc0\u6d3b\u865a\u62df\u73af\u5883","text":"<pre><code>source myenv/bin/activate\n</code></pre>"},{"location":"Centos%E5%AE%89%E8%A3%85python3.8/#_5","title":"\u9000\u51fa\u865a\u62df\u73af\u5883","text":"<pre><code>deactivate      #---\u4efb\u4f55\u76ee\u5f55\u4e0b\uff0c\u90fd\u53ef\u4ee5\n</code></pre>"},{"location":"Elasticsearch%20%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/","title":"Elasticsearch \u57fa\u672c\u4f7f\u7528","text":"<p>Elasticsearch(\u7b80\u79f0ES)\u662f\u4e00\u4e2a\u57fa\u4e8eApache Lucene\u6784\u5efa\u7684\u5f00\u6e90\u3001\u5206\u5e03\u5f0f\u3001RESTful\u63a5\u53e3\u7684\u5168\u6587\u641c\u7d22\u5f15\u64ce\uff0cElasticsearch\u901a\u8fc7\u5bf9Lunece\u7684\u5c01\u88c5\uff0c\u9690\u85cf\u4e86\u590d\u6742\u6027\uff0c\u63d0\u4f9b\u4e86\u4f7f\u7528\u7b80\u5355\u7684RESTful Api\u3002Elasticsearch\u8fd8\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u6587\u6863\u6570\u636e\u5e93\uff0c\u5176\u4e2d\u6bcf\u4e2a\u5b57\u6bb5\u5747\u53ef\u88ab\u7d22\u5f15\uff0c\u800c\u4e14\u6bcf\u4e2a\u5b57\u6bb5\u7684\u6570\u636e\u5747\u53ef\u88ab\u641c\u7d22\uff0c\u56e0\u4e3a\u5bf9\u6587\u6863\u8fdb\u884c\u4e86\u5206\u8bcd\u5904\u7406\u3002ES\u80fd\u591f\u6a2a\u5411\u6269\u5c55\u81f3\u6570\u4ee5\u767e\u8ba1\u7684\u670d\u52a1\u5668\u5b58\u50a8\u4ee5\u53ca\u5904\u7406PB\u7ea7\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u5728\u6781\u77ed\u7684\u65f6\u95f4\u5185\u5b58\u50a8\u3001\u641c\u7d22\u548c\u5206\u6790\u5927\u91cf\u7684\u6570\u636e\u3002Elasticsearch \u662f\u7528 Java \u5f00\u53d1\u7684\uff0c\u5e76\u4f5c\u4e3a Apache \u8bb8\u53ef\u6761\u6b3e\u4e0b\u7684\u5f00\u653e\u6e90\u7801\u53d1\u5e03\uff0c\u662f\u5f53\u524d\u6d41\u884c\u7684\u4f01\u4e1a\u7ea7\u641c\u7d22\u5f15\u64ce\u3002\u8bbe\u8ba1\u7528\u4e8e\u4e91\u8ba1\u7b97\u4e2d\uff0c\u80fd\u591f\u8fbe\u5230\u5b9e\u65f6\u641c\u7d22\uff0c\u7a33\u5b9a\uff0c\u53ef\u9760\uff0c\u5feb\u901f\uff0c\u5b89\u88c5\u4f7f\u7528\u65b9\u4fbf</p> <p>Elasticsearch\u5b98\u7f51</p>"},{"location":"Elasticsearch%20%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/#elasticsearch-java-sdk","title":"\u5728\u9879\u76ee\u4e2d\u5f15\u5165ElasticSearch JAVA SDK","text":"<p>Maven</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;\n    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;\n    &lt;version&gt;7.6.2&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>Gradle</p> <pre><code>implementation 'org.elasticsearch.client:elasticsearch-rest-high-level-client:7.6.2'\n</code></pre> <p>yaml</p> <pre><code>elasticsearch:\n  cluster-name: test-otc-cluster\n  cluster-nodes: 127.0.0.1\n  port: 9301\n  pool: 5\n</code></pre>"},{"location":"Elasticsearch%20%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/#elasticsearch-java-high-level-rest-client","title":"\u914d\u7f6eElasticSearch  Java High Level REST Client \u64cd\u4f5c\u5bf9\u8c61","text":"<p>\u521d\u59cb\u5316RestHighLevelClient \u5e76\u4ea4\u7ed9\u5bb9\u5668\u7ba1\u7406</p> <pre><code>@Bean(name = \"restHighLevelClient\")\n    public RestHighLevelClient restHighLevelClient() {\n        //\u53ef\u4ee5\u4f20httpHost\u6570\u7ec4\n        String[] nodes = esNodes.split(\",\");\n        HttpHost[] httpHosts = new HttpHost[nodes.length];\n        for (int i = 0; i &lt; httpHosts.length; i++) {\n            httpHosts[i] = new HttpHost(nodes[i], ES_PORT, \"http\");\n        }\n\n        RestClientBuilder builder = RestClient.builder(httpHosts);\n        // \u5f02\u6b65httpclient\u7684\u8fde\u63a5\u5ef6\u65f6\u914d\u7f6e\n        builder.setRequestConfigCallback(requestConfigBuilder -&gt; {\n            //\u8bbe\u7f6e\u8d85\u65f6\n            requestConfigBuilder.setConnectTimeout(CONNECT_TIME_OUT);\n            requestConfigBuilder.setSocketTimeout(SOCKET_TIME_OUT);\n            return requestConfigBuilder.setConnectionRequestTimeout(CONNECTION_REQUEST_TIME_OUT);\n        });\n        // \u5f02\u6b65httpclient\u7684\u8fde\u63a5\u6570\u914d\u7f6e\n        builder.setHttpClientConfigCallback(requestConfigBuilder -&gt; {\n            requestConfigBuilder.setMaxConnTotal(MAX_CONNECT_NUM);\n            return requestConfigBuilder.setMaxConnPerRoute(MAX_CONNECT_PER_ROUTE);\n        });\n\n        return new RestHighLevelClient(builder);\n    }\n</code></pre>"},{"location":"Elasticsearch%20%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/#resthighlevelclient","title":"RestHighLevelClient \u76f8\u5173\u64cd\u4f5c","text":"<p>\u57fa\u4e8e7.6.2\u5c01\u88c5\u5230\u5de5\u5177\u7c7b</p> <pre><code>public class EsClientUtils {\n    /**\n     * The official recommendation is 1000-5000\n     */\n    private static int batchSize = 1000;\n\n    private static String EsPreTags = \"&lt;span style='color:red' &gt;\";\n\n    private static String EsPostTags = \"&lt;/span&gt;\";\n\n    private static String baseScript = \"ctx._source['%s']=params.%s;\";\n\n\n    public enum EsRangeEnums {\n        /**\n         * \u5f00\u59cb\u503c\n         */\n        START,\n        /**\n         * \u7ed3\u675f\u503c\n         */\n        END,\n\n        ;\n\n    }\n\n    @AllArgsConstructor\n    @Getter\n    public enum AggregationEnums {\n        /**\n         * \u805a\u5408\n         */\n        MAX(\"max\", new MaxAggregationBuilder(\"max\")),\n\n        MIN(\"min\", new MinAggregationBuilder(\"min\")),\n\n        AVG(\"avg\", new AvgAggregationBuilder(\"avg\")),\n\n        SUM(\"sum\", new SumAggregationBuilder(\"sum\")),\n\n        COUNT(\"count\", new ValueCountAggregationBuilder(\"count\", ValueType.LONG)),\n        ;\n\n        private  String code;\n\n\n        private  ValuesSourceAggregationBuilder aggregationBuilder;\n    }\n\n\n    private static RestHighLevelClient restHighLevelClient;\n\n\n    @Autowired\n    public void init(RestHighLevelClient restHighLevelClient) {\n        EsClientUtils.restHighLevelClient = restHighLevelClient;\n    }\n\n\n    /**\n     * \u5224\u65ad\u7d22\u5f15\u662f\u5426\u5b58\u5728\n     *\n     * @param index\n     * @return\n     */\n    public static boolean isIndexExist(String index) throws IOException {\n        return restHighLevelClient.indices().exists(new GetIndexRequest(index), RequestOptions.DEFAULT);\n    }\n\n\n    /**\n     * \u521b\u5efa\u7d22\u5f15\n     *\n     * @param index\n     * @return\n     */\n    public static boolean createIndex(String index) throws IOException {\n        if (isIndexExist(index)) {\n            CreateIndexRequest request = new CreateIndexRequest(index);\n            CreateIndexResponse createIndexResponse = restHighLevelClient.indices().create(request, RequestOptions.DEFAULT);\n            return createIndexResponse.isAcknowledged();\n        }\n        log.info(\"The index already exists\");\n        return false;\n    }\n\n\n    /**\n     * \u5220\u9664\u7d22\u5f15\n     *\n     * @param index\n     * @return\n     */\n    public static boolean deleteIndex(String index) throws IOException {\n        if (!isIndexExist(index)) {\n            log.info(\"Index is not exits!\");\n        }\n        return restHighLevelClient.indices().delete(new DeleteIndexRequest(index), RequestOptions.DEFAULT).isAcknowledged();\n    }\n\n    /**\n     * @param dataMap &lt;\u6587\u6863ID,\u6570\u636e\u6e90&gt;\n     * @param index   \u7d22\u5f15\n     * @throws IOException\n     */\n    public static void batchAddToElasticSearch(Map&lt;String, Object&gt; dataMap, String index) throws IOException {\n        //\u6279\u91cf\u6dfb\u52a0\n        BulkRequest bulkRequest = new BulkRequest();\n        int inc = 0;\n        for (Map.Entry&lt;String, Object&gt; data : dataMap.entrySet()) {\n            inc++;\n            Object value = data.getValue();\n            bulkRequest.add(new IndexRequest(index).id(data.getKey()).source(JSON.toJSONString(value), XContentType.JSON).opType(DocWriteRequest.OpType.INDEX));\n            if (inc &gt;= batchSize) {\n                inc = 0;\n                restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);\n            }\n        }\n        if (inc &gt;= dataMap.size() % batchSize) {\n            restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);\n        }\n    }\n\n    /**\n     * \u6570\u636e\u6dfb\u52a0\uff0c\u6b63\u5b9aID\n     *\n     * @param index \u7d22\u5f15\uff0c\u7c7b\u4f3c\u6570\u636e\u5e93\n     * @param id    \u6570\u636eID\n     * @return\n     */\n    public static String addData(String json, String index, String id) throws IOException {\n        log.info(\"Add data to cache|input:[{}]\", json);\n        IndexResponse response = restHighLevelClient.index(new IndexRequest(index).id(id).source(json, XContentType.JSON), RequestOptions.DEFAULT);\n        log.info(\"Add data to cache|output:status:[{}],id:[{}]\", response.status().getStatus(), response.getId());\n        return response.getId();\n    }\n\n\n    /**\n     * \u901a\u8fc7ID\u5220\u9664\u6570\u636e\n     *\n     * @param index \u7d22\u5f15\uff0c\u7c7b\u4f3c\u6570\u636e\u5e93\n     * @param id    \u6570\u636eID\n     */\n    public static void deleteDataById(String index, String id) throws IOException {\n        DeleteResponse response = restHighLevelClient.delete(new DeleteRequest(index, id), RequestOptions.DEFAULT);\n        log.info(\"deleteDataById response status:{},id:{}\", response.status().getStatus(), response.getId());\n    }\n\n    /**\n     * \u6839\u636e\u6761\u4ef6\u5220\u9664\u7d22\u5f15\n     *\n     * @param params\n     * @param index\n     * @throws IOException\n     */\n    public static void deleteIndexByQuery(Map&lt;String, Object&gt; params, String... index) throws IOException {\n        DeleteByQueryRequest request = new DeleteByQueryRequest(index);\n        request.setConflicts(\"proceed\");\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n        exactFieldMatch(params, boolQueryBuilder);\n        request.setQuery(boolQueryBuilder);\n        restHighLevelClient.deleteByQuery(request, RequestOptions.DEFAULT);\n    }\n\n\n    /**\n     * \u901a\u8fc7IDs\u6279\u91cf\u5220\u9664\u6570\u636e\n     *\n     * @param index \u7d22\u5f15\uff0c\u7c7b\u4f3c\u6570\u636e\u5e93\n     * @param ids   \u6570\u636eIDs\n     */\n    public static void batchDeleteData(String index, List&lt;String&gt; ids) throws IOException {\n        //\u6279\u91cf\u5220\u9664\n        BulkRequest bulkRequest = new BulkRequest();\n        int inc = 0;\n        for (String id : ids) {\n            inc++;\n            bulkRequest.add(new DeleteRequest(index, id));\n            if (inc &gt;= batchSize) {\n                inc = 0;\n                restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);\n            }\n        }\n        if (inc &gt;= ids.size() % batchSize) {\n            restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);\n        }\n    }\n\n\n    /**\n     * \u901a\u8fc7ID \u66f4\u65b0\u6570\u636e\n     *\n     * @param jsonObject \u8981\u589e\u52a0\u7684\u6570\u636e\n     * @param index      \u7d22\u5f15\uff0c\u7c7b\u4f3c\u6570\u636e\u5e93\n     * @param id         \u6570\u636eID\n     * @return\n     */\n    public static void updateDataById(String jsonObject, String index, String id) throws IOException {\n        UpdateRequest request = new UpdateRequest(index, id).doc(jsonObject, XContentType.JSON).docAsUpsert(true);\n        restHighLevelClient.update(request, RequestOptions.DEFAULT);\n    }\n\n    /**\n     * \u6279\u91cf\u66f4\u65b0\u6570\u636e\n     *\n     * @param map   \u6570\u636emap\n     * @param index \u7d22\u5f15\uff0c\u7c7b\u4f3c\u6570\u636e\u5e93\n     */\n    public static void batchUpdateData(Map&lt;String, Object&gt; map, String index) throws IOException {\n        //\u6279\u91cf\u6dfb\u52a0\n        BulkRequest bulkRequest = new BulkRequest();\n        int inc = 0;\n        for (Map.Entry&lt;String, Object&gt; data : map.entrySet()) {\n            inc++;\n            bulkRequest.add(new UpdateRequest(index, data.getKey()).doc(JSON.toJSONString(data.getValue()), XContentType.JSON).docAsUpsert(true));\n            if (inc &gt;= batchSize) {\n                inc = 0;\n                restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);\n            }\n        }\n        if (inc &gt;= map.size() % batchSize) {\n            restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);\n        }\n    }\n\n\n    /**\n     * \u6839\u636e\u6761\u4ef6\u66f4\u65b0\u7d22\u5f15\n     *\n     * @param index    \u7d22\u5f15\n     * @param painless painless\u811a\u672c\n     * @param params   \u6761\u4ef6\n     * @param data     \u6570\u636e\n     * @throws IOException\n     */\n    public static void bulkUpdateByScript(String index, String painless, Map&lt;String, Object&gt; params, Map&lt;String, Object&gt; data) throws IOException {\n        UpdateByQueryRequest request = new UpdateByQueryRequest(index);\n\n        //\u8bbe\u7f6e\u7248\u672c\u5ffd\u7565\n        request.setConflicts(\"proceed\");\n\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n\n        // \u5b8c\u5168\u5339\u914d\u8fc7\u6ee4\n        exactFieldMatch(params, boolQueryBuilder);\n\n        request.setQuery(boolQueryBuilder);\n\n        request.setScript(new Script(ScriptType.INLINE, \"painless\", painless, data));\n\n        BulkByScrollResponse bulkByScrollResponse = restHighLevelClient.updateByQuery(request, RequestOptions.DEFAULT);\n\n        //\u6253\u5370\u7684\u5185\u5bb9 \u53ef\u4ee5\u5728 Elasticsearch head \u548c Kibana  \u4e0a\u6267\u884c\u67e5\u8be2\n        log.info(\"\\n{}\", request);\n        long total = bulkByScrollResponse.getTotal();\n        log.info(\"\u66f4\u65b0\u6761\u6570\uff1a[{}]|\u5165\u53c2\uff1a[{}]\", total, params);\n    }\n\n\n    /**\n     * \u590d\u5236\u7d22\u5f15\n     *\n     * @param target \u76ee\u6807\n     * @param source \u6e90\n     * @throws IOException\n     */\n    public static void copyIndex(String target, String... source) throws IOException {\n        ReindexRequest request = new ReindexRequest();\n        request.setSourceIndices(source);\n        request.setDestDocType(\"create\");\n        request.setDestIndex(target);\n        restHighLevelClient.reindex(request, RequestOptions.DEFAULT);\n    }\n\n\n    /**\n     * \u6839\u636e\u6761\u4ef6\u66f4\u65b0\u7d22\u5f15\n     *\n     * @param index  \u7d22\u5f15\n     * @param params \u6761\u4ef6\n     * @param data   \u6570\u636e\n     * @throws IOException\n     */\n    public static void bulkUpdateByScript(String index, Map&lt;String, Object&gt; params, Map&lt;String, Object&gt; data) throws IOException {\n        EsClientUtils.bulkUpdateByScript(index, EsClientUtils.scriptBuilder(data), params, data);\n    }\n\n    public static String scriptBuilder(Map&lt;String, Object&gt; data) {\n        StringBuilder builder = new StringBuilder();\n        for (Map.Entry&lt;String, Object&gt; entry : data.entrySet()) {\n            builder.append(String.format(EsClientUtils.baseScript, entry.getKey(), entry.getKey()));\n        }\n        String script = builder.toString();\n        log.info(\"\\n script:[{}]\", script);\n        return script;\n    }\n\n    /**\n     * \u805a\u5408\u67e5\u8be2\uff08\u5c0f\u6570\u7cbe\u5ea6\u4e22\u5931\uff09\n     *\n     * @param field            \u57df\n     * @param aggregationEnums \u7c7b\u578b\n     * @param params           \u6761\u4ef6\n     * @param index            \u7d22\u5f15\n     * @return\n     * @throws IOException\n     */\n    public static BigDecimal aggregationByQuery(String field, AggregationEnums aggregationEnums, Map&lt;String, Object&gt; params, String... index) throws IOException {\n        SearchRequest request = new SearchRequest(index);\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder()\n                .size(0)\n                .aggregation(aggregationEnums.getAggregationBuilder().field(field));\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n        exactFieldMatch(params, boolQueryBuilder);\n        searchSourceBuilder.query(boolQueryBuilder);\n        request.source(searchSourceBuilder);\n        //\u6253\u5370\u7684\u5185\u5bb9 \u53ef\u4ee5\u5728 Kibana  \u4e0a\u6267\u884c\u67e5\u8be2\n        log.info(\"\\n{}\", searchSourceBuilder);\n        SearchResponse search = restHighLevelClient.search(request, RequestOptions.DEFAULT);\n        NumericMetricsAggregation.SingleValue maxTemperature = search.getAggregations().get(aggregationEnums.getCode());\n        return new BigDecimal(maxTemperature.value());\n    }\n\n    /**\n     * @param index          \u7d22\u5f15\u540d\u79f0\n     * @param page           \u5f53\u524d\u9875\uff08\u6df1\u5ea6\u5206\u9875\u8bf7\u8003\u8651scroll\uff09\n     * @param size           \u6bcf\u9875\u6761\u6570\n     * @param highlightField \u9ad8\u4eae\n     * @param params         \u6761\u4ef6\n     * @param sorts          \u6392\u5e8f\n     * @param rangeParams    \u8303\u56f4\n     * @param matchParams    \u5168\u6587\u68c0\u7d22\n     * @param isFuzzy        \u662f\u5426\u5206\u8bcd\n     * @return\n     * @throws IOException\n     */\n    public static EsPageResult searchDataPage(String index,\n                                              int page,\n                                              int size,\n                                              String highlightField,\n                                              Map&lt;String, Object&gt; params,\n                                              Map&lt;String, SortOrder&gt; sorts,\n                                              Map&lt;String, Map&lt;EsRangeEnums, Object&gt;&gt; rangeParams,\n                                              Map&lt;String, Object&gt; matchParams,\n                                              boolean isFuzzy) throws IOException {\n\n        SearchRequest searchRequest = new SearchRequest(index);\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n\n        // \u5b8c\u5168\u5339\u914d\u8fc7\u6ee4\n        exactFieldMatch(params, boolQueryBuilder);\n\n        //\u5168\u6587\u68c0\u7d22\n        fuzzyFieldSearch(matchParams, boolQueryBuilder, isFuzzy);\n\n        //\u6392\u5e8f\n        sortByField(sorts, searchSourceBuilder);\n\n        //\u9ad8\u4eae\n        setHighlightField(highlightField, searchSourceBuilder);\n\n        //\u8303\u56f4\u67e5\u8be2\n        rangeByField(boolQueryBuilder, rangeParams);\n\n        page = Math.max(page, 0);\n        size = Math.max(size, 1);\n\n        searchSourceBuilder.query(boolQueryBuilder).from(page).size(size);\n        searchRequest.source(searchSourceBuilder);\n        SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);\n\n        //\u6253\u5370\u7684\u5185\u5bb9 \u53ef\u4ee5\u5728 Kibana  \u4e0a\u6267\u884c\u67e5\u8be2\n        log.info(\"\\n{}\", searchSourceBuilder);\n        return handleResponseOfData(searchResponse, page, size, highlightField);\n    }\n\n    private static void rangeByField(BoolQueryBuilder boolQueryBuilder, Map&lt;String, Map&lt;EsRangeEnums, Object&gt;&gt; rangeParams) {\n        for (Map.Entry&lt;String, Map&lt;EsRangeEnums, Object&gt;&gt; entry : rangeParams.entrySet()) {\n            boolQueryBuilder.must(QueryBuilders.rangeQuery(entry.getKey())\n                    .from(entry.getValue().get(EsRangeEnums.START))\n                    .to(entry.getValue().get(EsRangeEnums.END)));\n        }\n    }\n\n    private static void setHighlightField(String highlightField, SearchSourceBuilder searchSourceBuilder) {\n        if (StringUtils.isNotBlank(highlightField)) {\n            HighlightBuilder highlightBuilder = new HighlightBuilder();\n            highlightBuilder.preTags(EsClientUtils.EsPreTags);\n            highlightBuilder.postTags(EsClientUtils.EsPostTags);\n            highlightBuilder.field(highlightField);\n            searchSourceBuilder.highlighter(highlightBuilder);\n        }\n    }\n\n    private static void sortByField(Map&lt;String, SortOrder&gt; sorts, SearchSourceBuilder searchSourceBuilder) {\n        for (Map.Entry&lt;String, SortOrder&gt; entry : sorts.entrySet()) {\n            searchSourceBuilder.sort(entry.getKey(), entry.getValue());\n        }\n    }\n\n    private static void fuzzyFieldSearch(Map&lt;String, Object&gt; matchParams, BoolQueryBuilder boolQueryBuilder, boolean isFuzzy) {\n        for (Map.Entry&lt;String, Object&gt; entry : matchParams.entrySet()) {\n            if (isFuzzy) {\n                boolQueryBuilder.should(QueryBuilders.matchQuery(entry.getKey(), entry.getValue()));\n            } else {\n                boolQueryBuilder.should(QueryBuilders.matchPhraseQuery(entry.getKey(), entry.getValue()));\n            }\n        }\n    }\n\n    private static void exactFieldMatch(Map&lt;String, Object&gt; params, BoolQueryBuilder boolQueryBuilder) {\n        for (Map.Entry&lt;String, Object&gt; entry : params.entrySet()) {\n            boolQueryBuilder.filter(QueryBuilders.termQuery(entry.getKey(), entry.getValue()));\n        }\n    }\n\n    private static EsPageResult handleResponseOfData(SearchResponse searchResponse, int page, int size, String highlightField) {\n        if (Objects.equals(RestStatus.OK, searchResponse.status())) {\n\n            JSONArray jsonArray = new JSONArray();\n\n            SearchHits hits = searchResponse.getHits();\n\n            long rowTotal = hits.getTotalHits().value;\n\n            long pageTotal = (rowTotal % size == 0) ? rowTotal / size : rowTotal / size + 1;\n\n            for (SearchHit hit : hits) {\n\n                if (StringUtils.isNotBlank(highlightField)) {\n\n                    Text[] text = hit.getHighlightFields().get(highlightField).getFragments();\n\n                    if (text != null) {\n                        for (Text str : text) {\n                            //\u904d\u5386 \u9ad8\u4eae\u7ed3\u679c\u96c6\uff0c\u8986\u76d6 \u6b63\u5e38\u7ed3\u679c\u96c6\n                            hit.getSourceAsMap().put(highlightField, str.string());\n                        }\n                    }\n                }\n                jsonArray.add(hit.getSourceAsMap());\n            }\n\n            return EsPageResult.builder().pages(pageTotal).current(page).total(rowTotal).pageSize(size).dataJson(jsonArray.toJSONString()).build();\n        }\n        return null;\n    }\n\n\n    /**\n     * @param index  \u7d22\u5f15\u540d\u79f0\n     * @param params \u6761\u4ef6\n     * @param page   \u5f53\u524d\u9875\n     * @param size   \u6bcf\u9875\u663e\u793a\u6761\u6570\n     * @return\n     * @throws IOException\n     */\n    public static EsPageResult searchDataPage(String index, Map&lt;String, Object&gt; params, int page, int size) throws IOException {\n        return searchDataPage(index, page, size, StringUtils.EMPTY, params, Collections.emptyMap(), Collections.emptyMap(), Collections.emptyMap(), false);\n    }\n\n\n    /**\n     * @param params \u6761\u4ef6\n     * @param index  \u7d22\u5f15\u540d\u79f0\n     * @param page   \u5f53\u524d\u9875\n     * @param size   \u6bcf\u9875\u663e\u793a\u6761\u6570\n     * @param sorts  \u6392\u5e8f\n     * @return\n     * @throws IOException\n     */\n    public static EsPageResult searchDataPage(String index, Map&lt;String, Object&gt; params, int page, int size, Map&lt;String, SortOrder&gt; sorts) throws IOException {\n        return searchDataPage(index, page, size, StringUtils.EMPTY, Collections.emptyMap(), sorts, Collections.emptyMap(), Collections.emptyMap(), false);\n    }\n\n    /**\n     * @param params \u6761\u4ef6\n     * @param index  \u7d22\u5f15\u540d\u79f0\n     * @param page   \u5f53\u524d\u9875\n     * @param size   \u6bcf\u9875\u663e\u793a\u6761\u6570\n     * @param sorts  \u6392\u5e8f\n     * @return\n     * @throws IOException\n     */\n    public static EsPageResult searchDataPage(String index,\n                                              int page,\n                                              int size, Map&lt;String, Object&gt; params,\n                                              Map&lt;String, Map&lt;EsRangeEnums, Object&gt;&gt; rangeParams,\n                                              Map&lt;String, SortOrder&gt; sorts) throws IOException {\n        return searchDataPage(index, page, size, StringUtils.EMPTY, params, sorts, rangeParams, Collections.emptyMap(), false);\n    }\n\n\n    /**\n     * \u8303\u56f4\u67e5\u8be2,\u5e76\u5206\u9875\n     *\n     * @param index       \u7d22\u5f15\u540d\u79f0\n     * @param rangeParams \u8303\u56f4\n     * @param page        \u5f53\u524d\u9875\n     * @param size        \u6bcf\u9875\u663e\u793a\u6761\u6570\n     * @return\n     * @throws IOException\n     */\n    public static EsPageResult searchDataPageByRange(String index, Map&lt;String, Map&lt;EsRangeEnums, Object&gt;&gt; rangeParams, int page, int size) throws IOException {\n        return searchDataPage(index, page, size, StringUtils.EMPTY, Collections.emptyMap(), Collections.emptyMap(), rangeParams, Collections.emptyMap(), false);\n    }\n\n    /**\n     * @param index       \u7d22\u5f15\u540d\u79f0\n     * @param rangeParams \u8303\u56f4\n     * @param page        \u5f53\u524d\u9875\n     * @param size        \u6bcf\u9875\u663e\u793a\u6761\u6570\n     * @param sorts       \u6392\u5e8f\n     * @return\n     * @throws IOException\n     */\n    public static EsPageResult searchDataPageByRange(String index, Map&lt;String, Map&lt;EsRangeEnums, Object&gt;&gt; rangeParams, int page, int size, Map&lt;String, SortOrder&gt; sorts) throws IOException {\n        return searchDataPage(index, page, size, StringUtils.EMPTY, Collections.emptyMap(), sorts, rangeParams, Collections.emptyMap(), false);\n    }\n\n    /**\n     * \u6761\u4ef6\u8303\u56f4\u67e5\u8be2,\u5e76\u5206\u9875\n     *\n     * @param index       \u7d22\u5f15\u540d\u79f0\n     * @param params      \u6761\u4ef6\n     * @param rangeParams \u8303\u56f4\n     * @param page        \u5f53\u524d\u9875\n     * @param size        \u6bcf\u9875\u663e\u793a\u6761\u6570\n     * @return\n     * @throws IOException\n     */\n    public static EsPageResult searchDataPageByRange(String index, Map&lt;String, Object&gt; params, Map&lt;String, Map&lt;EsRangeEnums, Object&gt;&gt; rangeParams, int page, int size) throws IOException {\n        return searchDataPage(index, page, size, StringUtils.EMPTY, params, Collections.emptyMap(), rangeParams, Collections.emptyMap(), false);\n    }\n\n\n    /**\n     * @param index       \u7d22\u5f15\u540d\u79f0\n     * @param matchParams \u5168\u6587\u68c0\u7d22\u6761\u4ef6\n     * @param page        \u5f53\u524d\u9875\n     * @param size        \u6bcf\u9875\u663e\u793a\u6761\u6570\n     * @param isFuzzy     \u662f\u5426\u5206\u8bcd\n     * @param sorts       \u6392\u5e8f\n     * @return\n     * @throws IOException\n     */\n    public static EsPageResult searchDataPageByMatch(String index, Map&lt;String, Object&gt; matchParams, int page, int size, boolean isFuzzy, Map&lt;String, SortOrder&gt; sorts) throws IOException {\n        return searchDataPage(index, page, size, StringUtils.EMPTY, Collections.emptyMap(), sorts, Collections.emptyMap(), matchParams, isFuzzy);\n    }\n\n    /**\n     * @param index       \u7d22\u5f15\u540d\u79f0\n     * @param matchParams \u5168\u6587\u68c0\u7d22\u6761\u4ef6\n     * @param page        \u5f53\u524d\u9875\n     * @param size        \u6bcf\u9875\u663e\u793a\u6761\u6570\n     * @param isFuzzy     \u662f\u5426\u5206\u8bcd\n     * @return\n     * @throws IOException\n     */\n    public static EsPageResult searchDataPageByMatch(String index, Map&lt;String, Object&gt; matchParams, int page, int size, boolean isFuzzy) throws IOException {\n        return searchDataPage(index, page, size, StringUtils.EMPTY, Collections.emptyMap(), Collections.emptyMap(), Collections.emptyMap(), matchParams, isFuzzy);\n    }\n\n\n    /**\n     * @param index          \u7d22\u5f15\u540d\u79f0\n     * @param matchParams    \u5168\u6587\u68c0\u7d22\u6761\u4ef6\n     * @param highlightField \u9ad8\u4eae\u5b57\u6bb5\n     * @param page           \u5f53\u524d\u9875\n     * @param size           \u6bcf\u9875\u663e\u793a\u6761\u6570\n     * @param isFuzzy        \u662f\u5426\u5206\u8bcd\n     * @return\n     * @throws IOException\n     */\n    public static EsPageResult searchDataPageByMatch(String index, Map&lt;String, Object&gt; matchParams, String highlightField, int page, int size, boolean isFuzzy) throws IOException {\n        return searchDataPage(index, page, size, highlightField, Collections.emptyMap(), Collections.emptyMap(), Collections.emptyMap(), matchParams, isFuzzy);\n    }\n\n    /**\n     * \u8303\u56f4\u6784\u5efa\u5668\n     *\n     * @param rangeStart\n     * @param rangeEnd\n     * @return\n     */\n    public static Map&lt;EsRangeEnums, Object&gt; range(Object rangeStart, Object rangeEnd) {\n        HashMap&lt;EsRangeEnums, Object&gt; rangeMap = new HashMap&lt;&gt;(0x10);\n        rangeMap.put(EsRangeEnums.START, rangeStart);\n        rangeMap.put(EsRangeEnums.END, rangeEnd);\n        return rangeMap;\n    }\n\n    public static Map&lt;String, Map&lt;EsRangeEnums, Object&gt;&gt; rangeBuilder() {\n        return new HashMap&lt;&gt;(0x10);\n    }\n</code></pre>"},{"location":"Grafana%20%E4%BD%BF%E7%94%A8%20Elasticsearch%20%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E6%BA%90/","title":"Grafana \u6570\u636e\u53ef\u89c6\u5316\u76d1\u63a7","text":"<p>Grafana\u662f\u7528\u4e8e\u53ef\u89c6\u5316\u5927\u578b\u6d4b\u91cf\u6570\u636e\u7684\u5f00\u6e90\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u53ef\u89c6\u5316\u5de5\u5177\uff0c\u53ea\u6709\u914d\u7f6e\u4e86\u5bf9\u5e94\u7684\u6570\u636e\u6e90\uff0c\u901a\u8fc7\u7b80\u5355\u7684\u914d\u7f6e\u4fbf\u53ef\u4ee5\u8fbe\u5230\u7cbe\u81f4\u7684\u56fe\u6807\u5c55\u793a\uff0cGrafana\u4e13\u6ce8\u4e8e\u65f6\u5e8f\u7c7b\u56fe\u8868\u5206\u6790\uff0c\u800c\u4e14\u652f\u6301\u591a\u79cd\u6570\u636e\u6e90\uff0c\u5982Graphite\u3001InfluxDB\u3001Elasticsearch\u3001Mysql\u3001K8s\u3001Zabbix\u7b49\uff0c\u53ef\u4ee5\u914d\u5408Elastic Search \u505a\u65e5\u5fd7\u57cb\u70b9\uff0c\u8fdb\u884c\u7528\u6237\u884c\u4e3a\u5206\u6790\u3002</p>"},{"location":"Grafana%20%E4%BD%BF%E7%94%A8%20Elasticsearch%20%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E6%BA%90/#grafana_1","title":"\u4e0b\u8f7d\u5b89\u88c5 Grafana","text":"<p>\u5b98\u7f51\u4e0b\u8f7d</p> <p>https://grafana.com/grafana/download</p> <p>yum \u547d\u4ee4\u5b89\u88c5</p> <pre><code>yum localinstall grafana-7.3.5-1.x86_64.rpm\n</code></pre> <p>\u542f\u52a8</p> <pre><code>ystemctl start grafana-server.service\n</code></pre> <p>\u67e5\u770b\u7aef\u53e3\uff08\u9ed8\u8ba43000\uff09</p> <pre><code>netstat -lpnt|grep grafana\n</code></pre> <p>\u67e5\u770b\u65e5\u5fd7</p> <pre><code>tail -f /var/log/grafana/grafana.log -n 100\n</code></pre>"},{"location":"Grafana%20%E4%BD%BF%E7%94%A8%20Elasticsearch%20%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E6%BA%90/#grafana-elasticsearch","title":"Grafana \u4f7f\u7528 Elasticsearch \u4f5c\u4e3a\u6570\u636e\u6e90","text":"<p>\u9009\u62e9\u65b0\u589e\u6570\u636e\u6e90 </p> <p>\u9009\u62e9\u6570\u636e\u6e90\u4e3aElastic Search </p> <p> \u914d\u7f6e\u6570\u636e\u6e90\u76f8\u5173\u8fde\u63a5\u4fe1\u606f </p> <p>\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u56fe\u8868 </p>"},{"location":"Grafana%20%E4%BD%BF%E7%94%A8%20Elasticsearch%20%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E6%BA%90/#_1","title":"\u914d\u7f6e\u56fe\u8868\u53c2\u6570","text":"<ol> <li>\u9009\u62e9\u6570\u636e\u6e90</li> <li>\u67e5\u8be2\u5185\u5bb9</li> <li>\u5206\u7ec4\u65b9\u5f0f\uff0c\u6839\u636eElastic Search \u7d22\u5f15\u4e2d\u7684\u5b57\u6bb5\u5206\u7ec4</li> <li>\u9009\u62e9\u65f6\u95f4\u8303\u56f4</li> <li>\u9009\u62e9\u56fe\u6807\u6837\u5f0f </li> </ol> <p>\u76f8\u5173\u8c03\u8bd5\uff0c\u5728Query inspector \u4e2d\u53ef\u4ee5\u62ff\u5230\u5bf9\u5e94Elastic Search\u8bed\u53e5\u653e\u5230Kibana \u4e2d\u53bb\u6267\u884c\uff0c\u68c0\u6d4b\u81ea\u5df1\u662f\u5426\u914d\u7f6e\u9519\u8bef\uff0c\u800c\u5bfc\u81f4\u56fe\u8868\u65e0\u6cd5\u5448\u73b0 </p>"},{"location":"JAVA%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E6%96%B9%E5%BC%8F%E6%95%88%E7%8E%87%E5%AF%B9%E6%AF%94/","title":"JAVA\u6587\u4ef6\u89e3\u538b\u5927\u6587\u4ef6\u6548\u7387\u5bf9\u6bd4","text":""},{"location":"JAVA%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E6%96%B9%E5%BC%8F%E6%95%88%E7%8E%87%E5%AF%B9%E6%AF%94/#_1","title":"\u672c\u673a\u73af\u5883","text":"<p>\u578b\u53f7\u540d\u79f0\uff1a    MacBook Pro         \u578b\u53f7\u6807\u8bc6\u7b26\uff1a   MacBookPro17,1      \u82af\u7247\uff1a  Apple M1    \u6838\u603b\u6570\uff1a 8\uff084\u6027\u80fd\u548c4\u6548\u7387\uff09  \u5185\u5b58\uff1a  16 GB   \u89e3\u538b\u6587\u4ef6\u5927\u5c0f\uff1a  1.31 GB    JDK 11</p>"},{"location":"JAVA%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E6%96%B9%E5%BC%8F%E6%95%88%E7%8E%87%E5%AF%B9%E6%AF%94/#bufferdinputstream","title":"\u4f7f\u7528BufferdInputStream","text":"<pre><code>private static void unzipByStream(String source,String target) throws IOException {\n    ZipFile zf = new ZipFile(source);\n    List&lt;String&gt; collectPath = Collections.list(zf.getEntries()).stream().filter(ze -&gt; !ze.isDirectory()&amp;&amp;!ze.getName()\n                    .startsWith(\"__MACOSX\")).map(org.apache.tools.zip.ZipEntry::getName)\n            .collect(Collectors.toList());\n    for (String fileName : collectPath) {\n        InputStream inputStream = zf.getInputStream(zf.getEntry(fileName));\n        BufferedInputStream bufferedInputStream = new BufferedInputStream(inputStream);\n        OutputStream outputStream = new FileOutputStream(target + getFullName(fileName));\n\n        byte[] buffer = new byte[1048576];\n        int read;\n        while ((read = bufferedInputStream.read(buffer, 0, buffer.length)) != -1) {\n            outputStream.write(buffer, 0, read);\n        }\n    }\n    zf.close();\n}\n</code></pre>"},{"location":"JAVA%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E6%96%B9%E5%BC%8F%E6%95%88%E7%8E%87%E5%AF%B9%E6%AF%94/#apachetoolsant","title":"\u4f7f\u7528apache.tools.ant\u5de5\u5177\u5305","text":"<pre><code>public static void unzipByApacheTools(String zipFilepath, String destDir) throws Exception {\n    Project proj = new Project();\n    Expand expand = new Expand();\n    expand.setProject(proj);\n    expand.setTaskType(\"unzip\");\n    expand.setTaskName(\"unzip\");\n    expand.setEncoding(\"UTF-8\");\n    expand.setSrc(new File(zipFilepath));\n    expand.setDest(new File(destDir));\n    expand.execute();\n}\n</code></pre> <p>\u8017\u65f6\u5bf9\u6bd4</p> <pre><code>StopWatch '\u6587\u4ef6\u89e3\u538b\u8017\u65f6': running time = 26057948833 ns\n---------------------------------------------\nns         %     Task name\n---------------------------------------------\n16170785417  062%  apache.tools.ant\n9887163416  038%  bufferedStream\n</code></pre>"},{"location":"JAVA%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8B%E6%96%B9%E5%BC%8F%E6%95%88%E7%8E%87%E5%AF%B9%E6%AF%94/#_2","title":"\u7ed3\u8bba\uff1a","text":"<p>\u5171\u8017\u65f6 26s \u5de6\u53f3\uff0cBufferdInputStream\u8017\u65f6 9s\uff0capache.tools.ant \u8017\u65f6 13s</p> <p>Expand \u89e3\u538b\u65b9\u5f0f\u7f16\u7801\u66f4\u7b80\u5355\uff0c\u4f46\u662fBufferedInputStream\u89e3\u538b\u5927\u6587\u4ef6\u7684\u6548\u7387\u6bd4\u4f7f\u7528apache.tools.ant\u63d0\u4f9b\u7684Expand\u65b9\u5f0f\u6548\u7387\u8981\u5feb1\u500d\u4ee5\u4e0a\u3002</p>"},{"location":"Kubernetes%E4%BD%BF%E7%94%A8Arthas/","title":"Kubernetes\u4f7f\u7528Arthas","text":""},{"location":"Kubernetes%E4%BD%BF%E7%94%A8Arthas/#kubectl","title":"\u9996\u5148\u5148\u5b89\u88c5kubectl","text":"<p>\u4e0b\u8f7d\u5730\u5740</p> <p>\u5c06\u4ee5\u4e0b\u5185\u5bb9\u590d\u5236\u5230\u8ba1\u7b97\u673a $HOME/.kube/config \u6587\u4ef6\u4e0b\uff08\u963f\u91cc\u4e91\u5bb9\u5668\u5185\u73af\u5883\u51ed\u8bc1\uff0c\u5bb9\u5668\u670d\u52a1-\u8fde\u63a5\u4fe1\u606f\uff09</p> <p></p> <p>\u901a\u8fc7 <code>kubectl get pod</code>\u83b7\u53d6\u7aef\u53e3\uff0c\u9009\u62e9\u670d\u52a1\u5668\uff0c<code>kubectl exec -it pod bash</code> \u542f\u52a8\u670d\u52a1\u5668</p>"},{"location":"Kubernetes%E4%BD%BF%E7%94%A8Arthas/#arthas","title":"\u5bb9\u5668\u5185\u5b89\u88c5\u5e76\u542f\u52a8arthas","text":"<pre><code>curl -O https://arthas.aliyun.com/arthas-boot.jar\njava -jar arthas-boot.jarcurl -O https://arthas.aliyun.com/arthas-boot.jar\njava -jar arthas-boot.jar\n</code></pre> <p>\u5207\u6362k8s\u73af\u5883\u53d8\u91cf</p> <pre><code>export KUBECONFIG=$KUBECONFIG:$HOME/.kube/config\n</code></pre> <p>\u67e5\u770bk8s\u914d\u7f6e</p> <pre><code>Kubectl config view\n</code></pre>"},{"location":"MESI%E5%8D%8F%E8%AE%AE%E4%B8%8EMOESI%E5%8D%8F%E8%AE%AE/","title":"MESI\u534f\u8bae\u4e0eMOESI\u534f\u8bae","text":""},{"location":"MESI%E5%8D%8F%E8%AE%AE%E4%B8%8EMOESI%E5%8D%8F%E8%AE%AE/#cpu","title":"cpu\u591a\u6838\u5de5\u4f5c\u65b9\u5f0f","text":"<p>CPU\u6267\u884c\u4e3a\u4e86\u63d0\u9ad8\u6548\u7387\uff0c\u4f1a\u5411\u4e3b\u5185\u5b58\u4e2d\u540c\u6b65\u6570\u636e\u5728\u81ea\u5df1\u7684\u5de5\u4f5c\u526f\u672c\u4e2d\uff0c\u5982\u4e0b\u56fe\u6240\u793a  \u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2aCPU\u5728\u5904\u7406\u6570\u636e\u7684\u65f6\u5019\u5c31\u4e0d\u514d\u4f1a\u9020\u6210\u7f13\u5b58\u548c\u4e3b\u5b58\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff0c \u4e3a\u4e86\u89e3\u51b3\u591a\u6838cpu\u7f13\u5b58\u4e0d\u4e00\u81f4\u9020\u6210\u7684\u6570\u636e\u95ee\uff0cMESI\u534f\u8bae\u4e0eMOESI\u534f\u8bae\u7531\u6b64\u8bde\u751f\uff0cMOESI\u4e3aMESI\u7684\u884d\u751f\uff0c\u591a\u4e86\u4e00\u79cd\u72b6\u6001\uff0c\u6548\u7387\u8981\u8fdc\u9ad8\u4e8eMESI\u534f\u8bae\uff0c\u73b0\u7edd\u5927\u591a\u6570 ARM \u5904\u7406\u5668\u4f7f\u7528 MOESI \u534f\u8bae\uff0cCortex-A9 \u5219\u4f7f\u7528 MESI \u534f\u8bae\u3002</p>"},{"location":"MESI%E5%8D%8F%E8%AE%AE%E4%B8%8EMOESI%E5%8D%8F%E8%AE%AE/#mesi","title":"MESI\u534f\u8bae","text":"<p>MESI\u534f\u8bae\u4e3b\u8981\u662f\u56db\u4e2a\u5173\u952e\u5b57\u7684\u7f29\u5199</p> <pre><code>M\uff1a\u4ee3\u8868\u5df2\u4fee\u6539\uff08Modified\uff09\n\nE\uff1a\u4ee3\u8868\u72ec\u5360\uff08Exclusive\uff09\n\nS\uff1a\u4ee3\u8868\u5171\u4eab\uff08Shared\uff09\n\nI\uff1a\u4ee3\u8868\u5df2\u5931\u6548\uff08Invalidated\uff09\n</code></pre> <ol> <li> <p>\u5df2\u4fee\u6539\uff08Modified\uff09\u7f13\u5b58\u6bb5\uff0c\u5c5e\u4e8e\u810f\u6bb5\uff0c\u5df2\u7ecf\u88ab\u6240\u5c5e\u7684\u5904\u7406\u5668\u4fee\u6539\u4e86\u3002\u4f46\u662f\u8fd8\u6ca1\u6709\u5199\u4f1a\u4e3b\u5185\u5b58\u4e2d\uff0c\u5982\u679c\u4e00\u4e2a\u6bb5\u5904\u4e8e\u5df2\u4fee\u6539\u72b6\u6001\uff0c\u90a3\u4e48\u5b83\u5728\u5176\u4ed6\u5904\u7406\u5668\u7f13\u5b58\u4e2d\u7684\u62f7\u8d1d\u9a6c\u4e0a\u4f1a\u53d8\u6210\u5931\u6548\u72b6\u6001\uff0c\u8fd9\u4e2a\u89c4\u5f8b\u548cE\u72b6\u6001\u4e00\u6837\u3002\u6b64\u5916\uff0c\u5df2\u4fee\u6539\u7f13\u5b58\u6bb5\u5982\u679c\u88ab\u4e22\u5f03\u6216\u6807\u8bb0\u4e3a\u5931\u6548\uff0c\u90a3\u4e48\u5148\u8981\u628a\u5b83\u7684\u5185\u5bb9\u56de\u5199\u5230\u5185\u5b58\u4e2d</p> </li> <li> <p>\u72ec\u5360\uff08Exclusive\uff09\u7f13\u5b58\u6bb5\uff0c\u548cS\u72b6\u6001\u4e00\u6837\uff0c\u548c\u4e3b\u5185\u5b58\u5185\u5bb9\u4fdd\u6301\u4e00\u81f4\u7684\u4e00\u4efd\u62f7\u8d1d\u3002\u533a\u522b\u5728\u4e8e\uff0c\u5982\u679c\u4e00\u4e2a\u5904\u7406\u5668\u6301\u6709\u4e86\u67d0\u4e2aE\u72b6\u6001\u7684\u7f13\u5b58\u6bb5\uff0c\u90a3\u5176\u4ed6\u5904\u7406\u5668\u5c31\u4e0d\u80fd\u540c\u65f6\u6301\u6709\u5b83\uff0c\u6240\u4ee5\u53eb\u201c\u72ec\u5360\u201d\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u5176\u4ed6\u5904\u7406\u5668\u539f\u672c\u4e5f\u6301\u6709\u540c\u4e00\u7f13\u5b58\u6bb5\uff0c\u90a3\u4e48\u5b83\u4f1a\u9a6c\u4e0a\u53d8\u6210\u201c\u5931\u6548\u201d\u72b6\u6001\u3002</p> </li> <li> <p>\u5171\u4eab\uff08Shared\uff09\u7f13\u5b58\u6bb5\uff0c\u5b83\u662f\u548c\u4e3b\u5185\u5b58\u5185\u5bb9\u4fdd\u6301\u4e00\u81f4\u7684\u4e00\u4efd\u62f7\u8d1d\uff0c\u5728\u8fd9\u79cd\u72b6\u6001\u4e0b\u7684\u7f13\u5b58\u6bb5\u53ea\u80fd\u88ab\u8bfb\u53d6\uff0c\u4e0d\u80fd\u88ab\u5199\u5165\u3002\u591a\u7ec4\u7f13\u5b58\u53ef\u4ee5\u540c\u65f6\u62e5\u6709\u9488\u5bf9\u540c\u4e00\u5185\u5b58\u5730\u5740\u7684\u5171\u4eab\u7f13\u5b58\u6bb5\uff0c\u8fd9\u5c31\u662f\u540d\u79f0\u7684\u7531\u6765\u3002</p> </li> <li>\u5931\u6548\uff08Invalid\uff09\u7f13\u5b58\u6bb5\uff0c\u8981\u4e48\u5df2\u7ecf\u4e0d\u5728\u7f13\u5b58\u4e2d\uff0c\u8981\u4e48\u5b83\u7684\u5185\u5bb9\u5df2\u7ecf\u8fc7\u65f6\u3002\u4e3a\u4e86\u8fbe\u5230\u7f13\u5b58\u7684\u76ee\u7684\uff0c\u8fd9\u79cd\u72b6\u6001\u7684\u6bb5\u5c06\u4f1a\u88ab\u5ffd\u7565\u3002\u4e00\u65e6\u7f13\u5b58\u6bb5\u88ab\u6807\u8bb0\u4e3a\u5931\u6548\uff0c\u90a3\u6548\u679c\u5c31\u7b49\u540c\u4e8e\u5b83\u4ece\u6765\u6ca1\u88ab\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d\u3002\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d\uff0c\u8fd9\u4e2a\u662f\u521d\u59cb\u72b6\u6001</li> </ol> <p>\u4e3e\u4f8b\u8bf4\u660e\uff1a</p> <p>\u7b2c\u4e00\u6b65\uff1a\u5f53cpu 1 \u5c06\u4e3b\u5185\u5b58\u4e2d\u7684\u6570\u636ex data \u653e\u5165\u81ea\u8eab\u5185\u5b58\u526f\u672c\u4e2d\uff0c\u8be5\u5185\u5b58\u526f\u672c\u7684\u72b6\u6001\u4e3aE\u72ec\u5360\u3002</p> <p>\u7b2c\u4e8c\u6b65\uff1a\u5f53cpu 2 \u4e5f\u5c06\u4e3b\u5185\u5b58\u7684\u6570\u636ex data \u653e\u5165\u81ea\u8eab\u5185\u5b58\u526f\u672c\u4e2d\uff0c\u6839\u636e\u55c5\u63a2\u673a\u5236 cpu1\u4e0ecpu2\u77e5\u9053x data\u6570\u636e\u5e76\u4e0d\u662f\u53ea\u6709\u81ea\u8eab\u4e00\u4efd\u65f6\uff0ccpu 1\u4e0ecpu 2\u5185\u5b58\u526f\u672c\u7684\u72b6\u6001\u53d8\u4e3aS\u5171\u4eab\u3002</p> <p>\u7b2c\u4e09\u6b65\uff1a\u5f53cpu 1\u4fee\u6539 x data\u7684\u6570\u636e\u65f6\u5019\uff0ccpu 1\u5de5\u4f5c\u526f\u672c\u7684\u72b6\u6001\u53d8\u4e3aM\u4fee\u6539\uff0c\u5e76\u901a\u77e5\u5230 cpu 2 \u4f7f\u5176\u72b6\u6001\u53d8\u4e3aI\u65e0\u6548</p> <p>\u6700\u540e\u4e00\u6b65\uff1a\u5f53cpu 1\u786e\u8ba4\u9664\u81ea\u8eab\u6240\u6709cpu\u7f13\u5b58\u4e2d\u90fd\u53d8\u4e3aI\u65e0\u6548\u72b6\u6001\uff0c\u4fbf\u4fee\u6539\u540e\u7684\u503c\u5237\u65b0\u5230\u4e3b\u5b58\u4e2d\uff0c\u5e76\u5c06\u81ea\u8eab cpu 1\u7684\u72b6\u6001\u53d8\u4e3aE\u72ec\u5360\u3002 \u4f9d\u6b21\u5f80\u590d</p>"},{"location":"MESI%E5%8D%8F%E8%AE%AE%E4%B8%8EMOESI%E5%8D%8F%E8%AE%AE/#moesi","title":"MOESI\u534f\u8bae","text":"<p>MOESI\u534f\u8bae\u4e0eMOESI\u534f\u8bae\u76f8\u6bd4\u591a\u5f15\u5165\u4e86\u4e00\u4e2aO(Owned)\u72b6\u6001\uff0c\u5e76\u5728MESI\u534f\u8bae\u7684\u57fa\u7840\u4e0a\uff0c\u8fdb\u884c\u4e86\u91cd\u65b0\u5b9a\u4e49\u4e86S\u72b6\u6001\uff0c\u800cE\u3001M\u548cI\u72b6\u6001\u548cMESI\u534f\u8bae\u7684\u5bf9\u5e94\u72b6\u6001\u76f8\u540c\u3002</p> <ol> <li> <p>O\u4f4d\u3002O\u4f4d\u4e3a1\u8868\u793a\u5728\u5f53\u524dCache \u884c\u4e2d\u5305\u542b\u7684\u6570\u636e\u662f\u5f53\u524d\u5904\u7406\u5668\u7cfb\u7edf\u6700\u65b0\u7684\u6570\u636e\u62f7\u8d1d\uff0c\u800c\u4e14\u5728\u5176\u4ed6CPU\u4e2d\u4e00\u5b9a\u5177\u6709\u8be5Cache\u884c\u7684\u526f\u672c\uff0c\u5176\u4ed6CPU\u7684Cache\u884c\u72b6\u6001\u4e3aS\u3002\u5982\u679c\u4e3b\u5b58\u50a8\u5668\u7684\u6570\u636e\u5728\u591a\u4e2aCPU\u7684Cache\u4e2d\u90fd\u5177\u6709\u526f\u672c\u65f6\uff0c\u6709\u4e14\u4ec5\u6709\u4e00\u4e2aCPU\u7684Cache\u884c\u72b6\u6001\u4e3aO\uff0c\u5176\u4ed6CPU\u7684Cache\u884c\u72b6\u6001\u53ea\u80fd\u4e3aS\u3002\u4e0eMESI\u534f\u8bae\u4e2d\u7684S\u72b6\u6001\u4e0d\u540c\uff0c\u72b6\u6001\u4e3aO\u7684Cache\u884c\u4e2d\u7684\u6570\u636e\u4e0e\u5b58\u50a8\u5668\u4e2d\u7684\u6570\u636e\u5e76\u4e0d\u4e00\u81f4\u3002</p> </li> <li> <p>S\u4f4d\u3002\u5728MOESI\u534f\u8bae\u4e2d\uff0cS\u72b6\u6001\u7684\u5b9a\u4e49\u53d1\u751f\u4e86\u7ec6\u5fae\u7684\u53d8\u5316\u3002\u5f53\u4e00\u4e2aCache\u884c\u72b6\u6001\u4e3aS\u65f6\uff0c\u5176\u5305\u542b\u7684\u6570\u636e\u5e76\u4e0d\u4e00\u5b9a\u4e0e\u5b58\u50a8\u5668\u4e00\u81f4\u3002\u5982\u679c\u5728\u5176\u4ed6CPU\u7684Cache\u4e2d\u4e0d\u5b58\u5728\u72b6\u6001\u4e3aO\u7684\u526f\u672c\u65f6\uff0c\u8be5Cache\u884c\u4e2d\u7684\u6570\u636e\u4e0e\u5b58\u50a8\u5668\u4e00\u81f4\uff1b\u5982\u679c\u5728\u5176\u4ed6CPU\u7684Cache\u4e2d\u5b58\u5728\u72b6\u6001\u4e3aO\u7684\u526f\u672c\u65f6\uff0cCache\u884c\u4e2d\u7684\u6570\u636e\u4e0e\u5b58\u50a8\u5668\u4e0d\u4e00\u81f4\u3002 </p> </li> </ol>"},{"location":"Mybatis-Plus/","title":"Mybatis-Plus\u6846\u67b6\u5165\u95e8\u7ea7\u6559\u7a0b","text":""},{"location":"Mybatis-Plus/#1","title":"1\u3001\u6846\u67b6\u80cc\u666f","text":"<p>\uff08\u7b80\u79f0 MP\uff09\u662f\u4e00\u4e2a MyBatis(opens new window)\u7684\u589e\u5f3a\u5de5\u5177\uff0c\u5728 MyBatis \u7684\u57fa\u7840\u4e0a\u53ea\u505a\u589e\u5f3a\u4e0d\u505a\u6539\u53d8\uff0c\u4e3a\u7b80\u5316\u5f00\u53d1\u3001\u63d0\u9ad8\u6548\u7387\u800c\u751f\u3002</p>"},{"location":"Mybatis-Plus/#springboot","title":"\u96c6\u6210SpringBoot","text":""},{"location":"Mybatis-Plus/#_1","title":"\u5f15\u5165\u76f8\u5173\u4f9d\u8d56","text":"<pre><code>&lt;!--  mybatis-plus--&gt;\n&lt;dependency&gt;\n  &lt;groupId&gt;com.baomidou&lt;/groupId&gt;\n  &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;\n  &lt;version&gt;3.5.2&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;!-- web--&gt;\n&lt;dependency&gt;\n  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n  &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n&lt;/dependency&gt;\n&lt;!--lombok--&gt;\n&lt;dependency&gt;\n  &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n  &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n  &lt;version&gt;1.18.4&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;!--\u76f8\u5173\u9a71\u52a8\u5305--&gt;\n&lt;dependency&gt;\n  &lt;groupId&gt;mysql&lt;/groupId&gt;\n  &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"Mybatis-Plus/#yml","title":"\u914d\u7f6eyml","text":"<pre><code>server:\n  port: -1\n\nspring:\n  application:\n    name: mybatis-plus-demo\n  #mysql\n  datasource:\n    url: jdbc:mysql://localhost:3306/demo?useUnicode=true&amp;characterEncoding=utf8&amp;allowMultiQueries=true\n    username: root\n    password: root\n    driverClassName: com.mysql.jdbc.Driver\n    maxWait: 60000\n    timeBetweenEvictionRunsMillis: 60000\n    minEvictableIdleTimeMillis: 300000\n    validationQuery: SELECT 1 FROM DUAL\n    testWhileIdle: true\n    testOnBorrow: false\n    testOnReturn: false\n    poolPreparedStatements: true\n    maxPoolPreparedStatementPerConnectionSize: 20\n    filters: stat,wall,log4j\n    connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000\n    initialSize: 15\n    minIdle: 15\n    maxActive: 16\n    type: com.alibaba.druid.pool.DruidDataSource\n\nmybatis-plus:\n  configuration:\n    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl\n  mapper-locations: classpath*:mapper/*.xml\n</code></pre>"},{"location":"Mybatis-Plus/#mybatis-plus_1","title":"\u914d\u7f6eMybatis-plus\u5305\u626b\u63cf\u8def\u5f84","text":"<p>\u8fd9\u4e2a\u8def\u5f84\u5fc5\u987b\u662f\u9879\u76eemapper\u6587\u4ef6\u7684\u5b58\u653e\u8def\u5f84</p> <pre><code>@SpringBootApplication\n@MapperScan(\"com.example.mybatisplus.mapper\")\npublic class MybatisPlusApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(MybatisPlusApplication.class, args);\n    }\n\n}\n</code></pre>"},{"location":"Mybatis-Plus/#mybatis-plus_2","title":"\u914d\u7f6eMybatis-Plus\u63d2\u4ef6","text":"<pre><code>@Configuration\npublic class MybatisPlusConfig {\n    @Bean\n    public MybatisPlusInterceptor mybatisPlusInterceptor() {\n        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();\n        //\u6dfb\u52a0\u4e50\u89c2\u9501\u63d2\u4ef6\n        interceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());\n        //\u6dfb\u52a0\u5206\u9875\u63d2\u4ef6\n        interceptor.addInnerInterceptor(new PaginationInnerInterceptor());\n        return interceptor;\n    }\n\n}\n</code></pre>"},{"location":"Mybatis-Plus/#entity","title":"\u914d\u7f6eEntity","text":"<pre><code>@Data\n@Builder\n@TableName(\"user\")\n@AllArgsConstructor\n@NoArgsConstructor\npublic class User {\n    @TableId(type = IdType.AUTO)\n    private Long id;\n    private String account;\n    private Integer age;\n    private String mobile;\n    private String email;\n    private String name;\n    @Version\n    private Integer version;\n}\n</code></pre> <p><code>@TableName</code> \u6307\u5b9a\u8868\u540d\uff0c\u4e0d\u6307\u5b9a\u5219\u4e3a\u7c7b\u540d\uff0c<code>@TableId</code>\u6307\u5b9aID\u9012\u589e\u65b9\u5f0f\uff0c\u89c4\u5219\u5982\u4e0b\uff0c\u4e00\u822c\u4e3a<code>AUTO</code></p> <pre><code>\npublic enum IdType {\n    /**\n     * \u6570\u636e\u5e93ID\u81ea\u589e\n     * &lt;p&gt;\u8be5\u7c7b\u578b\u8bf7\u786e\u4fdd\u6570\u636e\u5e93\u8bbe\u7f6e\u4e86 ID\u81ea\u589e \u5426\u5219\u65e0\u6548&lt;/p&gt;\n     */\n    AUTO(0),\n    /**\n     * \u8be5\u7c7b\u578b\u4e3a\u672a\u8bbe\u7f6e\u4e3b\u952e\u7c7b\u578b(\u6ce8\u89e3\u91cc\u7b49\u4e8e\u8ddf\u968f\u5168\u5c40,\u5168\u5c40\u91cc\u7ea6\u7b49\u4e8e INPUT)\n     */\n    NONE(1),\n    /**\n     * \u7528\u6237\u8f93\u5165ID\n     * &lt;p&gt;\u8be5\u7c7b\u578b\u53ef\u4ee5\u901a\u8fc7\u81ea\u5df1\u6ce8\u518c\u81ea\u52a8\u586b\u5145\u63d2\u4ef6\u8fdb\u884c\u586b\u5145&lt;/p&gt;\n     */\n    INPUT(2),\n\n    /* \u4ee5\u4e0b2\u79cd\u7c7b\u578b\u3001\u53ea\u6709\u5f53\u63d2\u5165\u5bf9\u8c61ID \u4e3a\u7a7a\uff0c\u624d\u81ea\u52a8\u586b\u5145\u3002 */\n    /**\n     * \u5206\u914dID (\u4e3b\u952e\u7c7b\u578b\u4e3anumber\u6216string\uff09,\n     * \u9ed8\u8ba4\u5b9e\u73b0\u7c7b {@link com.baomidou.mybatisplus.core.incrementer.DefaultIdentifierGenerator}(\u96ea\u82b1\u7b97\u6cd5)\n     *\n     * @since 3.3.0\n     */\n    ASSIGN_ID(3),\n    /**\n     * \u5206\u914dUUID (\u4e3b\u952e\u7c7b\u578b\u4e3a string)\n     * \u9ed8\u8ba4\u5b9e\u73b0\u7c7b {@link com.baomidou.mybatisplus.core.incrementer.DefaultIdentifierGenerator}(UUID.replace(\"-\",\"\"))\n     */\n    ASSIGN_UUID(4);\n}\n</code></pre>"},{"location":"Mybatis-Plus/#service","title":"\u914d\u7f6eService","text":"<pre><code>public interface UserService  extends IService&lt;User&gt; {}\n</code></pre> <p>\u5982\u679c\u4e0d\u9700\u8981mybatis-plus IService \u4e2d\u5c01\u88c5\u7684\u516c\u5171\u65b9\u6cd5\uff0c\u90a3\u4e48\u8fd9\u6b65\u53ef\u4ee5\u7701\u7565</p> <pre><code>@Service\npublic class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements UserService {\n}\n</code></pre> <p>\u914d\u7f6eMapper Xml</p> <p>xml\u6587\u4ef6\u7684\u5b58\u653e\u8def\u5f84\uff0c\u9700\u8981yml\u914d\u7f6e\u7684\u4e00\u81f4\uff08\u9700\u8981\u8ba9\uff09\uff0c\u5982\u679c\u4e0d\u9700\u8981\u624b\u5199sql\uff0c\u90a3\u4e48\u8fd9\u6b65\u53ef\u4ee5\u7701\u7565</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;\n&lt;mapper namespace=\"com.example.mybatisplus.mapper.UserMapper\"&gt;\n&lt;/mapper&gt;\n</code></pre>"},{"location":"Mybatis-Plus/#mybtais-plus-demo","title":"Mybtais-Plus \u6784\u9020\u5668\u4f7f\u7528\u76f8\u5173Demo","text":"<p>\u65b0\u589e</p> <pre><code>class MybatisPlusApplicationTests {\n\n    @Autowired\n    UserMapper userMapper;\n\n    @Autowired\n    UserService userService;\n\n    /**\n     * \u5355\u4e2a\u65b0\u589e\n     */\n    @Test\n   public void insert() {\n        User jack = User.builder()\n                .account(\"25235262\")\n                .age(22)\n                .mobile(\"111782721\")\n                .name(\"jack\")\n                .email(\"3232131336@gmail.com\")\n                .build();\n        userMapper.insert(jack);\n    }\n}\n</code></pre> <p>SQL \u6267\u884c\u65e5\u5fd7</p> <pre><code>JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2520aa05] will not be managed by Spring\n==&gt;  Preparing: INSERT INTO user ( account, age, mobile, email, name ) VALUES ( ?, ?, ?, ?, ? )\n==&gt; Parameters: 25235262(String), 22(Integer), 111782721(String), 3232131336@gmail.com(String), jack(String)\n&lt;==    Updates: 1\nClosing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@5423a17]\n2022-12-08 19:25:21.213  INFO 48976 --- [ionShutdownHook] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} closed\n</code></pre> <p>\u6279\u91cf\u65b0\u589e</p> <pre><code>class MybatisPlusApplicationTests {\n\n    @Autowired\n    UserMapper userMapper;\n\n    @Autowired\n    UserService userService;\n\n    /**\n     * \n     * \u6279\u91cf\u65b0\u589e\n     */\n    @Test\n    void saveBatch() {\n        User jack = User.builder()\n                .account(\"25235262\")\n                .age(22)\n                .mobile(\"111782721\")\n                .name(\"jack\")\n                .email(\"3232131336@gmail.com\")\n                .build();\n        User molly = User.builder()\n                .account(\"8488828\")\n                .age(12)\n                .mobile(\"78878876\")\n                .name(\"molly\")\n                .email(\"399hys6222@gmail.com\")\n                .build();\n        userService.saveBatch(Arrays.asList(jack,molly));\n    }\n}\n</code></pre> <p>SQL \u6267\u884c\u65e5\u5fd7</p> <pre><code>JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@6996bbc4] will be managed by Spring\n==&gt;  Preparing: INSERT INTO user ( account, age, mobile, email, name ) VALUES ( ?, ?, ?, ?, ? )\n==&gt; Parameters: 25235262(String), 22(Integer), 111782721(String), 3232131336@gmail.com(String), jack(String)\n==&gt; Parameters: 8488828(String), 12(Integer), 78878876(String), 399hys6222@gmail.com(String), molly(String)\n2022-12-09 11:05:50.796  INFO 59682 --- [ionShutdownHook] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} closed\n</code></pre> <p>\u901a\u8fc7\u4e3b\u952eid\u4fee\u6539</p> <pre><code>@Test\nvoid updateById() {\n    User build = User.builder()\n            .id(1L)\n            .account(\"123\")\n            .age(31)\n            .build();\n    userMapper.updateById(build);\n}\n</code></pre> <p>\u81ea\u5b9a\u4e49\u6761\u4ef6\u4fee\u6539</p> <pre><code>@Test\nvoid update() {\n    User build = User.builder()\n            .email(\"123@gmail.com\")\n            .age(31)\n            .build();\n    userMapper.update(build,Wrappers.lambdaQuery(User.class).eq(User::getAge,11));\n}\n</code></pre> <p>SQL \u6267\u884c\u65e5\u5fd7</p> <pre><code>JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@3caf5c96] will not be managed by Spring\n==&gt;  Preparing: UPDATE user SET age=?, email=? WHERE (age = ?)\n==&gt; Parameters: 31(Integer), 123(String), 11(Integer)\n&lt;==    Updates: 1\nClosing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6c5ae8fd]\n2022-12-08 19:12:27.753  INFO 48712 --- [ionShutdownHook] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} closed\n</code></pre> <p>\u6839\u636eid\u5220\u9664</p> <pre><code>@Test\n    void deleteById() {\n    userMapper.deleteById(1);\n}\n</code></pre> <p>SQL \u6267\u884c\u65e5\u5fd7</p> <pre><code>JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@5529522f] will not be managed by Spring\n==&gt;  Preparing: DELETE FROM user WHERE id=?\n==&gt; Parameters: 1(Integer)\n&lt;==    Updates: 1\nClosing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@42576db9]\n2022-12-09 11:13:57.860  INFO 59805 --- [ionShutdownHook] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} closed\n</code></pre> <p>\u6784\u9020\u6761\u4ef6\u5220\u9664</p> <pre><code>@Test\n    void delete() {\n    userMapper.delete(Wrappers.lambdaQuery(User.class).le(User::getAge,10));\n}\n</code></pre> <p>SQL \u6267\u884c\u65e5\u5fd7</p> <pre><code>JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@5af38a4a] will not be managed by Spring\n==&gt;  Preparing: DELETE FROM user WHERE (age &lt;= ?)\n==&gt; Parameters: 10(Integer)\n&lt;==    Updates: 1\nClosing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@166e5a6d]\n2022-12-09 11:17:31.279  INFO 59870 --- [ionShutdownHook] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} closed\n</code></pre> <p>\u901a\u8fc7\u4e3b\u952eid\u67e5\u8be2</p> <pre><code>@Test\nvoid selectById() {\n    User user = userMapper.selectById(1);\n}\n</code></pre> <p>SQL \u6267\u884c\u65e5\u5fd7</p> <pre><code>==&gt;  Preparing: SELECT id,account,age,mobile,email,name,version FROM user WHERE id=?\n==&gt; Parameters: 1(Integer)\n&lt;==      Total: 0\nClosing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@23bd047f]\nnull\n2022-12-09 11:19:00.466  INFO 59890 --- [ionShutdownHook] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} closed\n</code></pre> <p>\u6784\u9020\u6761\u4ef6\u67e5\u8be2</p> <pre><code>@Test\nvoid selectList() {\n\n   List&lt;User&gt; users =  userMapper.selectList( Wrappers.lambdaQuery(User.class)\n                  .eq(User::getAge,30)\n                  .ne(User::getAccount,\"jack\"));\n}\n</code></pre> <p>SQL \u6267\u884c\u65e5\u5fd7</p> <pre><code>JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@63c84d31] will not be managed by Spring\n==&gt;  Preparing: SELECT id,account,age,mobile,email,name,version FROM user WHERE (age = ? AND account &lt;&gt; ?)\n==&gt; Parameters: 11(Integer), 3131313(String)\n&lt;==      Total: 0\nClosing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@77a2688d]\n2022-12-09 11:24:35.295  INFO 60020 --- [ionShutdownHook] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} closed\n</code></pre> <p>\u6784\u9020\u6761\u4ef6\u5206\u9875\u67e5\u8be2</p> <pre><code>    @Test\n    void selectPage() {\n        //\u5f53\u524d\u9875\u97621\uff0c\u6bcf\u987510\u6761\n        Page&lt;User&gt; page = new Page&lt;&gt;(1, 10);\n        Page&lt;User&gt; userPage = userMapper.selectPage(page, Wrappers.lambdaQuery(User.class)\n                .eq(User::getAge, 11)\n                .ne(User::getAccount, \"3131313\"));\n        //\u603b\u9875\u6570\n        long pages = userPage.getPages();\n        //\u6570\u636e\u96c6\n        List&lt;User&gt; records = userPage.getRecords();\n        //\u5f53\u524d\u9875\n        long current = userPage.getCurrent();\n        //\u603b\u6761\u6570\n        long total = userPage.getTotal();\n    }\n</code></pre> <p>SQL \u6267\u884c\u65e5\u5fd7</p> <pre><code>JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@1aaf46e6] will not be managed by Spring\n==&gt;  Preparing: SELECT COUNT(*) AS total FROM user WHERE (age = ? AND account &lt;&gt; ?)\n==&gt; Parameters: 11(Integer), 123(String)\n&lt;==    Columns: total\n&lt;==        Row: 3\n&lt;==      Total: 1\n==&gt;  Preparing: SELECT id,account,age,mobile,email,name,version FROM user WHERE (age = ? AND account &lt;&gt; ?) LIMIT ?\n==&gt; Parameters: 11(Integer), 123(String), 10(Long)\n&lt;==    Columns: id, account, age, mobile, email, name, version\n&lt;==        Row: 8, 25235262, 11, 111782721, 3232131336@gmail.com, jack, null\n&lt;==        Row: 9, 8488828, 11, 78878876, 399hys6222@gmail.com, molly, null\n&lt;==        Row: 13, 25235262, 11, 111782721, 3232131336@gmail.com, jack, 1\n&lt;==      Total: 3\nClosing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@606b53a3]\n2022-12-09 11:33:36.049  INFO 60188 --- [ionShutdownHook] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} closed\n</code></pre>"},{"location":"about/","title":"\u4f7f\u7528minikube\u5b89\u88c5Kubernetes","text":"<p>minikube \u4e3b\u8981\u57fa\u4e8e\u8fd0\u884c\u4e00\u4e2a\u5355\u8282\u70b9 Kubernetes \u96c6\u7fa4\uff0c\u4ee5\u4fbf\u652f\u6301\u5728\u672c\u5730\u673a\u5668\u4e0a\u7684 VM \u5185\u8fdb\u884c\u5f00\u53d1\u3002\u5b83\u652f\u6301\u865a\u62df\u673a\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5982 VirtualBox\u3001HyperV\u3001KVM2\u3002\u7531\u4e8e Minikube \u662f Kubernetes \u4f53\u7cfb\u4e2d\u76f8\u5bf9\u6210\u719f\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u652f\u6301\u7684\u529f\u80fd\u5217\u8868\u975e\u5e38\u4ee4\u4eba\u5370\u8c61\u6df1\u523b\u3002\u8fd9\u4e9b\u529f\u80fd\u662f\u8d1f\u8f7d\u5747\u8861\u5668\u3001\u591a\u96c6\u7fa4\u3001\u8282\u70b9\u7aef\u53e3\u3001\u6301\u4e45\u5377\u3001\u5165\u53e3\u3001\u4eea\u8868\u677f\u6216\u5bb9\u5668\u8fd0\u884c\u65f6\u3002 </p>"},{"location":"about/#brew","title":"\u4f7f\u7528brew\u547d\u4ee4\u5b89\u88c5:","text":"<pre><code>brew install minikube\n</code></pre>"},{"location":"about/#_1","title":"\u67e5\u770b\u5b89\u88c5\u8def\u5f84","text":"<pre><code>which minikube\n</code></pre> <p><code>/opt/homebrew/bin/minikube</code></p>"},{"location":"about/#minikube","title":"\u542f\u52a8 minikube","text":"<pre><code>dengqing@mayundeMacBook-Pro ~ % minikube start\n\ud83d\ude04  Darwin 11.2 (arm64) \u4e0a\u7684 minikube v1.26.1\n\ud83d\udc4e  Unable to pick a default driver. Here is what was considered, in preference order:\n\ud83d\udca1  Alternatively you could install one of these drivers:\n    \u25aa docker: Not installed: exec: \"docker\": executable file not found in $PATH\n    \u25aa hyperkit: Not installed: exec: \"hyperkit\": executable file not found in $PATH\n    \u25aa parallels: Not installed: exec: \"prlctl\": executable file not found in $PATH\n    \u25aa vmware: Not installed: exec: \"docker-machine-driver-vmware\": executable file not found in $PATH\n    \u25aa virtualbox: Not installed: unable to find VBoxManage in $PATH\n    \u25aa podman: Not installed: exec: \"podman\": executable file not found in $PATH\n    \u25aa qemu2: Not installed: exec: \"qemu-system-aarch64\": executable file not found in $PATH\n\n\u274c  Exiting due to DRV_NOT_DETECTED: No possible driver was detected. Try specifying --driver, or see https://minikube.sigs.k8s.io/docs/start/\n\n</code></pre> <p>\u539f\u56e0\u662f\u6ca1\u6709\u9ed8\u8ba4\u7684\u9a71\u52a8\uff0c\u5b89\u88c5docker \u4f5c\u4e3a\u9ed8\u8ba4\u9a71\u52a8</p> <pre><code>brew install --cask --appdir=/Applications docker\n</code></pre> <p>\u542f\u52a8\u6210\u529f</p> <pre><code>hk@mayundeMacBook-Pro ~ % minikube start\n\ud83d\ude04  Darwin 11.2 (arm64) \u4e0a\u7684 minikube v1.26.1\n\ud83c\udf89  minikube 1.29.0 is available! Download it: https://github.com/kubernetes/minikube/releases/tag/v1.29.0\n\ud83d\udca1  To disable this notice, run: 'minikube config set WantUpdateNotification false'\n\n\u2728  \u81ea\u52a8\u9009\u62e9 docker \u9a71\u52a8\n\ud83d\udccc  Using Docker Desktop driver with root privileges\n\ud83d\udc4d  Starting control plane node minikube in cluster minikube\n\ud83d\ude9c  Pulling base image ...\n\ud83d\udcbe  Downloading Kubernetes v1.24.3 preload ...\n    &gt; preloaded-images-k8s-v18-v1...:  342.82 MiB / 342.82 MiB  100.00% 924.64 \n    &gt; gcr.io/k8s-minikube/kicbase:  348.00 MiB / 348.00 MiB  100.00% 511.18 KiB\n\ud83d\udd25  Creating docker container (CPUs=2, Memory=4000MB) ...\n\ud83d\udc33  \u6b63\u5728 Docker 20.10.17 \u4e2d\u51c6\u5907 Kubernetes v1.24.3\u2026\n    \u25aa Generating certificates and keys ...\n    \u25aa Booting up control plane ...\n    \u25aa Configuring RBAC rules ...\n\ud83d\udd0e  Verifying Kubernetes components...\n    \u25aa Using image gcr.io/k8s-minikube/storage-provisioner:v5\n\ud83c\udf1f  Enabled addons: storage-provisioner, default-storageclass\n\ud83c\udfc4  Done! kubectl is now configured to use \"minikube\" cluster and \"default\" namespace by default \n</code></pre> <p>\u6253\u5f00Kubernetes\u63a7\u5236\u53f0 \uff0c\u51fa\u73b0\u4ee5\u4e0b\u9519\u8bef</p> <pre><code>minikube dashboard\n\ud83d\udd0c  \u6b63\u5728\u5f00\u542f dashboard ...\n\u25aa Using image kubernetesui/dashboard:v2.6.0\n\u25aa Using image kubernetesui/metrics-scraper:v1.0.8\n\ud83e\udd14  \u6b63\u5728\u9a8c\u8bc1 dashboard \u8fd0\u884c\u60c5\u51b5 ...\n\ud83d\ude80  Launching proxy ...\n\ud83e\udd14  \u6b63\u5728\u9a8c\u8bc1 proxy \u8fd0\u884c\u72b6\u51b5 ...\n\n\u274c  Exiting due to SVC_URL_TIMEOUT: http://127.0.0.1:5077/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ is not accessible: checkURL: Get \"http://127.0.0.1:5077/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/\": dial tcp 127.0.0.1:5077: connect: connection refused\n</code></pre>"},{"location":"about/#minikube-log","title":"\u5220\u9664minikube \u91cd\u65b0\u542f\u52a8\u5e76\u67e5\u770blog\u8f93\u51fa","text":"<pre><code>minikube delete\nminikube start\nminikube dashboard --alsologtostderr -v=\n</code></pre>"},{"location":"about/#_2","title":"\u542f\u52a8\u6210\u529f\u8f93\u51fa","text":"<pre><code>W0317 15:39:06.172493   56978 out.go:239] \ud83e\udd14  \u6b63\u5728\u9a8c\u8bc1 proxy \u8fd0\u884c\u72b6\u51b5 ...\n\ud83e\udd14  \u6b63\u5728\u9a8c\u8bc1 proxy \u8fd0\u884c\u72b6\u51b5 ...\nI0317 15:39:06.188821   56978 dashboard.go:212] http://127.0.0.1:58992/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ response: &lt;nil&gt; &amp;{Status:200 OK StatusCode:200 Proto:HTTP/1.1 ProtoMajor:1 ProtoMinor:1 Header:map[Accept-Ranges:[bytes] Audit-Id:[fe8d4733-509f-4140-b066-240ca91d76ef] Cache-Control:[no-cache, private no-cache, no-store, must-revalidate] Content-Type:[text/html; charset=utf-8] Date:[Fri, 17 Mar 2023 07:39:06 GMT] Last-Modified:[Tue, 31 May 2022 15:30:52 GMT]] Body:0x14000a5eae0 ContentLength:-1 TransferEncoding:[] Close:false Uncompressed:true Trailer:map[] Request:0x14000fa2c00 TLS:&lt;nil&gt;}\nI0317 15:39:06.206370   56978 out.go:177] \ud83c\udf89  Opening http://127.0.0.1:58992/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...\n\ud83c\udf89  Opening http://127.0.0.1:58992/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...\nI0317 15:39:06.415533   56978 dashboard.go:127] Success! I will now quietly sit around until kubectl proxy exits!\n</code></pre>"},{"location":"about/#_3","title":"\u6253\u5f00\u6d4f\u89c8\u5668","text":"<p>http://127.0.0.1:58992/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/#/workloads?namespace=default </p>"},{"location":"about/#_4","title":"\u521b\u5efa\u5e94\u7528","text":"<p>\u5728\u5bb9\u5668\u4e2d\u5c1d\u8bd5\u521b\u5efa\u4e00\u4e2anginx</p> <pre><code>kubectl create deployment test-nginx --image=nginx:1.23.0\n</code></pre> <p>\u66b4\u973280\u7aef\u53e3</p> <pre><code>kubectl expose deployment test-nginx --port=80  --type=NodePor\n</code></pre> <p>\u53ef\u4ee5\u628a Node \u4e3b\u673a\u7aef\u53e3 \u8f6c\u53d1 \u5230 pod \u7aef\u53e3</p> <pre><code>kubectl port-forward  --address 0.0.0.0   service/test-nginx 80:80\n</code></pre> <p>\u8bbf\u95eeniginx  <code>http://localhost/</code> </p>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/","title":"GraphicsMagick\u4f7f\u7528","text":"<p>\u4ec0\u4e48\u662f GraphicsMagick\uff1f \u56fe\u50cf\u5904\u7406\u7684\u745e\u58eb\u519b\u5200\u3002GraphicsMagick \u662f\u56fe\u50cf\u5904\u7406\u7684\u745e\u58eb\u519b\u5200\u3002\u7531\u57fa\u672c\u5305\u4e2d\u6e90\u4ee3\u7801\u7684 267K \u7269\u7406\u884c\uff08\u6839\u636e David A. Wheeler \u7684 SLOCCount\uff09\uff08\u6216 1,225K\uff0c\u5305\u62ec\u7b2c 3 \u65b9\u5e93\uff09\u7ec4\u6210\uff0c\u5b83\u63d0\u4f9b\u4e86\u5f3a\u5927\u800c\u9ad8\u6548\u7684\u5de5\u5177\u548c\u5e93\u96c6\u5408\uff0c\u652f\u6301\u8bfb\u53d6\u3001\u7f16\u5199\u548c\u64cd\u4f5c\u8d85\u8fc7 88 \u79cd\u4e3b\u8981\u683c\u5f0f\u7684\u56fe\u50cf\uff0c\u5305\u62ec DPX\u3001GIF\u3001JPEG\u3001JPEG-2000\u3001PNG\u3001PDF\u3001PNM \u548c TIFF \u7b49\u91cd\u8981\u683c\u5f0f</p>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#homebrew","title":"\u5b89\u88c5Homebrew","text":"<p>mac\u5305\u7ba1\u7406\u5668\uff0c\u53ef\u4ee5\u5e2e\u52a9\u60a8\u5b89\u88c5 GraphicsMagick \u548c\u5176\u4ed6\u8f6f\u4ef6\u5305\uff0c\u5df2\u7ecf\u5b89\u88c5\u53ef\u4ee5\u8df3\u8fc7\u8fd9\u4e00\u6b65</p> <pre><code>/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#graphicsmagick_1","title":"\u5b89\u88c5GraphicsMagick","text":"<p>\u67e5\u627eGraphicsMagick \u7248\u672c</p> <pre><code> brew search graphicsmagick\n</code></pre> <pre><code>mayundeMacBook-Pro ~ % brew search graphicsmagick\n==&gt; Formulae\ngraphicsmagick\n</code></pre> <p>\u5b89\u88c5GraphicsMagick\uff0c\u8fd9\u53ef\u80fd\u9700\u8981\u51e0\u5206\u949f\u65f6\u95f4</p> <pre><code>brew install graphicsmagick\n</code></pre> <p>\u68c0\u67e5 GraphicsMagick \u662f\u5426\u5df2\u6210\u529f\u5b89\u88c5</p> <pre><code>gm version\n</code></pre> <pre><code>mayundeMacBook-Pro ~ % gm version\nGraphicsMagick 1.3.40 2023-01-14 Q16 http://www.GraphicsMagick.org/\nCopyright (C) 2002-2023 GraphicsMagick Group.\nAdditional copyrights and licenses apply to this software.\nSee http://www.GraphicsMagick.org/www/Copyright.html for details.\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#graphicsmagick_2","title":"GraphicsMagick\u56fe\u7247\u76f8\u5173\u64cd\u4f5c","text":"<p>\u5b98\u65b9\u6587\u6863</p>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#_1","title":"\u83b7\u53d6\u56fe\u7247\u5206\u914d\u7387\u3001\u5927\u5c0f","text":"<p>\u540e\u9762\u7684\u5730\u5740\u53ef\u4ee5\u662f\u672c\u5730\u5730\u5740\u4e5f\u53ef\u4ee5\u662f\u4e92\u8054\u7f51\u5730\u5740</p> <pre><code>gm  identify -format  %wx%h,%b http://resources1.deepdraw.biz/img/default_videoHome.jpg\n</code></pre> <pre><code>\u8f93\u51fa 750x1000,23.5Ki\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#_2","title":"\u7f29\u653e\u56fe\u7247","text":"<pre><code>gm convert  http://resources1.deepdraw.biz/img/default_color.jpg -resize 50%  /Users/hk/Downloads/kjkk2.jpg\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#_3","title":"\u88c1\u526a\u56fe\u7247","text":"<p>\u57fa\u4e8e\u767e\u5206\u6bd4\u8fdb\u884c\u88c1\u526a</p> <pre><code>gm convert /Users/hk/Downloads/demo.jpg -crop 50%x50%+10%+10% /Users/hk/Downloads/demo.jpg\n</code></pre> <p>\u57fa\u4e8e\u50cf\u7d20\u5750\u6807\u8fdb\u884c\u88c1\u526a</p> <pre><code>gm convert /Users/hk/Downloads/demo.jpg -crop 800x600+10+10 /Users/hk/Downloads/demo.jpg\n</code></pre> <p>\u88c1\u526a\u5e76\u8c03\u6574\u56fe\u7247\u5927\u5c0f</p> <pre><code>gm convert /Users/hk/Downloads/demo.jpg  -crop 800x600+10+10 -resize 400x300 /Users/hk/Downloads/demo.jpg\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#_4","title":"\u56fe\u7247\u6253\u4e0a\u6c34\u5370","text":"<p>\u8bbe\u7f6e\u6c34\u5370\u56fe\u7247\u7684\u900f\u660e\u5ea6\u4e3a\u767e\u5206\u4e4b50%</p> <pre><code>gm composite -dissolve 50% -gravity center watermark.png input.jpg output.jpg\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#_5","title":"\u8c03\u6574\u56fe\u50cf\u7684\u8d28\u91cf","text":"<p>\u5c06\u56fe\u7247\u538b\u7f29\u4e3a80%\u7684\u8d28\u91cf\uff0c\u6e05\u6670\u5ea6\u4f1a\u964d\u4f4e</p> <pre><code>gm convert -quality 80 input.jpg output.jpg\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#_6","title":"\u56fe\u7247\u8f6c\u6362","text":"<p>\u56fe\u7247\u8f6c\u6362\u4e3aPNG\u683c\u5f0f</p> <pre><code>gm convert -format png input.jpg output.png\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#_7","title":"\u56fe\u7247\u65cb\u8f6c","text":"<p>\u5c06\u56fe\u7247\u65cb\u8f6c90\u5ea6</p> <pre><code>gm convert -rotate 90 input.jpg output.jpg\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#_8","title":"\u9ad8\u65af\u6a21\u7cca","text":"<pre><code>gm convert -blur 0x8 input.jpg output.jpg\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#gif","title":"\u751f\u6210gif","text":"<p>\u5c06\u4e09\u5f20\u540d\u4e3a 1.png\u30012.png \u548c 3.png \u7684\u56fe\u7247\u5408\u6210\u4e3a\u4e00\u4e2a\u52a8\u753b GIF\uff0c\u6bcf\u5f20\u56fe\u7247\u4e4b\u95f4\u95f4\u9694 100 \u6beb\u79d2\u5e76\u8f93\u51fa\u4e3a demo.gif</p> <pre><code>gm convert -delay 100 1.png 2.png 3.png -loop 0 demo.gif\n</code></pre> <p><code>-delay</code>\u53c2\u6570\u6307\u5b9a\u6bcf\u5f20\u56fe\u7247\u4e4b\u95f4\u7684\u95f4\u9694\u65f6\u95f4\uff0c<code>-loop 0</code>\u53c2\u6570\u6307\u5b9a\u65e0\u9650\u5faa\u73af\u64ad\u653e GIF \u52a8\u753b\uff0cdemo.gif \u662f\u8f93\u51fa\u7684 GIF \u6587\u4ef6\u3002</p> <p>\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 <code>-dispose</code>\u53c2\u6570\u6307\u5b9a GIF \u52a8\u753b\u7684\u5e27\u95f4\u5904\u7406\u65b9\u5f0f\u3002\u5e38\u89c1\u7684\u5e27\u95f4\u5904\u7406\u65b9\u5f0f\u6709 <code>background</code>\u3001<code>previous</code>\u3001<code>none</code> \u548c <code>restore</code>\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u8fd9\u4e2a\u53c2\u6570\u6765\u8bbe\u7f6e\u5e27\u95f4\u5904\u7406\u65b9\u5f0f\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>gm convert -delay 100 -dispose previous frame1.png frame2.png frame3.png -loop 0 animation.gif\n</code></pre> <p>\u53ef\u4ee5\u6307\u5b9a\u5e27\u95f4\u5904\u7406\u65b9\u5f0f\u4e3a <code>previous</code>\uff0c\u8868\u793a\u5e27\u95f4\u4e0d\u6e05\u9664\u5e76\u5c06\u524d\u4e00\u5e27\u4f5c\u4e3a\u80cc\u666f</p>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#springboot","title":"\u96c6\u6210\u5230SpringBoot","text":""},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#sdk","title":"\u5f15\u5165\u76f8\u5173sdk","text":"<p>maven</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.sharneng&lt;/groupId&gt;\n    &lt;artifactId&gt;gm4java&lt;/artifactId&gt;\n    &lt;version&gt;1.1.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#graphicsmagick_3","title":"\u6784\u5efaGraphicsMagick\u8fdb\u7a0b\u6c60","text":"<p>\u914d\u7f6e\u76f8\u5173\u8fdb\u7a0b\u6c60\u4fe1\u606f\u6ce8\u5165\u5230Spirng\u5bb9\u5668\u4e2d</p> <pre><code>    //\u4eceyml\u8bfb\u53d6\u81ea\u5b9a\u4e49\u7684\u914d\u7f6e\u4fe1\u606f\n    @Autowired\n    private  GMPoolProperties gmPoolProperties;\n\n    @Bean\n    public PooledGMService PooledGMService() {\n        GMConnectionPoolConfig config = new GMConnectionPoolConfig();\n        config.setMaxActive(gmPoolProperties.getMaxActive());\n        config.setMaxIdle(gmPoolProperties.getMaxIdle());\n        config.setMinIdle(gmPoolProperties.getMinIdle());\n        config.setMinEvictableIdleTimeMillis(gmPoolProperties.getMinEvictableIdleTimeMillis());\n        config.setWhenExhaustedAction(gmPoolProperties.getWhenExhaustedAction());\n        config.setMaxWait(gmPoolProperties.getMaxWait());\n        config.setTestWhileIdle(gmPoolProperties.isTestWhileIdle());\n        config.setTimeBetweenEvictionRunsMillis(gmPoolProperties.getTimeBetweenEvictionRunsMillis());\n        log.info(\"init gm pool finished\");\n\n        return new PooledGMService(config);\n    }\n</code></pre>"},{"location":"mac%E5%AE%89%E8%A3%85GraphicsMagick/#_9","title":"\u8fd0\u884c\u76f8\u5173\u56fe\u7247\u64cd\u4f5c","text":"<p>\u83b7\u53d6\u56fe\u7247\u4fe1\u606f</p> <pre><code>    @Autowired\n    PooledGMService pooledGMService;\n\n    @Test\n    void test() throws Exception {\n        String imageInfo = pooledGMService.execute(\"identify -format %wx%h,%b\", \"/image/default.jpg\");\n        System.out.println(imageInfo);\n    }\n</code></pre>"},{"location":"nacos/","title":"Nacos","text":"<p>Nacos \u662f\u4e00\u4e2a\u57fa\u4e8e\u4e91\u539f\u751f\u7684\u52a8\u6001\u670d\u52a1\u53d1\u73b0\u3001\u914d\u7f6e\u548c\u7ba1\u7406\u5e73\u53f0\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u8005\u66f4\u597d\u5730\u5b9e\u73b0\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\u7684\u52a8\u6001\u670d\u52a1\u53d1\u73b0\u548c\u914d\u7f6e\u7ba1\u7406\u3002</p>"},{"location":"nacos/#_1","title":"\u5982\u4f55\u5b89\u88c5","text":"<p>\u5b98\u65b9\u6587\u6863</p> <p>\u4e0b\u8f7d\u5b89\u88c5\u5305</p> <p>\u901a\u8fc7 Github \u9009\u62e9\u4f60\u8981\u4e0b\u8f7d \u7684\u538b\u7f29\u5305\uff0c\u6700\u597d\u4e0b\u8f7d\u6700\u65b0\u7248\u672c</p> <p>\u521d\u59cb\u5316\u6570\u636e</p> <p>\u521b\u5efa\u6570\u636e\u5e93</p> <pre><code>CREATE DATABASE nacos_config DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n</code></pre> <p>\u6267\u884c Nacos \u670d\u52a1\u7aef\u5305\u4e2d\u7684 SQL \u811a\u672c\u6765\u521d\u59cb\u5316\u6570\u636e\u5e93\uff0c\u811a\u672c\u6587\u4ef6\u4f4d\u4e8e\u8def\u5f84 nacos/conf/nacos-mysql.sql\u3002</p> <p>${NACOS_HOME}\uff1aNacos Server \u6240\u5728\u7684\u76ee\u5f55</p> <pre><code>mysql -uroot -p nacos_config &lt; ${NACOS_HOME}/conf/mysql-schema.sql\n</code></pre> <p>\u4fee\u6539 application.properties\uff0c\u653e\u5f00\u5bf9\u5e94mysql\u6ce8\u91ca\u586b\u5199\u81ea\u5df1mysql\u5730\u5740</p> <pre><code>db.num=1\ndb.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC\ndb.user=root\ndb.password.0=1234\n</code></pre>"},{"location":"nacos/#nacos_1","title":"\u542f\u52a8Nacos","text":"<p>\u8fdb\u5165Nacos\u7684 bin \u76ee\u5f55\u4e0b\uff0c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8 Nacos</p> <pre><code>sh startup.sh -m standalone\n</code></pre>"},{"location":"nacos/#springboot","title":"\u96c6\u6210Springboot","text":"<p>\u6dfb\u52a0maven\u4f9d\u8d56</p> <pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;\n    &lt;version&gt;2021.1&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre> <p>\u5728 <code>application.yml</code>\u6587\u4ef6\u4e2d\u6dfb\u52a0Nacos\u7684\u5730\u5740\u4e0enamespac\u7a7a\u95f4\u547d\u540d\u7684\u540d\u79f0</p> <pre><code>nacos:\n\u00a0\u00a0config:\n\u00a0\u00a0\u00a0\u00a0bootstrap:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u5f00\u542f\u7cfb\u7edf\u542f\u52a8\u65f6\u9884\u8bfb\u53d6nacos\u7684\u914d\u7f6e\uff0c\u7528\u4e8e\u6ee1\u8db3@Value\u6ce8\u5165\u6570\u636e\u7684\u573a\u666f\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0enable:\u00a0true\n\u00a0\u00a0\u00a0\u00a0#\u00a0\u914d\u7f6e\u6240\u5c5e\u547d\u540d\u7a7a\u95f4\u7684id,\u6b64\u5904\u6211\u4eec\u914d\u7f6e\u540d\u79f0\u4e3adev\u7684id\uff0c\u53ef\u4ee5\u5728\u547d\u540d\u7a7a\u95f4\u5217\u8868\u67e5\u770bid\u7684\u503c\n\u00a0\u00a0\u00a0\u00a0namespace:\u00a0demo-namespace\n\u00a0\u00a0\u00a0\u00a0#\u00a0\u914d\u7f6e\u6240\u5c5e\u5206\u7ec4\n\u00a0\u00a0\u00a0\u00a0group:\u00a0DEFAULT_GROUP\n\u00a0\u00a0\u00a0\u00a0#\u00a0\u914d\u7f6eID\n\u00a0\u00a0\u00a0\u00a0data-id:\u00a0demo\n\u00a0\u00a0\u00a0\u00a0#\u00a0\u914d\u7f6e\u6587\u4ef6\u7c7b\u578b,\u5bf9\u5e94nacos\u914d\u7f6e\u9875\u9762\u7684\u914d\u7f6e\u683c\u5f0f\uff0c\u9ed8\u8ba4\u662fproperties\n\u00a0\u00a0\u00a0\u00a0type:\u00a0yaml\n\u00a0\u00a0\u00a0\u00a0#\u00a0nacos\u670d\u52a1\u5668\u5730\u5740\n\u00a0\u00a0\u00a0\u00a0server-addr:\u00a0127.0.0.1:8848\n\u00a0\u00a0\u00a0\u00a0#\u00a0\u5f00\u542f\u81ea\u52a8\u5237\u65b0nacos\u914d\u7f6e\n\u00a0\u00a0\u00a0\u00a0auto-refresh:\u00a0true\n\u00a0\u00a0\u00a0\u00a0#\u00a0\u9488\u5bf9\u914d\u7f6e\u9879\u540c\u540d\u7684\u60c5\u51b5\uff0c\u662f\u5426\u5141\u8bb8nacos\u7684\u914d\u7f6e\u8986\u76d6\u672c\u5730\u7684\u914d\u7f6e\n\u00a0\u00a0\u00a0\u00a0remote-first:\u00a0true\n\u00a0\u00a0discovery:\n    server-addr:127.0.0.1:8848\n\n</code></pre> <p>\u5e94\u7528\u7a0b\u5e8f\u7684\u542f\u52a8\u7c7b\u4e2d\u6dfb\u52a0 <code>@EnableDiscoveryClient</code>\u6ce8\u89e3</p> <pre><code>@SpringBootApplication\n@EnableDiscoveryClient\npublic class MinioDemoApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(MinioDemoApplication.class, args);\n    }\n\n}\n\n</code></pre>"},{"location":"redis/","title":"Redis\u8fd0\u884cLua\u811a\u672c","text":"<p>\u5728\u4e00\u4e9b\u4e92\u8054\u7f51\u9879\u76ee\u4e2d\uff0c\u96be\u514d\u4f1a\u8bbe\u8ba1\u5230\u4e00\u4e9b\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u4f8b\u5982\u5b9e\u65f6\u4ea4\u6613\u91cf\u7684\u7d2f\u52a0\uff0c\u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u73b0\uff0c\u90a3\u4e48\u91c7\u7528lua\u811a\u672c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210\u4e00\u4e2a\u539f\u5b50\u6027\u7684\u64cd\u4f5c</p> <p>Redis\u4f1a\u4f7f\u7528\u76f8\u540c\u7684 Lua \u89e3\u91ca\u5668\u6765\u8fd0\u884c\u6240\u6709\u547d\u4ee4\u3002Redis \u8fd8\u4fdd\u8bc1\u4ee5\u539f\u5b50\u65b9\u5f0f\u6267\u884c\u811a\u672c\uff1a\u5728\u6267\u884c\u811a\u672c\u65f6\u4e0d\u4f1a\u6267\u884c\u5176\u4ed6\u811a\u672c\u6216 Redis \u547d\u4ee4\u3002</p> <p>\u4f7f\u7528Lua\u811a\u672c\u7684\u597d\u5904\u6709</p> <p>\u25cf \u907f\u514d\u591a\u6b21\u7f51\u7edcIO\u8bf7\u6c42\uff0c\u5f53\u4e1a\u52a1\u573a\u666f\u9700\u8981\u591a\u6b21\u64cd\u4f5cRedis\u65f6\u53ef\u4ee5\u5c01\u88c5Lua\u811a\u672c\uff0c\u51cf\u5c11\u7f51\u7edc\u5f00\u9500</p> <p>\u25cf \u591a\u6307\u4ee4\u539f\u5b50\u5316\uff0cRedis\u4f7f\u7528\u72ec\u7279\u7684\u89e3\u91ca\u5668\u5c06\u591a\u4e2a\u64cd\u4f5c\u6307\u4ee4\u5c01\u88c5\u6210\u540c\u4e00\u6307\u4ee4\u6267\u884c</p>"},{"location":"redis/#redis","title":"\u5728Redis\u4e2d\u57fa\u672c\u7528\u6cd5","text":"<pre><code>EVAL script numkeys key [key ...] arg [arg ...]\n</code></pre> <p>\u4f8b</p> <pre><code>EVAL \"return {KEYS[1],KEYS[2],ARGV[1],ARGV[2]}\" 2 key1 key2 value1 value2\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ol> <li> <p><code>EVAL</code> \uff1aLua\u6267\u884c\u5173\u952e\u5b57</p> </li> <li> <p><code>KEYS[1]</code>\uff1a\u4f20\u5165key\u6570\u7ec4\u4e2d\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e5f\u5c31\u662f\u201ckey1\u201d</p> </li> <li><code>KEYS[2]</code>\uff1a\u4f20\u5165key\u6570\u7ec4\u4e2d\u7b2c\u4e8c\u4e2a\u5143\u7d20\u4e5f\u5c31\u662f\u201ckey2\u201d</li> <li><code>ARGV[1]</code>\uff1a\u4f20\u5165argv\u6570\u7ec4\u4e2d\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e5f\u5c31\u662f\u201cvalue1\u201d</li> <li><code>ARGV[2]</code>\uff1a\u4f20\u5165argv\u6570\u7ec4\u4e2d\u7b2c\u4e8c\u4e2a\u5143\u7d20\u4e5f\u5c31\u662f\u201cvalue2\u201d</li> <li>\u6700\u540e\u7684\u53c2\u6570 2 \u4e3a key\u503c\u6570\u7ec4\u7684\u957f\u5ea6</li> </ol> <p></p>"},{"location":"redis/#luaredis","title":"Lua\u64cd\u4f5cRedis\u57fa\u672c\u6570\u636e\u7ed3\u6784","text":""},{"location":"redis/#luastring","title":"Lua\u64cd\u4f5cString","text":"<p>\u5b58</p> <pre><code>EVAL \"redis.call('SET',KEYS[1],ARGV[1])\" 1 stringinser 123\n</code></pre> <p>\u53d6</p> <pre><code>EVAL \"return redis.call('GET',KEYS[1])\" 1 stringinser\n</code></pre>"},{"location":"redis/#luamap","title":"Lua\u64cd\u4f5cMap","text":"<p>\u5b58</p> <pre><code>EVAL \"redis.call('HSET',ARGV[1],KEYS[1],ARGV[2])\" 1 mapinsert test 123\n</code></pre> <p>\u53d6</p> <pre><code>EVAL \"return redis.call('HGET',ARGV[1],KEYS[1])\" 1 mapinsert test\n</code></pre>"},{"location":"redis/#lualist","title":"Lua\u64cd\u4f5cList","text":"<p>\u5b58</p> <pre><code>EVAL \"redis.call('LPUSH',KEYS[1],ARGV[1])\" 1 listinsert 123\n</code></pre> <p>\u53d6</p> <pre><code>EVAL \"return redis.call('LRANGE',KEYS[1],0,-1)\" 1 listinsert\n</code></pre>"},{"location":"redis/#luaset","title":"Lua\u64cd\u4f5cSet","text":"<p>\u5b58</p> <pre><code>EVAL \"redis.call('SADD',KEYS[1],ARGV[1])\" 1 setinsert 123\n</code></pre> <p>\u53d6</p> <pre><code>EVAL \"return redis.call('SMEMBERS',KEYS[1])\" 1 setinsert\n</code></pre>"},{"location":"redis/#luasorted-set","title":"Lua\u64cd\u4f5cSorted Set","text":"<p>\u5b58</p> <pre><code>EVAL \"redis.call('ZADD',KEYS[1],ARGV[1],ARGV[2])\" 1 zsetinsert 0 123\n</code></pre> <p>\u53d6</p> <pre><code>EVAL \"return redis.call('ZRANGE',KEYS[1],0,-1)\" 1 zsetinsert\n</code></pre>"},{"location":"redis/#luaredis_1","title":"Lua\u64cd\u4f5cRedis\u7279\u6b8a\u6570\u636e\u7ed3\u6784","text":""},{"location":"redis/#luageo","title":"Lua\u64cd\u4f5cGeo \uff08\u8ba1\u7b97\u4e0a\u6d77\u5230\u5e7f\u5dde\u7684\u76f4\u7ebf\u8ddd\u79bb\uff09","text":"<p>\u5b58</p> <pre><code>EVAL \"return redis.call('GEOADD',KEYS[1],ARGV[1],ARGV[2],ARGV[3],ARGV[4],ARGV[5],ARGV[6])\" 1 drawing 121.472644 31.231706 Shanghai 113.280637 23.125178 Guangzhou\n</code></pre> <p>\u53d6</p> <pre><code>EVAL \"return redis.call('GEODIST',KEYS[1],ARGV[1],ARGV[2])\" 1 drawing Shanghai Guangzhou\n</code></pre>"},{"location":"redis/#luabitmapredis","title":"Lua\u64cd\u4f5cBitmap\uff08\u4fee\u6539Redis\u503c\u5185\u5b58\u504f\u79fb\u91cf\uff09","text":"<pre><code>set bigtmap_a  a\nEVAL \"redis.call('SETBIT',KEYS[1],ARGV[1],ARGV[2]) redis.call('SETBIT',KEYS[1],ARGV[3],ARGV[4]) \" 1 bigtmap_a 6 1 7 0\nget bigtmap_a\n</code></pre> <p>Lua\u64cd\u4f5cHyperLogLog\uff08\u7edf\u8ba1\u7ad9\u70b9uv\uff09 \u5c06\u8bbf\u95ee\u9875\u9762\u8d27\u63a5\u53e3\u7684\u6bcf\u4e2a\u7528\u6237\u4fe1\u606f\u6dfb\u52a0\u5230 HyperLogLog \u4e2d\u3002</p> <pre><code>EVAL \"redis.call('PFADD',KEYS[1],ARGV[1]) redis.call('PFADD',KEYS[1],ARGV[2]) redis.call('PFADD',KEYS[1],ARGV[3]) \" 1 uv user1 user2  user1\n</code></pre> <p>\u7edf\u8ba1\u65e5\u6d3b</p> <pre><code>EVAL \"return redis.call('PFCOUNT',KEYS[1]) \" 1 uv\n</code></pre>"},{"location":"redis/#lua","title":"Lua\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501","text":"<p>lock</p> <pre><code>EVAL \"local key=KEYS[1] local value = ARGV[1] if redis.call('SETNX',key,value) &gt;0 then redis.call('SETEX', key,ARGV[2], value) return 0 end  return 1\" 1 lock uid123 60\n</code></pre> <p>unlock</p> <pre><code>EVAL \"if redis.call('GET',KEYS[1]) ==ARGV[1] then redis.call('DEL', KEYS[1]) return 0 end return 1\" 1 lock uid123\n</code></pre>"},{"location":"redis/#springlua","title":"\u5728Spring\u4e2d\u8fd0\u884cLua","text":"<p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u4e00\u822c\u4f1a\u4f7f\u7528Jedis\u6216RedisTemplate\u7b49Redis\u7684Java\u5ba2\u6237\u7aef\u5e93\u914d\u5408 <code>EVALSHA</code>\u547d\u4ee4\u8fd0\u884cLua\uff0c\u4e0d\u4f1a\u4f7f\u7528<code>EVAL</code>\uff0c\u540e\u9762\u4f1a\u8bf4\u5b83\u4eec\u8be6\u7ec6\u533a\u522b</p>"},{"location":"redis/#maven","title":"\u5f15\u5165maven\u4f9d\u8d56","text":"<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;\n&lt;/dependency&gt;\n\n&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;\n    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;\n    &lt;version&gt;2.0.7&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"redis/#redistemplatespring","title":"\u521d\u59cb\u5316RedisTemplate\u81f3Spring\u5bb9\u5668","text":"<pre><code>@Bean\npublic RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) {\n    RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();\n    //\u4f7f\u7528fastjson\u4f5c\u4e3a\u5e8f\u5217\u5316\u65b9\u5f0f\n    FastJsonRedisSerializer&lt;Object&gt; serializer = new FastJsonRedisSerializer&lt;&gt;(Object.class);\n    //\u8bbe\u7f6ehash\u7c7b\u578b\u5e8f\u5217\u5316\u65b9\u5f0f\n    template.setHashKeySerializer(new StringRedisSerializer());\n    template.setHashValueSerializer(serializer);\n    //\u8bbe\u7f6estring \u5e8f\u5217\u5316\u65b9\u5f0f\n    template.setKeySerializer(new StringRedisSerializer());\n    template.setValueSerializer(serializer);\n    template.setConnectionFactory(redisConnectionFactory);\n    return template;\n    }\n</code></pre>"},{"location":"redis/#redistemplatelua","title":"\u4f7f\u7528RedisTemplate\u8fd0\u884cLua","text":"<p>RedisTemplate \u505a\u7684\u4e8b\u60c5\u4e3b\u8981\u662f\u5c01\u88c5\u4e86Redis\u6267\u884cLua\u7684\u539f\u751f\u6307\u4ee4\uff0c\u4e3a\u4ee5\u4e0b\u4e24\u79cd</p> <pre><code>EVALSHA sha1 numkeys [key [key ...]] [arg [arg ...]]\nEVAL script numkeys [key [key ...]] [arg [arg ...]]\n\n</code></pre> <p>EVALSHA \u4e0e EVAL \u7684\u533a\u522b\u662f\u524d\u8005\u4f1a\u5c06Lua\u811a\u672c\u7f13\u5b58\u81f3Reids\u5185\u5b58\u4e2d\u5e76\u8fd4\u56de\u4e00\u4e32sha1\u503c\uff0c\u4e0b\u6b21\u6267\u884c\u76f8\u540c\u547d\u4ee4\u65f6\uff0c\u4fbf\u4f1a\u901a\u8fc7\u76f8\u540c\u7684sha1\u503c\u627e\u5230\u5bf9\u5e94\u547d\u4ee4\u6267\u884c\uff08\u82e5\u811a\u672c\u6539\u53d8\u4e86\u4e00\u4e2a\u5b57\u7b26\u8fd9sha1\u503c\u4e5f\u4f1a\u6539\u53d8\uff09</p> <p>\u7f16\u5199Lua\u811a\u672c</p> <p>\u7b2c\u4e00\u6b21\u6267\u884c<code>EVALSHA</code>\u547d\u4ee4\u540e\u5c06\u811a\u672c\u7f13\u5b58\u4f1a\u8fd4\u56de\u4e00\u4e32\u4e0e\u4e4b\u5bf9\u5e94\u7684sha1\u503c</p> <pre><code>#\u4ee5\u4e0b\u4e3a\u5206\u5e03\u5f0f\u9501\u52a0\u9501\nlocal key = KEYS[1] \nlocal value = ARGV[1]\nlocal time = ARGV[2]\nif redis.call('SETNX', key, value) &gt; 0\n  then\n  redis.call('SETEX', key, time, value)\n  return 0\nend\nreturn 1\n</code></pre> <p>\u4f8b\uff1a</p> <p><code>3ac9e3871efe141e7b889378431957fc0a9878f8</code>  \u4e3asha1\u503c</p> <p>\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>EVALSHA 3ac9e3871efe141e7b889378431957fc0a9878f8  1 demo_key 1 60\n</code></pre> <p>\u8fd0\u884c\u4ee5\u4e0a\u547d\u4ee4\u76f8\u5f53\u4e8e\u8fd0\u884c\u4e0a\u9762\u7684Lua\u811a\u672c</p> <p>\u8fd0\u884c\u7ed3\u679c</p> <p></p>"},{"location":"redis/#lua_1","title":"\u5728\u4ee3\u7801\u4e2d\u8fd0\u884c\u4e0a\u8ff0Lua\u811a\u672c","text":"<pre><code> /**\n     * \u4f7f\u7528\u7c7b\u52a0\u8f7d\u5668\u83b7\u53d6lua\u811a\u672c\n     */\n    private final ClassPathResource classPathResource = new ClassPathResource(\"lua/lock.lua\");\n\n    public void synchronizedByLua(String key, long value, long time) {\n        RedisScript&lt;Long&gt; redisScript = RedisScript.of(classPathResource, Long.class);\n        //sha1\n        String sha1 = redisScript.getSha1();\n        System.out.println(sha1);\n        //\u6267\u884cLua\n        Long execute = redisTemplate.execute(redisScript, Lists.newArrayList(key), value, time);\n\n        System.out.println(execute);\n    }\n\n</code></pre>"},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/","title":"synchronized\u5173\u952e\u5b57","text":""},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/#synchronized","title":"synchronized\u5173\u952e\u5b57","text":"<p>JAVA\u5173\u952e\u5b57\uff0c\u4e3a\u4e86\u89e3\u51b3\u7684\u662f\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u8bbf\u95ee\u8d44\u6e90\u7684\u540c\u6b65\u6027\u800c\u8bde\u751f\uff0csynchronized\u5173\u952e\u5b57\u53ef\u4ee5\u4fdd\u8bc1\u88ab\u5b83\u4fee\u9970\u7684\u65b9\u6cd5\u6216\u8005\u4ee3\u7801\u5757\u5728\u4efb\u610f\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c</p>"},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/#_1","title":"\u4f5c\u7528\u8303\u56f4","text":"<p>\u25cf \u4fee\u9970\u666e\u901a\u65b9\u6cd5</p> <p>\u666e\u901a\u65b9\u6cd5\u52a0\u9501\u662f\u5bf9\u8c61\u7ea7\u522b\u7684\uff0c\u4e0d\u540c\u7684\u5bf9\u8c61\u9501\u4e5f\u4e0d\u4e00\u6837\u4e0e\u9759\u6001\u65b9\u6cd5\u662f\u5168\u5c40\u7684\u4e0d\u592a\u4e00\u6837</p> <p>\u25cf \u4fee\u9970\u9759\u6001\u65b9\u6cd5</p> <p>\u9759\u6001\u65b9\u6cd5\u6765\u8bf4 synchronized \u52a0\u9501\u662f\u5168\u5c40\u7684\uff0c\u540c\u4e00\u4e2a\u65f6\u95f4\u53ea\u80fd\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\uff0c\u4e0e\u4fee\u9970\u666e\u901a\u65b9\u6cd5\u4e0d\u540c\u5bf9\u8c61\u6389\u62ff\u5230\u7684\u9501\u4e5f\u4e0d\u540c\uff0c\u4e24\u8005\u7684\u5dee\u5f02\u5982\u6b64</p> <p>\u25cf \u4fee\u9970\u4ee3\u7801\u5757</p> <p>\u65e5\u5e38\u4e2d\u6700\u5e38\u7528\u7684\u65b9\u5f0f\uff0c\u4e0d\u4f1a\u76f4\u63a5\u4fee\u9970\u5728\u65b9\u6cd5\u4e0a\uff0c\u800c\u662f\u4fee\u9970\u5728\u4ee3\u7801\u4e0a</p> <p>synchronized\u4fee\u9970\u7684\u65b9\u6cd5\u4e0e\u4ee3\u7801\u5757\uff0c\u65e0\u8bba\u6b63\u5e38\u6267\u884c\u5b8c\u6bd5\u8fd8\u662f\u629b\u51fa\u5f02\u5e38\uff0c\u90fd\u4f1a\u91ca\u653e\u9501\uff0c\u4e0elock\u9501\u9700\u8981\u624b\u52a8\u91ca\u653e\u4e0d\u592a\u4e00\u6837</p>"},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/#_2","title":"\u9501\u7684\u5347\u7ea7","text":""},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/#_3","title":"\u504f\u5411\u9501","text":"<p>bject head \u5bf9\u8c61\u5934 mark wrok\u4f1a\u4f7f\u752854bit\u8bb0\u5f55\u5177\u4f53\u9501\u7684\u6307\u9488\uff0c\u9501\u6807\u5fd7\u4e3a100\uff0c\u5982\u679c\u6ca1\u6709\u53d1\u751f\u7ade\u4e89\uff0c\u5219\u4e0d\u9700\u8981\u53d1\u751f\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u907f\u514d\u7ebf\u7a0bcpu\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\u5f00\u9500</p>"},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/#_4","title":"\u81ea\u65cb\u9501","text":"<p>\u4e24\u4e2a\u7ebf\u7a0b\u901a\u8fc7\u81ea\u65cbcas\u7684\u65b9\u5f0f \u5c06Mark word 62 bit \u6539\u4e3a \u81ea\u5df1\u6808\u7a7a\u95f4\u4e2d\u7684 lock Record\uff0c\u54ea\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u6210\u529f\uff0c\u5219\u54ea\u4e00\u4e2a\u7ebf\u7a0b\u7ade\u4e89\u5230\u9501\uff0c\u5219\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\u5c1d\u8bd5\u83b7\u53d6\u9501\u4f1a\u7ee7\u7eed\u5f80\u590dcas\u505a\u7a7a\u5faa\u73af\u81ea\u65cb\u64cd\u4f5c\uff0c\u9501\u6807\u5fd7\u4e3a01\uff0c \u9ed8\u8ba4\u662f10\u6b21\uff0c\u53ef\u4ee5\u901a\u8fc7<code>-XX:PreBlockSpin</code> \u914d\u7f6e</p>"},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/#_5","title":"\u81ea\u9002\u5e94\u81ea\u9009\u9501","text":"<p>\u5904\u7406\u5668\u81ea\u65cb\u65f6\u95f4\u4e0d\u56fa\u5b9a\uff0c\u800c\u662f\u6839\u636e\u524d\u4e00\u6b21\u5728\u540c\u4e00\u4e2a\u9501\u4e0a\u7684\u81ea\u65cb\u65f6\u95f4\u548c\u9501\u7684\u62e5\u6709\u8005\u7684\u72b6\u6001\u6765\u51b3\u5b9a\u7684\uff0c\u907f\u514d\u51fa\u73b0\u521a\u597d\u81ea\u65cb\u5b8c\uff0c\u9501\u5c31\u88ab\u91ca\u653e\u7684\u60c5\u51b5</p>"},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/#_6","title":"\u91cd\u91cf\u7ea7\u9501","text":"<p>\u81ea\u65cb\u8d85\u8fc710\u6b21\u6216\u7b49\u5f85\u7684\u7ebf\u7a0b\u8d85\u8fc7cpu\u6838\u5fc3\u6570\u76841/3\uff0c\u5219\u7ebf\u7a0b\u7ade\u4e89\u6bd4\u8f83\u6fc0\u70c8\uff0c\u81ea\u9009\u65cb\u5df2\u7ecf\u65e0\u6cd5\u4fdd\u8bc1\u9ad8\u6548\u7684\u60c5\u51b5\uff0c\u81a8\u80c0\u4e3a\u91cd\u91cf\u7ea7\u9501\uff0cmark wrok \u9501\u6807\u5fd7\u4e3a10\uff0c\u83b7\u53d6\u4e0d\u5230\u9501\u76f4\u63a5\u8fdb\u5165\u963b\u585e\u72b6\u6001</p>"},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/#_7","title":"\u53ef\u91cd\u5165\u9501","text":"<p>\u4e00\u4e2a\u7ebf\u7a0b\u5728\u6700\u5916\u5c42\u65b9\u6cd5\u4e2d\u83b7\u53d6\u5230\u9501\uff0c\u8fdb\u5165\u91cc\u5c42\u65b9\u6cd5\u65f6\u5019\uff0c\u5982\u679c\u9501\u5bf9\u8c61\u662f\u540c\u4e00\u4e2a\u7684\u3002\u5219\u4e0d\u9700\u8981\u518d\u6b21\u83b7\u53d6  \u8f7b\u91cf\u7ea7\u9501\u662f\u7528\u6237\u6001\uff0c\u4e0d\u9700\u8981\u548c\u5185\u6838\u6253\u4ea4\u9053</p>"},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/#cas","title":"CAS\u7684\u5177\u4f53\u5b9e\u73b0","text":"<p>jdk 11 jdk.internal.misc.unsafe </p> <pre><code>    @HotSpotIntrinsicCandidate\n    public final long compareAndExchangeLongAcquire(Object o, long offset,\n                                                           long expected,\n                                                           long x) {\n        return compareAndExchangeLong(o, offset, expected, x);\n    }\n</code></pre> <p>unsafe \u7684\u5177\u4f53\u5b9e\u73b0\u662f\u7531c++\u6c47\u7f16\u6307\u4ee4\u5b9e\u73b0</p> <pre><code>inline jint     Atomic::cmpxchg    (jint     exchange_value, volatile jint*     dest, jint     compare_value) {\n  int mp = os::is_MP();\n  __asm__ volatile (LOCK_IF_MP(%4) \"cmpxchgl %1,(%3)\"\n                    : \"=a\" (exchange_value)\n                    : \"r\" (exchange_value), \"a\" (compare_value), \"r\" (dest), \"r\" (mp)\n                    : \"cc\", \"memory\");\n  return exchange_value;\n}\n</code></pre> <p><code>cmpxchgl</code>  \u5bf9\u5e94\u5e95\u5c42\u6c47\u7f16\u6307\u4ee4 <code>lock  cmpxchgl</code>\uff0c\u901a\u8fc7lock\u6307\u4ee4\u4f1a\u9501\u5b9aCPU\u7684\u7f13\u5b58\u884c\u6216\u8005\u9501\u603b\u7ebf\u6765\u6267\u884c\u539f\u5b50\u64cd\u4f5c</p>"},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/#java","title":"JAVA\u5bf9\u8c61\u5934","text":"<p> 64\u4f4d\u865a\u62df\u673a\u4e2d\u5bf9\u8c61\u5934  \u4e3e\u4e2a\u4f8b\u5b50 \uff0c \u5982\u679cnew \u4e00\u4e2a\u7a7a\u7684\u5bf9\u8c61\u51fa\u6765\uff0c\u90a3\u4e48\u5185\u5b58\u5206\u5e03\u5982\u4e0b</p> <pre><code>java.lang.Object object internals:\n OFFSET  SIZE   TYPE DESCRIPTION                               VALUE\n      0     4        (object header)                           05 00 00 00 (00000101 00000000 00000000 00000000) (5)\n      4     4        (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)\n      8     4        (object header)                           00 10 00 00 (00000000 00010000 00000000 00000000) (4096)\n     12     4        (loss due to the next object alignment)\nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n</code></pre> <p>Mark Word</p> <p>\u5bf9\u8c61\u5934Mark Word 8\u5b57\u8282  Calss Pointer</p> <p>\u6307\u9488\u4e00\u822c\u4e3a8\u4e2a\u5b57\u8282\uff0cjava\u5bf9\u8c61\u6307\u9488\u7ecf\u8fc7\u538b\u7f29\u540e\u4e3a4\u5b57\u8282  Instance Data</p> <p>\u5bf9\u8c61\u6570\u636e\uff0c\u56e0\u4e3a\u6211\u4eecnew\u51fa\u6765\u7684\u5c5e\u6027\u90fd\u662f\u7a7a\uff0c\u6240\u4ee5 Instance Data \u4e3a 0 \u5b57\u8282 padding</p> <p>loss due to the next object alignment</p> <p>\u4ee5\u4e0a\u603b\u5171\u52a0\u8d77\u6765\u4e3a12\u5b57\u8282\uff0c\u7531\u4e8e\u5185\u5b58\u5bf9\u9f50\u7b26\u5408\u4ee5\u4e0b\u8bbe\u8ba1\u89c4\u8303</p> <p>\u25cf \u901a\u5e38\u5185\u5b58\u662f\u7531\u4e00\u4e2a\u4e2a\u5b57\u8282\u7ec4\u6210\u7684\uff0ccpu\u5728\u5b58\u53d6\u6570\u636e\u65f6\uff0c\u5e76\u4e0d\u662f\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u5b58\u50a8\uff0c\u800c\u662f\u4ee5\u5757\u4e3a\u5355\u4f4d\u5b58\u53d6</p> <p>\u25cf \u5757\u7684\u5927\u5c0f\u4e3a\u5185\u5b58\u5b58\u53d6\u529b\u5ea6\u3002\u9891\u7e41\u5b58\u53d6\u5b57\u8282\u672a\u5bf9\u9f50\u7684\u6570\u636e\uff0c\u4f1a\u6781\u5927\u964d\u4f4ecpu\u7684\u6027\u80fd\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u51cf\u5c11\u5b58 \u6700\u540e\u53c8<code>padding</code>\u8fdb\u884c\u5185\u5b58\u5bf9\u5176\uff0c\u8865\u9f504\u4e2a\u5b57\u8282\uff0c\u6700\u540eobject \u5b57\u8282\u5927\u5c0f\u4e3a16\u5b57\u8282</p>"},{"location":"synchronized%E5%85%B3%E9%94%AE%E5%AD%97/#monitorenter-monitorexit","title":"Monitor.Enter() \u548cMonitor.Exit()","text":"<p>synchronized \u4f1a\u5728\u5f00\u59cb\u65f6\u5019\u5728\u540c\u6b65\u4ee3\u7801\u5757\u5f00\u59cb\u65f6\u6dfb\u52a0 Monitor.Enter \u6307\u4ee4\u518d\u540c\u6b65\u4ee3\u7801\u5757\u7ed3\u675f\u65f6\u6dfb\u52a0Monitor.Exit\u6307\u4ee4</p>"},{"location":"%E4%BD%BF%E7%94%A8minikube%E5%AE%89%E8%A3%85Kubernetes/","title":"\u4f7f\u7528minikube\u5b89\u88c5Kubernetes","text":"<p>minikube \u4e3b\u8981\u57fa\u4e8e\u8fd0\u884c\u4e00\u4e2a\u5355\u8282\u70b9 Kubernetes \u96c6\u7fa4\uff0c\u4ee5\u4fbf\u652f\u6301\u5728\u672c\u5730\u673a\u5668\u4e0a\u7684 VM \u5185\u8fdb\u884c\u5f00\u53d1\u3002\u5b83\u652f\u6301\u865a\u62df\u673a\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5982 VirtualBox\u3001HyperV\u3001KVM2\u3002\u7531\u4e8e Minikube \u662f Kubernetes \u4f53\u7cfb\u4e2d\u76f8\u5bf9\u6210\u719f\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u652f\u6301\u7684\u529f\u80fd\u5217\u8868\u975e\u5e38\u4ee4\u4eba\u5370\u8c61\u6df1\u523b\u3002\u8fd9\u4e9b\u529f\u80fd\u662f\u8d1f\u8f7d\u5747\u8861\u5668\u3001\u591a\u96c6\u7fa4\u3001\u8282\u70b9\u7aef\u53e3\u3001\u6301\u4e45\u5377\u3001\u5165\u53e3\u3001\u4eea\u8868\u677f\u6216\u5bb9\u5668\u8fd0\u884c\u65f6\u3002 </p>"},{"location":"%E4%BD%BF%E7%94%A8minikube%E5%AE%89%E8%A3%85Kubernetes/#brew","title":"\u4f7f\u7528brew\u547d\u4ee4\u5b89\u88c5:","text":"<pre><code>brew install minikube\n</code></pre>"},{"location":"%E4%BD%BF%E7%94%A8minikube%E5%AE%89%E8%A3%85Kubernetes/#_1","title":"\u67e5\u770b\u5b89\u88c5\u8def\u5f84","text":"<pre><code>which minikube\n</code></pre> <p><code>/opt/homebrew/bin/minikube</code></p>"},{"location":"%E4%BD%BF%E7%94%A8minikube%E5%AE%89%E8%A3%85Kubernetes/#minikube","title":"\u542f\u52a8 minikube","text":"<pre><code>dengqing@mayundeMacBook-Pro ~ % minikube start\n\ud83d\ude04  Darwin 11.2 (arm64) \u4e0a\u7684 minikube v1.26.1\n\ud83d\udc4e  Unable to pick a default driver. Here is what was considered, in preference order:\n\ud83d\udca1  Alternatively you could install one of these drivers:\n    \u25aa docker: Not installed: exec: \"docker\": executable file not found in $PATH\n    \u25aa hyperkit: Not installed: exec: \"hyperkit\": executable file not found in $PATH\n    \u25aa parallels: Not installed: exec: \"prlctl\": executable file not found in $PATH\n    \u25aa vmware: Not installed: exec: \"docker-machine-driver-vmware\": executable file not found in $PATH\n    \u25aa virtualbox: Not installed: unable to find VBoxManage in $PATH\n    \u25aa podman: Not installed: exec: \"podman\": executable file not found in $PATH\n    \u25aa qemu2: Not installed: exec: \"qemu-system-aarch64\": executable file not found in $PATH\n\n\u274c  Exiting due to DRV_NOT_DETECTED: No possible driver was detected. Try specifying --driver, or see https://minikube.sigs.k8s.io/docs/start/\n\n</code></pre> <p>\u539f\u56e0\u662f\u6ca1\u6709\u9ed8\u8ba4\u7684\u9a71\u52a8\uff0c\u5b89\u88c5docker \u4f5c\u4e3a\u9ed8\u8ba4\u9a71\u52a8</p> <pre><code>brew install --cask --appdir=/Applications docker\n</code></pre> <p>\u542f\u52a8\u6210\u529f</p> <pre><code>hk@mayundeMacBook-Pro ~ % minikube start\n\ud83d\ude04  Darwin 11.2 (arm64) \u4e0a\u7684 minikube v1.26.1\n\ud83c\udf89  minikube 1.29.0 is available! Download it: https://github.com/kubernetes/minikube/releases/tag/v1.29.0\n\ud83d\udca1  To disable this notice, run: 'minikube config set WantUpdateNotification false'\n\n\u2728  \u81ea\u52a8\u9009\u62e9 docker \u9a71\u52a8\n\ud83d\udccc  Using Docker Desktop driver with root privileges\n\ud83d\udc4d  Starting control plane node minikube in cluster minikube\n\ud83d\ude9c  Pulling base image ...\n\ud83d\udcbe  Downloading Kubernetes v1.24.3 preload ...\n    &gt; preloaded-images-k8s-v18-v1...:  342.82 MiB / 342.82 MiB  100.00% 924.64 \n    &gt; gcr.io/k8s-minikube/kicbase:  348.00 MiB / 348.00 MiB  100.00% 511.18 KiB\n\ud83d\udd25  Creating docker container (CPUs=2, Memory=4000MB) ...\n\ud83d\udc33  \u6b63\u5728 Docker 20.10.17 \u4e2d\u51c6\u5907 Kubernetes v1.24.3\u2026\n    \u25aa Generating certificates and keys ...\n    \u25aa Booting up control plane ...\n    \u25aa Configuring RBAC rules ...\n\ud83d\udd0e  Verifying Kubernetes components...\n    \u25aa Using image gcr.io/k8s-minikube/storage-provisioner:v5\n\ud83c\udf1f  Enabled addons: storage-provisioner, default-storageclass\n\ud83c\udfc4  Done! kubectl is now configured to use \"minikube\" cluster and \"default\" namespace by default \n</code></pre> <p>\u6253\u5f00Kubernetes\u63a7\u5236\u53f0 \uff0c\u51fa\u73b0\u4ee5\u4e0b\u9519\u8bef</p> <pre><code>minikube dashboard\n\ud83d\udd0c  \u6b63\u5728\u5f00\u542f dashboard ...\n\u25aa Using image kubernetesui/dashboard:v2.6.0\n\u25aa Using image kubernetesui/metrics-scraper:v1.0.8\n\ud83e\udd14  \u6b63\u5728\u9a8c\u8bc1 dashboard \u8fd0\u884c\u60c5\u51b5 ...\n\ud83d\ude80  Launching proxy ...\n\ud83e\udd14  \u6b63\u5728\u9a8c\u8bc1 proxy \u8fd0\u884c\u72b6\u51b5 ...\n\n\u274c  Exiting due to SVC_URL_TIMEOUT: http://127.0.0.1:5077/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ is not accessible: checkURL: Get \"http://127.0.0.1:5077/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/\": dial tcp 127.0.0.1:5077: connect: connection refused\n</code></pre>"},{"location":"%E4%BD%BF%E7%94%A8minikube%E5%AE%89%E8%A3%85Kubernetes/#minikube-log","title":"\u5220\u9664minikube \u91cd\u65b0\u542f\u52a8\u5e76\u67e5\u770blog\u8f93\u51fa","text":"<pre><code>minikube delete\nminikube start\nminikube dashboard --alsologtostderr -v=\n</code></pre>"},{"location":"%E4%BD%BF%E7%94%A8minikube%E5%AE%89%E8%A3%85Kubernetes/#_2","title":"\u542f\u52a8\u6210\u529f\u8f93\u51fa","text":"<pre><code>W0317 15:39:06.172493   56978 out.go:239] \ud83e\udd14  \u6b63\u5728\u9a8c\u8bc1 proxy \u8fd0\u884c\u72b6\u51b5 ...\n\ud83e\udd14  \u6b63\u5728\u9a8c\u8bc1 proxy \u8fd0\u884c\u72b6\u51b5 ...\nI0317 15:39:06.188821   56978 dashboard.go:212] http://127.0.0.1:58992/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ response: &lt;nil&gt; &amp;{Status:200 OK StatusCode:200 Proto:HTTP/1.1 ProtoMajor:1 ProtoMinor:1 Header:map[Accept-Ranges:[bytes] Audit-Id:[fe8d4733-509f-4140-b066-240ca91d76ef] Cache-Control:[no-cache, private no-cache, no-store, must-revalidate] Content-Type:[text/html; charset=utf-8] Date:[Fri, 17 Mar 2023 07:39:06 GMT] Last-Modified:[Tue, 31 May 2022 15:30:52 GMT]] Body:0x14000a5eae0 ContentLength:-1 TransferEncoding:[] Close:false Uncompressed:true Trailer:map[] Request:0x14000fa2c00 TLS:&lt;nil&gt;}\nI0317 15:39:06.206370   56978 out.go:177] \ud83c\udf89  Opening http://127.0.0.1:58992/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...\n\ud83c\udf89  Opening http://127.0.0.1:58992/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...\nI0317 15:39:06.415533   56978 dashboard.go:127] Success! I will now quietly sit around until kubectl proxy exits!\n</code></pre>"},{"location":"%E4%BD%BF%E7%94%A8minikube%E5%AE%89%E8%A3%85Kubernetes/#_3","title":"\u6253\u5f00\u6d4f\u89c8\u5668","text":"<p>http://127.0.0.1:58992/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/#/workloads?namespace=default</p> <p></p>"},{"location":"%E4%BD%BF%E7%94%A8minikube%E5%AE%89%E8%A3%85Kubernetes/#_4","title":"\u521b\u5efa\u5e94\u7528","text":"<p>\u5728\u5bb9\u5668\u4e2d\u5c1d\u8bd5\u521b\u5efa\u4e00\u4e2anginx</p> <pre><code>kubectl create deployment test-nginx --image=nginx:1.23.0\n</code></pre> <p>\u66b4\u973280\u7aef\u53e3</p> <pre><code>kubectl expose deployment test-nginx --port=80  --type=NodePor\n</code></pre> <p>\u53ef\u4ee5\u628a Node \u4e3b\u673a\u7aef\u53e3 \u8f6c\u53d1 \u5230 pod \u7aef\u53e3</p> <pre><code>kubectl port-forward  --address 0.0.0.0   service/test-nginx 80:80\n</code></pre> <p>\u8bbf\u95eeniginx  <code>http://localhost/</code> </p>"},{"location":"%E5%86%85%E5%AD%98%E5%8F%AF%E8%A7%81%E6%80%A7/","title":"\u5185\u5b58\u53ef\u89c1\u6027","text":"<p>\u7ebf\u7a0b\u4e4b\u95f4\u901a\u4fe1\uff0c\u6709\u4e3b\u5b58\u548c\u5de5\u4f5c\u5185\u5b58\u7684\u6982\u5ff5\uff0c\u7ebf\u7a0b\u6267\u884c\u7684\u4e00\u822c\u4e09\u4e2a\u6b65\u9aa4\uff1a \u4ece1\u3001\u4e3b\u5b58\u8bfb\u53d6\u6570\u636e 2\u3001\u4fee\u6539\u6570\u636e 3\u3001\u5199\u56de\u4e3b\u5b58\u3002\u5982\u679c\u6709\u4e24\u4e2a\u7ebf\u7a0b\u3002A\u7ebf\u7a0b\u6267\u884c\u4fee\u6539\u4ee5\u540e\u4e0d\u80fd\u53ca\u65f6\u540c\u6b65\u5230\u5171\u4eab\u5185\u5b58\u4e2d\uff0c \u5219\u5bf9B\u7ebf\u7a0b\u6765\u8bf4\uff0c\u6570\u636e\u662f\u4e0d\u53ef\u89c1\u7684\uff0c\u5982\u679cB\u7ebf\u7a0b\u518d\u8bd5\u56fe\u53bb\u64cd\u4f5c\u5185\u5b58\uff0c\u90a3\u4e48\u5c31\u4f1a\u4ea7\u751f\u6570\u636e\u5b89\u5168\u95ee\u9898</p>"},{"location":"%E5%86%85%E5%AD%98%E5%8F%AF%E8%A7%81%E6%80%A7/#_2","title":"\u5e76\u53d1\u7f16\u7a0b\u6570\u636e\u5b89\u5168\u51fa\u73b0\u7684\u539f\u56e0","text":"<p>1\u3001\u5185\u5b58\u4e0d\u53ef\u89c1\uff08\u7ebf\u7a0bA\u65e0\u6cd5\u770b\u5230\u7ebf\u7a0bBcpu\u7f13\u5b58\u4e2d\u6240\u4fee\u6539\u7684\u5185\u5bb9\uff09</p> <p>2\u3001cpu\u4e0d\u662f\u539f\u5b50\u6027\uff08\u540c\u4e00\u6bb5\u903b\u8f91\u64cd\u4f5ccpu\u4f1a\u4f7f\u7528\u4e0d\u540c\u7ebf\u7a0b\u5206\u65f6\u590d\u7528\u53bb\u6267\u884c\uff09</p> <p>3\u3001\u65e0\u5e8f\u6027\uff08\u7f16\u8bd1\u5668\u548c\u5904\u7406\u8d77\u4f1a\u5bf9\u4ee3\u7801\u8fdb\u884c\u6307\u4ee4\u91cd\u6392\uff0c\u5148\u6267\u884c\u7684\u4ee3\u7801\u53ef\u80fd\u540e\u6267\u884c\uff09</p>"},{"location":"%E5%86%85%E5%AD%98%E5%8F%AF%E8%A7%81%E6%80%A7/#java-jmm","title":"JAVA\u5b58\u6a21\u578b JMM","text":"<p>\u5b9a\u4e49\u4e86\u5982\u4f55\u5728\u5355\u7ebf\u7a0b\u6216\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u7684\u7ebf\u7a0b\u548c\u786c\u4ef6\u4e4b\u95f4\u8fdb\u884c\u6570\u636e\u7684\u5b58\u50a8\u548c\u4ea4\u6362\u3002 \u56f4\u7ed5\u7740\u5728\u5e76\u53d1\u8fc7\u7a0b\u4e2d\u5982\u4f55\u5904\u7406\u53ef\u89c1\u6027\u3001\u539f\u5b50\u6027\u3001\u6709\u5e8f\u6027\u8fd9\u4e09\u4e2a\u7279\u6027\u800c\u5efa\u7acb\u7684\u6a21\u578b\u3002</p> <p>JMM\u5b9a\u4e49\u4e86\u6bcf\u4e2a\u7ebf\u7a0b\u4e0e\u4e2d\u7684\u526f\u672c\u4e0e\u4e3b\u5185\u5b58\u7684\u5173\u7cfb\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u4f1a\u6709\u5355\u72ec\u7684\u526f\u672c\uff0c\u4ece\u4e3b\u5185\u5b58\u4e2dcopy\u51fa\u6765\u5b58\u5165\u81ea\u5df1\u7684\u7ebf\u7a0b\u526f\u672c\u4e2d\uff0c\uff08\u5728 java \u4e2d\uff0c\u6240\u6709\u5b9e\u4f8b\u57df\u3001\u9759\u6001\u57df\u548c\u6570\u7ec4\u5143\u7d20\u5b58\u50a8\u5728\u5806\u5185\u5b58\u4e2d\uff0c\u5c40\u90e8\u53d8\u91cf\uff0c\u65b9\u6cd5\u53c2\u6570\u4e0e\u5f02\u5e38\u53c2\u6570\u5219\u662f\u5b58\u50a8\u5728\u7ebf\u7a0b\u6808\u4e2d\uff0c\u5e76\u4e0d\u5171\u4eab\uff0c\u56fa\u4e0d\u4f1a\u51fa\u73b0\u5b89\u5168\u95ee\u9898\uff09</p>"},{"location":"%E5%86%85%E5%AD%98%E5%8F%AF%E8%A7%81%E6%80%A7/#demo","title":"\u6765\u770b\u4e00\u4e0b\u4e00\u4e2a\u7b80\u6613\u7684demo","text":"<pre><code>public static int i = 0;\n\npublic static void main(String[] args) throws Exception {\n    for (int i = 0; i &lt; 10; i++) {\n        new Thread(Demo::sum).start();\n    }\n    Thread.sleep(3000);\n    System.out.println(i);\n}\n\nprivate static void sum() {\n    while (i &lt; 10000) {\n        i++;\n    }\n}\n</code></pre> <p>\u7531\u4e8e\u53d8\u91cfi\u4e3a\u9759\u6001\u57df\u5904\u4e8e\u5171\u4eab\u5185\u5b58\u4e2d\uff0c\u5f53\u7ed3\u679c\u8f93\u51fa10001\u8bf4\u660e\u5f53\u67d0\u4e2a\u7ebf\u7a0b\u53bb\u62ff\u5230\u4e3b\u5185\u5b58\u4e2di\u53d8\u91cf\u65f6\uff0c\u67d0\u4e2a\u7ebf\u7a0b\u6b63\u5728\u4fee\u6539\u81ea\u5df1\u7ebf\u7a0b\u526f\u672c\u4e2d\u7684i\u53d8\u91cf\u4f46\u662f\u5374\u6ca1\u6709\u53ca\u65f6\u540c\u6b65\u5230\u4e3b\u5185\u5b58\u4e2d\u53bb\uff0c\u5e76\u4e14i++\u8fd9\u4e2a\u64cd\u4f5c\u5e76\u4e0d\u662f\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u6240\u4ee5\u5bfc\u81f4\u5176\u4ed6\u7ebf\u7a0b\u53bb\u5185\u5b58\u4e2d\u540c\u6b65\u81ea\u8eab\u7ebf\u7a0b\u526f\u672c\u4e2d\u7684\u6570\u636e\u65f6\u62ff\u5230\u4e86\u810f\u6570\u636e\uff0c\u9020\u6210\u4e86\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\uff0c\u671f\u671b\u503c\u662f10000\u4f46\u662f\u8f93\u51fa\u7684\u7ed3\u679c\u5374\u662f\u4e3a10001</p> <p></p> <p>\u90a3\u4e48\u9020\u6210\u53d8\u91cfi\u8f93\u51fa\u503c\u4e3a10001\u7684\u8fc7\u7a0b\u5927\u81f4\u5982\u4e0b </p>"},{"location":"%E5%86%85%E5%AD%98%E5%8F%AF%E8%A7%81%E6%80%A7/#cpu","title":"cpu\u7ed3\u6784","text":""},{"location":"%E5%86%85%E5%AD%98%E5%8F%AF%E8%A7%81%E6%80%A7/#_3","title":"\u5185\u5b58\u4e0d\u53ef\u89c1\u5e26\u6765\u7684\u5f71\u54cd","text":"<p>\u4e0b\u9762\u6765\u770b\u53e6\u5916\u4e00\u6bb5\u4ee3\u7801\uff0c\u671f\u671b\u7a0b\u5e8f\u8fd0\u884c\u7684\u7ed3\u679c\u662f\u7ebf\u7a0bA\u4e0e\u7ebf\u7a0bB\u4ea4\u66ff\u6267\u884c\u540450\u6b21\uff0c\u7136\u800c\uff0c\u8be5\u4ee3\u7801\u6bb5\u6267\u884c\u7684\u7ed3\u679c\u53ef\u80fd\u662f\u6267\u884c\u4e00\u6b21\u540e\u5c06\u6c38\u8fdc\u6302\u8d77</p> <pre><code>\nprivate  static boolean flag = false;\n\npublic static void main(String[] args) {\n    new Thread(() -&gt; {\n        int num = 1;\n        while (num &lt;= 50) {\n            if (flag) {\n                System.out.println(\"\u7ebf\u7a0bA\u6267\u884c\" + num);\n                flag = false;\n                num++;\n            }\n        }\n    }).start();\n    new Thread(() -&gt; {\n        int num = 1;\n        while (num &lt;= 50) {\n            if (!flag) {\n                System.out.println(\"\u7ebf\u7a0bB\u6267\u884c\" + num);\n                flag = true;\n                num++;\n            }\n        }\n    }).start();\n\n}\n</code></pre> <p></p> <p>\u7531\u4e8e\u7ebf\u7a0b\u7684\u4e0d\u53ef\u89c1\u6027\u7ebf\u7a0bA\u4e0e\u7ebf\u7a0bB\u7684\u5de5\u4f5c\u5185\u5b58\u5e76\u4e0d\u5171\u4eab\uff0c\u76f8\u5bf9\u72ec\u7acb\uff0c\u7ebf\u7a0bA\u4e0e\u7ebf\u7a0bB\u5e76\u4e0d\u80fd\u53ca\u65f6\u77e5\u9053\u5bf9\u65b9\u5bf9\u4e3b\u5185\u5b58\u7684flag\u53d8\u91cf\u7684\u4efb\u4f55\u64cd\u4f5c\uff0c\u6240\u4ee5\u7a0b\u5e8f\u8fd0\u884c\u8d77\u6765\u5219\u4f1a\u9020\u6210\u5047\u6b7b\u72b6\u6001 \uff0cJava \u5185\u5b58\u6a21\u578b\u7684\u62bd\u8c61\u793a\u610f\u56fe\u5982\u4e0b </p>"},{"location":"%E5%86%85%E5%AD%98%E5%8F%AF%E8%A7%81%E6%80%A7/#volatile","title":"volatile \u5173\u952e\u5b57\u7684\u4f5c\u7528","text":"<p>\u4e3a\u4e86\u89e3\u51b3\u5982\u4e0a\u95ee\u9898\uff0cJDK5\u5f00\u59cb\u5f15\u5165\u4e86\u5173\u952e\u5b57<code>volatile</code> JSR-133\u89c4\u8303\u4e2d\uff0c\u5b9a\u4e49\u4e86\u5173\u952e\u5b57<code>volatile</code>\uff0c\u5f53\u88ab\u8be5\u5173\u952e\u5b57\u4fee\u9970\u7684\u53d8\u91cf\uff0c\u7ebf\u7a0b\u5c06\u4f1a\u5c06\u6bcf\u4e00\u6b21\u5199\u7684\u64cd\u4f5c\u90fd\u540c\u6b65\u5230\u4e3b\u5185\u5b58\u4e2d\uff0c<code>volatile</code> \u6bcf\u4e00\u6b21\u5199\u5165\u64cd\u4f5c\u90fd\u5728\u8bfb\u53d6\u64cd\u4f5c\u4e4b\u524d\uff0c\u6240\u4ee5volatile\u4e5f\u53ef\u4ee5\u662f\u88ab\u79f0\u4f5c\u4e3a\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u9501\uff0c\u4ed6\u80fd\u591f\u4fdd\u8bc1\u7ebf\u7a0b\u7684\u4e2d\u7684\u53d8\u91cf\u662f\u53ef\u89c1\u7684\uff0c\u53ef\u4ee5\u5229\u7528\u8fd9\u4e00\u70b9\u53bb\u505a\u5230\u7ebf\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\u3002 \u90a3\u4e48\u5c06\u4e0a\u8bc9\u4ee3\u7801\u7a0d\u4f5c\u6539\u52a8\uff0c\u4e3a\u4e86\u786e\u4fdd\u5bf9\u53d8\u91cfi\u7684\u66f4\u65b0\u53ef\u4ee5\u4f20\u64ad\u5230\u5176\u4ed6\u7ebf\u7a0b\uff0c\u6211\u4eec\u5e94\u8be5\u5c06<code>volatile</code> \u4fee\u9970\u7b26\u5e94\u7528\u4e8e<code>i</code>\u53d8\u91cf</p> <pre><code>private volatile static boolean flag = false;\n\npublic static void main(String[] args) {\n    new Thread(() -&gt; {\n        int num = 1;\n        while (num &lt;= 50) {\n            if (flag) {\n                System.out.println(\"\u7ebf\u7a0bA\u6267\u884c\" + num);\n                flag = false;\n                num++;\n            }\n        }\n    }).start();\n    new Thread(() -&gt; {\n        int num = 1;\n        while (num &lt;= 50) {\n            if (!flag) {\n                System.out.println(\"\u7ebf\u7a0bB\u6267\u884c\" + num);\n                flag = true;\n                num++;\n            }\n        }\n    }).start();\n}\n</code></pre> <p> \u5982\u4e0a\u6240\u8ff0\uff0c\u6211\u4eec\u8fd0\u884c\u65f6\u4e0e\u4e0d\u540c\u6838\u5fc3\u5904\u7406\u5668\u8fdb\u884c\u901a\u4fe1\uff0c\u4ee5\u4e0d\u91cd\u65b0\u6392\u5e8f\u4efb\u4f55\u6d89\u53ca<code>volatile</code>\u53d8\u91cf\u7684\u6307\u4ee4\u3002\u6b64\u5916\uff0c\u5904\u7406\u5668\u4f1a\u7acb\u5373\u5237\u65b0\u5bf9\u8fd9\u4e9b\u53d8\u91cf\u7684\u4efb\u4f55\u66f4\u65b0\u3002</p> <p></p> <p><code>volatile</code>\u53ef\u4ee5\u5e2e\u52a9\u786e\u4fdd\u6570\u636e\u66f4\u6539\u7684\u53ef\u89c1\u6027\u4e0e\u907f\u514d\u90e8\u5206\u6307\u4ee4\u91cd\u6392\u5e8f\uff0c\u800c\u4e0d\u63d0\u4f9b\u4e92\u65a5\u3002\u56e0\u6b64\uff0c\u5b83\u5728\u6211\u4eec\u53ef\u4ee5\u5141\u8bb8\u591a\u4e2a\u7ebf\u7a0b\u5e76\u884c\u6267\u884c\u4ee3\u7801\u5757\u7684\u5730\u65b9\u5f88\u6709\u7528\uff0c\u6211\u4eec\u53ea\u9700\u8981\u786e\u4fdd\u53ef\u89c1\u6027</p>"},{"location":"%E5%86%85%E5%AD%98%E5%8F%AF%E8%A7%81%E6%80%A7/#longdouble","title":"Long\u4e0eDouble\u5728\u591a\u7ebf\u7a0b\u4e2d\u7684\u60c5\u51b5","text":"<p>JAVA\u7684\u5185\u5b58\u6a21\u578b\u53ea\u4fdd\u8bc1\u4e86\u57fa\u672c\u53d8\u91cf\u7684\u8bfb\u53d6\u64cd\u4f5c\u548c\u5199\u5165\u64cd\u4f5c\u90fd\u5fc5\u987b\u662f\u539f\u5b50\u64cd\u4f5c\u7684\uff0c\u4f46\u662f\u5bf9\u4e8e64\u4f4d\u5b58\u50a8\u7684Long\u548cDouble\u7c7b\u578b\u6765\u8bf4\uff0cJVM\u8bfb\u64cd\u4f5c\u548c\u5199\u64cd\u4f5c\u662f\u5206\u5f00\u7684\uff0c\u5206\u89e3\u4e3a2\u4e2a32\u4f4d\u7684\u64cd\u4f5c\uff0c \u5982\u679c\u4e0d\u505a\u4efb\u4f55\u5904\u7406\uff0c\u5f53\u591a\u4e2a\u7ebf\u7a0b\u8bfb\u53d6Long\u53d8\u91cf\u6216Double\u53d8\u91cf\u65f6\uff0c\u53ef\u80fd\u51fa\u73b0\u8bfb\u53d6\u8fd9\u4e2a\u53d8\u91cf\u4e00\u4e2a\u503c\u7684\u9ad832\u4f4d\u548c\u53e6\u4e00\u4e2a\u503c\u7684\u4f4e32\u4f4d\uff0c\u4ece\u800c\u5bfc\u81f4\u6570\u636e\u7684\u9519\u4e71\u3002\u6240\u4ee5\u5982\u679c\u8981\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u58f0\u660eLong\u548cDouble\u5b57\u6bb5\uff0c\u90a3\u4e48\u5fc5\u987b\u5728<code>synchronized</code>\u4e2d\u64cd\u4f5c\u6216\u4f7f\u7528<code>volatile</code>\u505a\u4e3a\u4fee\u9970\u7b26</p>"},{"location":"%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/","title":"\u6307\u4ee4\u91cd\u6392","text":""},{"location":"%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#happens-before","title":"\u6307\u4ee4\u91cd\u6392\u4e0eHappens-Before","text":""},{"location":"%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#_1","title":"\u7f16\u8bd1\u5668\u7684\u4f18\u5316","text":"<p>\u4e3e\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\uff1a</p> <pre><code>public class Test {\n\n    public static void main(String[] args) {\n        int leng = 0;\n        int wid = 0;\n        int length = 2;\n        int width = 3;\n        leng = length;\n        wid = width;\n        int area = leng * wid;\n        System.out.println(area);\n    }\n\n}\n</code></pre> <pre><code>javap -c Test.class\n</code></pre> <p>\u5c06\u4ee3\u7801\u4ee3\u7801\u7f16\u8bd1\u51fa\u6765\u67e5\u770b\u6307\u4ee4\u96c6\u5408</p> <pre><code> public static void main(java.lang.String[]);\n    Code:\n       0: iconst_2   //\u5c06int 2 \u5165\u6808 \n       1: istore_3  //\u5c06int 2 \u5b58\u50a8\u5230\u7b2c\u4e09\u4e2a\u53d8\u91cf\u4e2d\n       2: iconst_3  //\u5c06int 3 \u5165\u6808 \n       3: istore        4  //\u5c06int 3 \u5b58\u50a8\u5230\u7b2c\u56db\u4e2a\u53d8\u91cf\u4e2d\n       5: iload_3    // \u5c06\u7b2c\u4e09\u4e2aint \u7c7b\u578b\u53d8\u91cf\u8fdb\u6808 \u4e5f\u5c31\u662f length=2\n       6: istore_1  // length=2 \u653e\u5165\u7b2c\u4e00\u4e2a\u53d8\u91cf\u4e2d leng=length\n       7: iload         4  //\u5c06int 3 \u5b58\u50a8\u5230\u7b2c\u56db\u4e2a\u53d8\u91cf\u4e2d\n       9: istore_2   // wid=width;\u5c06\u7b2c\u56db\u4e2a\u53d8\u91cf\u653e\u5165\u7b2c2\u4e2a\u53d8\u91cf\u4e2d\n      10: iload_1  // \u52a0\u8f7d\u7b2c\u4e00\u4e2a\u53d8\u91cf\n      11: iload_2  // \u52a0\u8f7d\u7b2c\u4e8c\u4e2a\u53d8\u91cf\n      12: imul   //\u4e24\u8005\u76f8\u4e58\n      13: istore        5\n      15: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;\n      18: iload         5\n      20: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V\n      23: return\n}\n\n</code></pre> <p>\u53d1\u73b0java\u5728\u7f16\u8bd1\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5bf9\u76f8\u5173\u4ee3\u7801\u7684\u7ed3\u6784\u4f5c\u51fa\u4f18\u5316\uff0c\u7f16\u8bd1\u987a\u5e8f\u4e0e\u7ed3\u6784\uff0c\u6309\u7167\u9884\u671f\u7684\u7ed3\u6784\u5e94\u8be5\u6307\u4ee4\u96c6\u7684\u524d\u90e8\u5206\u5e94\u8be5\u662f</p> <pre><code>   0: iconst_0 //\u5c06int 0 \u5165\u6808 \n   1: istore_1 //\u5c06int 0 \u5b58\u50a8\u5230\u7b2c1\u4e2a\u53d8\u91cf\u4e2d\n   2: iconst_0 //\u5c06int 0 \u5165\u6808 \n   3: istore_2 //\u5c06int 0 \u5b58\u50a8\u5230\u7b2c2\u4e2a\u53d8\u91cf\u4e2d\n</code></pre> <p>\u4f46\u662f\u5b9e\u9645\u751f\u6210\u7684\u5b57\u8282\u7801\u96c6\u5408\u5374\u5e76\u4e0d\u662f\u5f88\u7b26\u5408\u9884\u671f\u7ed3\u679c\uff0c\u539f\u56e0\u662f\u56e0\u4e3a\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\uff0c\u56de\u68c0\u67e5\u4ee3\u7801\u7684\u4e0a\u4e0b\u6587\uff0c\u5bf9\u5176\u7ed3\u6784\u8fdb\u884c\u8c03\u6574\uff0c\u5728\u4ee3\u78018\u30019\u884c\u4e2d\u5bf9\u53d8\u91cf\u8fdb\u884c\u4e86\u6700\u7ec8\u8d4b\u503c\uff0c\u90a3\u4e48jvm\u5c06\u5bf9\u7f16\u8bd1\u7ed3\u679c\u8fdb\u884c\u4f18\u5316\u3002\u4e5f\u5c31\u662f\u8bf4\u7f16\u8bd1\u5668\u4f1a\u5bf9\u4ee3\u7801\u8fdb\u884c\u91cd\u6392\u5e8f\u3002</p>"},{"location":"%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#_2","title":"\u6307\u4ee4\u91cd\u6392\u6709\u4ee5\u4e0b\u89c4\u5219","text":"<ol> <li>\u7f16\u8bd1\u5668\u4f18\u5316\u7684\u91cd\u6392\u5e8f\u3002\u7f16\u8bd1\u5668\u5728\u4e0d\u6539\u53d8\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u8bed\u4e49\u7684\u524d\u63d0\u4e0b\uff0c\u53ef\u4ee5\u91cd\u65b0\u5b89\u6392\u8bed\u53e5\u7684\u6267\u884c\u987a\u5e8f\u3002</li> <li>\u6307\u4ee4\u7ea7\u5e76\u884c\u7684\u91cd\u6392\u5e8f\u3002\u73b0\u4ee3\u5904\u7406\u5668\u91c7\u7528\u4e86\u6307\u4ee4\u7ea7\u5e76\u884c\u6280\u672f\uff08Instruction-Level Parallelism\uff0c ILP\uff09\u6765\u5c06\u591a\u6761\u6307\u4ee4\u91cd\u53e0\u6267\u884c\u3002\u5982\u679c\u4e0d\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u6027\uff0c\u5904\u7406\u5668\u53ef\u4ee5\u6539\u53d8\u8bed\u53e5\u5bf9\u5e94\u673a\u5668\u6307\u4ee4\u7684\u6267\u884c\u987a\u5e8f\u3002</li> <li>\u5185\u5b58\u7cfb\u7edf\u7684\u91cd\u6392\u5e8f\u3002\u7531\u4e8e\u5904\u7406\u5668\u4f7f\u7528\u7f13\u5b58\u548c\u8bfb / \u5199\u7f13\u51b2\u533a\uff0c\u8fd9\u4f7f\u5f97\u52a0\u8f7d\u548c\u5b58\u50a8\u64cd\u4f5c\u770b\u4e0a\u53bb\u53ef\u80fd\u662f\u5728\u4e71\u5e8f\u6267\u884c</li> </ol> <p>\u4e3a\u4e86\u9a8c\u8bc1\u5176\u731c\u60f3\uff0c\u5bf9\u4e0a\u8ff0\u4ee3\u7801\u7a0d\u505a\u8c03\u6574\uff0c\u6ce8\u91ca8\u30019\u884c</p> <pre><code>public class Test {\n\n    public static void main(String[] args) {\n        int leng = 0;\n        int wid = 0;\n        int length = 2;\n        int width = 3;\n//        leng = length;\n//        wid = width;\n        int area = leng * wid;\n        System.out.println(area);\n    }\n\n}\n</code></pre> <pre><code>  public static void main(java.lang.String[]);\n    Code:\n       0: iconst_0 //\u5c06int 0 \u5165\u6808 \n       1: istore_1 //\u5c06int 0 \u5b58\u50a8\u5230\u7b2c1\u4e2a\u53d8\u91cf\u4e2d\n       2: iconst_0 //\u5c06int 0 \u5165\u6808 \n       3: istore_2 //\u5c06int 0 \u5b58\u50a8\u5230\u7b2c2\u4e2a\u53d8\u91cf\u4e2d\n       4: iconst_2\n       5: istore_3\n       6: iconst_3\n       7: istore        4\n       9: iload_1\n      10: iload_2\n      11: imul\n      12: istore        5\n      14: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;\n      17: iload         5\n      19: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V\n      22: return\n}\n</code></pre> <p>\u6240\u4ee5\u5f97\u51fa\u7ed3\u8bba\uff0c\u6211\u4eec\u7f16\u5199\u7684\u7a0b\u5e8f\u90fd\u8981\u7ecf\u8fc7\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u4f18\u5316\u540e\u624d\u4f1a\u88ab\u8fd0\u884c\uff0c\u4f18\u5316\u5206\u4e3a\u5f88\u591a\u79cd\uff0c\u5176\u4e2d\u6709\u4e00\u79cd\u4f18\u5316\u53eb\u505a\u91cd\u6392\u5e8f\uff0c\u91cd\u6392\u5e8f\u5219\u4e3a\u4e86\u4fdd\u8bc1\u4f18\u5316\u524d\u4e0e\u4f18\u5316\u540e\u7ed3\u679c\u5177\u6709\u4e00\u81f4\u6027\uff0c\u5219\u9700\u8981\u9075\u5faaHappens-Before\u89c4\u5219</p>"},{"location":"%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#happens-before_1","title":"Happens-Before\u89c4\u5219","text":"<p>\u5177\u4f53\u5177\u6709\u4ee5\u4e0b\u89c4\u5219</p> <ol> <li>\u7a0b\u5e8f\u987a\u5e8f\u89c4\u5219\uff1a\u5728\u4e00\u4e2a\u7ebf\u7a0b\u5185\uff0c\u5728\u7a0b\u5e8f\u524d\u9762\u7684\u64cd\u4f5c\u5148\u884c\u53d1\u751f\u4e8e\u540e\u9762\u7684\u64cd\u4f5c</li> <li>\u76d1\u89c6\u5668\u9501\u89c4\u5219\uff1a\u5bf9\u4e00\u4e2a\u9501\u7684\u89e3\u9501\uff0c\u5148\u884c\u53d1\u751f\u4e8e\u968f\u540e\u5bf9\u8fd9\u4e2a\u9501\u7684\u52a0\u9501\u3002</li> <li>volatile\u53d8\u91cf\u89c4\u5219\uff1a\u5bf9\u4e00\u4e2avolatile\u57df\u7684\u5199\uff0c\u5148\u884c\u53d1\u751f\u4e8e\u4efb\u610f\u540e\u7eed\u5bf9\u8fd9\u4e2avolatile\u57df\u7684\u8bfb\u3002\u4f20\u9012\u6027\uff1a\u5982\u679cA happens-before B\uff0c\u4e14B happens-before C\uff0c\u90a3\u4e48A happens-before C</li> <li>start()\u89c4\u5219\uff1aThread \u5bf9\u8c61\u7684 start() \u65b9\u6cd5\u8c03\u7528\u5148\u884c\u53d1\u751f\u4e8e\u6b64\u7ebf\u7a0b\u7684\u6bcf\u4e00\u4e2a\u52a8\u4f5c\u3002</li> <li>join()\u89c4\u5219\uff1a\u5982\u679c\u7ebf\u7a0bA\u6267\u884c\u64cd\u4f5cThread B.join()\u5e76\u6210\u529f\u8fd4\u56de\uff0c\u90a3\u4e48\u7ebf\u7a0bB\u4e2d\u7684\u4efb\u610f\u64cd\u4f5c\u5148\u884c\u53d1\u751f\u4e8e\u7ebf\u7a0bA\u4eceThreadB.join()\u64cd\u4f5c\u6210\u529f\u8fd4\u56de\u3002</li> <li>\u7a0b\u5e8f\u4e2d\u65ad\u89c4\u5219\uff1a\u5bf9\u7ebf\u7a0binterrupted()\u65b9\u6cd5\u7684\u8c03\u7528\u5148\u884c\u4e8e\u88ab\u4e2d\u65ad\u7ebf\u7a0b\u7684\u4ee3\u7801\u68c0\u6d4b\u5230\u4e2d\u65ad\u65f6\u95f4\u7684\u53d1\u751f\u3002</li> <li>\u5bf9\u8c61finalize\u89c4\u5219\uff1a\u4e00\u4e2a\u5bf9\u8c61\u7684\u521d\u59cb\u5316\u5b8c\u6210\uff08\u6784\u9020\u51fd\u6570\u6267\u884c\u7ed3\u675f\uff09\u5148\u884c\u4e8e\u53d1\u751f\u5b83\u7684finalize()\u65b9\u6cd5\u7684\u5f00\u59cb\u3002</li> </ol> <p>Happens-Before\u89c4\u5219 \u5fc5\u987b\u8981\u9075\u5faaas-if-serial \u8bed\u4e49</p> <p>\u4e0d\u7ba1\u600e\u4e48\u91cd\u6392\u5e8f\uff0c\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u6267\u884c\u7ed3\u679c\u4e0d\u80fd\u88ab\u6539\u53d8\u3002\u7f16\u8bd1\u5668\u3001runtime\u548c\u5904\u7406\u5668\u90fd\u5fc5\u987b\u9075\u5b88as-if-serial\u8bed\u4e49\u3002\u6240\u4ee5\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u4e0d\u4f1a\u5bf9\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\u7684\u64cd\u4f5c\u505a\u91cd\u6392\u5e8f\uff0c\u56e0\u4e3a\u8fd9\u79cd\u91cd\u6392\u5e8f\u4f1a\u6539\u53d8\u6267\u884c\u7ed3\u679c\u3002\u4f46\u662f\uff0c\u5982\u679c\u64cd\u4f5c\u4e4b\u95f4\u4e0d\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u5c31\u53ef\u80fd\u88ab\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u91cd\u6392\u5e8f\u3002</p> <pre><code>int leng,wid = 0;\nint length = 2; //\u4e3a\u4e86\u65b9\u4fbf\u8bf4\u660e\u5c06\u8be5\u64cd\u4f5c\u79f0\u4e3a A\nint width = 3; //\u4e3a\u4e86\u65b9\u4fbf\u8bf4\u660e\u5c06\u8be5\u64cd\u4f5c\u79f0\u4e3a B\nint area = leng * wid; //\u4e3a\u4e86\u65b9\u4fbf\u8bf4\u660e\u5c06\u8be5\u64cd\u4f5c\u79f0\u4e3a C\n</code></pre> <p>\u5982\u679c </p> <p>A happens-before B</p> <p>B happens-before C</p> <p>A happens-before C \uff08\u4f20\u9012\u6027\uff09</p> <p>\u5982\u679c\u6839\u636ehappens-before\u8fdb\u884c\u6307\u4ee4\u91cd\u6392\u5e8f\uff0c\u65e0\u8bba B-&gt;A-&gt;C\u8fd8\u662fA-&gt;B-&gt;C ,\u6267\u884c\u7684\u7ed3\u679c\u5e76\u4e0d\u4f1a\u53d1\u751f\u6539\u53d8\uff0c\u56e0\u4e3a\u53ea\u662f\u6539\u53d8\u4e86\u53d8\u91cf\u7684\u8d4b\u503c\u987a\u5e8f\uff0cJMM \u4f1a\u5141\u8bb8\u8fd9\u79cd\u91cd\u6392\u5e8f</p> <p>\u4f46\u662f\u5982\u679c\u6267\u884c\u7684\u987a\u5e8f\u4e3aC-&gt;A-&gt;B\u6216\u8005C-&gt;B-&gt;A\u65f6\uff0c\u8fd9\u79cd\u91cd\u6392\u5e8f\u4f1a\u6539\u53d8\u6267\u884c\u7ed3\u679c\uff0c\u6240\u4ee5\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u4f1a\u9075\u5faa as-if-serial \u8bed\u4e49\u4e0d\u4f1a\u5bf9\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\u7684</p>"},{"location":"%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/#cpu","title":"cpu\u4e0e\u64cd\u4f5c\u7cfb\u7edf","text":""},{"location":"%E7%BA%BF%E4%B8%8AMySql/","title":"\u5982\u4f55\u5229\u7528\u7ebf\u4e0aMySql binlog\u6392\u67e5\u95ee\u9898","text":""},{"location":"%E7%BA%BF%E4%B8%8AMySql/#mysql-binlog","title":"\u89e3\u6790MySql binlog","text":"<p>\u5982\u4f55\u62ff\u5230\u7ebf\u4e0abinlog\u65e5\u5fd7 \u89e3\u6790\u51fa\u6765\u62ff\u5230\u81ea\u5df1\u60f3\u8981\u7684\u4fe1\u606f\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662fmysqlbinlog \u89e3\u6790 </p>"},{"location":"%E7%BA%BF%E4%B8%8AMySql/#_1","title":"\u5177\u4f53\u64cd\u4f5c\u547d\u4ee4","text":"<pre><code>./mysqlbinlog /Users/hk/Downloads/mysql-bin.000011  --base64-output=decode-rows -v --skip-gtids=true |grep -C 100 -i \"brands\" &gt; /Users/hk/Downloads/brands.log\n</code></pre>"},{"location":"%E7%BA%BF%E4%B8%8AMySql/#_2","title":"\u53c2\u6570\u8bf4\u660e","text":"<p><code>./mysqlbinlog</code>:</p> <p>\u7528\u4e8e\u89e3\u6790MySQL\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u547d\u4ee4\uff0c\u7528\u4e8e\u5c06\u4e8c\u8fdb\u5236\u65e5\u5fd7\u8f6c\u6362\u4e3a\u53ef\u8bfb\u7684\u7eaf\u6587\u672c\u683c\u5f0f\u3002</p> <p><code>/Users/hk/Downloads/mysql-bin.000011</code>\uff1a</p> <p>\u89e3\u6790\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u7684\u8def\u5f84\u548c\u6587\u4ef6\u540d\u3002</p> <p><code>--base64-output=decode-rows</code>\uff1a</p> <p>\u4ee5\u53ef\u8bfb\u7684\u5f62\u5f0f\u8f93\u51fa\u4e8c\u8fdb\u5236\u65e5\u5fd7\u8bb0\u5f55\uff0c\u5177\u4f53\u6765\u8bf4\u662f\u4ee5decode-rows\u683c\u5f0f\u8f93\u51fa\uff0c\u8fd9\u901a\u5e38\u7528\u4e8e\u89e3\u6790\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u7684INSERT\u3001UPDATE\u548cDELETE\u8bed\u53e5\u3002</p> <p><code>-v</code>\uff1a</p> <p>\u4ee5\u8be6\u7ec6\u6a21\u5f0f\u8f93\u51fa\u89e3\u6790\u8fc7\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u8f93\u51fa\u4fe1\u606f\u5305\u62ec\u6bcf\u4e2a\u65e5\u5fd7\u4e8b\u4ef6\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5982\u65f6\u95f4\u6233\u3001\u6570\u636e\u5e93\u540d\u3001\u8868\u540d\u3001\u4e8b\u4ef6\u7c7b\u578b\u7b49\u3002</p> <p><code>--skip-gtids=true</code>\uff1a</p> <p>\u8df3\u8fc7GTID\u76f8\u5173\u7684\u4fe1\u606f\uff0cGTID\u662f\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u6807\u8bc6\u7b26\uff0c\u7528\u4e8e\u8ddf\u8e2a\u5728\u4e0d\u540cMySQL\u5b9e\u4f8b\u4e4b\u95f4\u7684\u590d\u5236\u64cd\u4f5c\u3002\u5728\u8fd9\u4e2a\u53c2\u6570\u88ab\u8bbe\u7f6e\u4e3atrue\u65f6\uff0cmysqlbinlog\u5c06\u5ffd\u7565GTID\u4fe1\u606f\u3002</p> <p><code>| grep -C 100 -i \"brands\"</code>\uff1a</p> <p>\u5c06mysqlbinlog\u547d\u4ee4\u8f93\u51fa\u7684\u6587\u672c\u901a\u8fc7\u7ba1\u9053\uff08|\uff09\u4f20\u9012\u7ed9grep\u547d\u4ee4\u3002grep\u662f\u4e00\u4e2a\u7528\u4e8e\u641c\u7d22\u6587\u672c\u7684\u547d\u4ee4\u3002\u8fd9\u4e2a\u7279\u5b9a\u7684grep\u547d\u4ee4\u5c06\u4f1a\uff1a\u5339\u914d\u5305\u542b\"brands\"\u5b57\u7b26\u4e32\u7684\u884c\uff0c\u5e76\u8f93\u51fa\u5176\u524d\u540e100\u884c\u7684\u5185\u5bb9\uff08\u7528\u4e8e\u663e\u793a\u4e0a\u4e0b\u6587\uff09\uff0c\u5e76\u5c06\u641c\u7d22\u7ed3\u679c\u8f93\u51fa\u5230\u5c4f\u5e55\u4e0a\u3002</p> <p>/Users/hk/Downloads/brands.log: \u8fd9\u4e2a\u53c2\u6570\u662f\u5c06\u641c\u7d22\u7ed3\u679c\u8f93\u51fa\u5230brands.log\u6587\u4ef6\u4e2d\u3002\u8f93\u51fa\u91cd\u5b9a\u5411\u8fd0\u7b97\u7b26&gt;\u5c06\u547d\u4ee4\u7684\u6807\u51c6\u8f93\u51fa\uff08\u5373\u63a7\u5236\u53f0\u4e0a\u7684\u8f93\u51fa\uff09\u91cd\u5b9a\u5411\u5230\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"%E7%BA%BF%E4%B8%8AMySql/#_3","title":"\u89e3\u6790\u540e\u65e5\u5fd7","text":"<pre><code>#230425 20:40:03 server id 2727657857  end_log_pos 381609609 CRC32 0x5ed1b475   Delete_rows: table id 13129 flags: STMT_END_F\n### DELETE FROM `soomey`.`brands`\n### WHERE\n###   @1=1490\n###   @2='\u64ad'\n###   @3='VIP'\n###   @4='2022-10-24 11:38:29'\n###   @5=b'0'\n###   @6=346831\n### DELETE FROM `soomey`.`brands`\n### WHERE\n###   @1=1490\n###   @2='broadcast/\u64ad'\n###   @3='TMALL'\n###   @4='2022-10-24 11:38:29'\n###   @5=b'0'\n###   @6=346832\n### DELETE FROM `soomey`.`brands`\n### WHERE\n###   @1=1490\n###   @2='\u64ad\uff08broadcast\uff09'\n###   @3='JD'\n###   @4='2022-10-24 11:38:29'\n###   @5=b'0'\n###   @6=346833\n### DELETE FROM `soomey`.`brands`\n### WHERE\n###   @1=1490\n###   @2='\u64ad broadcast'\n###   @3='DOUYIN'\n###   @4='2022-10-24 11:38:29'\n###   @5=b'0'\n</code></pre>"},{"location":"%E8%BE%93%E5%87%BAchatgtp%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9/","title":"\u5982\u4f55\u5229\u7528streamlit\u6784\u5efa\u5c5e\u4e8e\u4f60\u7684Chat-GTP","text":""},{"location":"%E8%BE%93%E5%87%BAchatgtp%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9/#_1","title":"\u5b9e\u73b0\u6548\u679c","text":""},{"location":"%E8%BE%93%E5%87%BAchatgtp%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9/#_2","title":"\u73af\u5883\u51c6\u5907","text":"<p>\u672c\u5730\u5b89\u88c5<code>Python 3.10</code></p> <p>\u767b\u5f55 OpenAI\u5b98\u7f51\u5de6\u4fa7\u9875\u9762\u4e2d\uff0c\u627e\u5230API Keys\uff0c\u521b\u5efa\u5c5e\u4e8e\u4f60\u7684\u7684API Key\u3002</p> <p>\u6bd4\u5982\u6211\u7684\u662f\uff08\u53ea\u662f\u4e3e\u4f8b \u3299\ufe0f\uff09</p> <pre><code>sk-myNds72DQ22BVwcwqhfWjkashdouymxSnChJhPpN7OQ4vWi9\n</code></pre> <p></p>"},{"location":"%E8%BE%93%E5%87%BAchatgtp%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9/#_3","title":"\u5bfc\u5165\u5e93","text":"<pre><code>pip install streamlit openai streamlit-pills\n</code></pre> <pre><code>Collecting pyrsistent!=0.17.0,!=0.17.1,!=0.17.2,&gt;=0.14.0\n  Downloading pyrsistent-0.19.3-cp310-cp310-macosx_10_9_universal2.whl (82 kB)\n     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 82.5/82.5 kB 912.5 kB/s eta 0:00:00\nCollecting mdurl~=0.1\n  Using cached mdurl-0.1.2-py3-none-any.whl (10.0 kB)\nBuilding wheels for collected packages: validators\n  Building wheel for validators (setup.py) ... done\n  Created wheel for validators: filename=validators-0.20.0-py3-none-any.whl size=19581 sha256=bcb2dee716ebd8a524893c86c70c006ccf5c7f4ae511f367c6c1fde82dc96e81\n  Stored in directory: /Users/hk/Library/Caches/pip/wheels/2d/55/25/123071088f4e466746cbadc923b1a31e08cea99ea9ef6bb35e\nSuccessfully built validators\nInstalling collected packages: pytz, zipp, urllib3, tzdata, typing-extensions, tqdm, tornado, toolz, toml, tenacity, smmap, six, pyrsistent, pympler, pygments, protobuf, pillow, packaging, numpy, multidict, mdurl, MarkupSafe, idna, frozenlist, decorator, click, charset-normalizer, certifi, cachetools, blinker, attrs, async-timeout, yarl, validators, requests, pytz-deprecation-shim, python-dateutil, pyarrow, markdown-it-py, jsonschema, jinja2, importlib-metadata, gitdb, aiosignal, tzlocal, rich, pydeck, pandas, gitpython, aiohttp, openai, altair, streamlit, streamlit-pills\nSuccessfully installed MarkupSafe-2.1.2 aiohttp-3.8.4 aiosignal-1.3.1 altair-5.0.1 async-timeout-4.0.2 attrs-23.1.0 blinker-1.6.2 cachetools-5.3.1 certifi-2023.5.7 charset-normalizer-3.1.0 click-8.1.3 decorator-5.1.1 frozenlist-1.3.3 gitdb-4.0.10 gitpython-3.1.31 idna-3.4 importlib-metadata-6.6.0 jinja2-3.1.2 jsonschema-4.17.3 markdown-it-py-2.2.0 mdurl-0.1.2 multidict-6.0.4 numpy-1.24.3 openai-0.27.7 packaging-23.1 pandas-2.0.2 pillow-9.5.0 protobuf-4.23.2 pyarrow-12.0.0 pydeck-0.8.1b0 pygments-2.15.1 pympler-1.0.1 pyrsistent-0.19.3 python-dateutil-2.8.2 pytz-2023.3 pytz-deprecation-shim-0.1.0.post0 requests-2.31.0 rich-13.4.1 six-1.16.0 smmap-5.0.0 streamlit-1.23.1 streamlit-pills-0.3.0 tenacity-8.2.2 toml-0.10.2 toolz-0.12.0 tornado-6.3.2 tqdm-4.65.0 typing-extensions-4.6.3 tzdata-2023.3 tzlocal-4.3 urllib3-2.0.2 validators-0.20.0 yarl-1.9.2 zipp-3.15.0\n</code></pre> <p>ChatGtp\u8c03\u7528</p> <p><code>model</code>\uff1a\u5bf9\u5e94\u7684\u6a21\u578b</p> <p><code>prompt</code>\uff1a\u8bf7\u6c42gtp\u7684\u5185\u5bb9</p> <p><code>temperature</code>\uff1a\u63a7\u5236\u751f\u6210\u6587\u672c\u7684\u968f\u673a\u7a0b\u5ea6\u7684\u6307\u6570</p> <p><code>stream</code>\uff1a\u662f\u5426\u6d41\u5f0f\u54cd\u5e94</p> <p><code>max_tokens</code>\uff1agtp\u8fd4\u56de\u7684\u6700\u5927token\u6570\u91cf</p> <pre><code>user_input=\"\u4f60\u597d Chatgtp\"\nopenai.api_key = \"sk-myNds72DQ22BVwcwqhfWjkashdouymxSnChJhPpN7OQ4vWi9\"\nresponse =openai.Completion.create(model='text-davinci-003',\n                                         prompt=user_input,\n                                         max_tokens=4000,\n                                         stream=True,\n                                         temperature=0.5)\n# \u8f93\u51fachatgtp\u8fd4\u56de\u5185\u5bb9\nprint(response.choices[0].text)\n</code></pre>"},{"location":"%E8%BE%93%E5%87%BAchatgtp%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9/#_4","title":"\u5b8c\u6574\u4ee3\u7801","text":"<pre><code>import openai\nimport streamlit as st\n\n# Set the title and body of your Streamlit app\nst.set_page_config(page_title=\"Open AI\", page_icon=\"\ud83e\udd16\")\n\nst.title(\"Open Ai\ud83e\udd2a\")\n\nst.subheader(\"Ask me anything using the OpenAI API! \ud83d\ude04\")\n\n# Use radio buttons to ask if user has an OpenAI API key\nhas_key = st.radio(label=\"Do you have any OpenAI API key?\", options=[\"No\", \"Yes\"])\n\nif has_key == \"Yes\":\n    # Create input box for OpenAI API key\n    openai.api_key = st.text_input(\"Enter your OpenAI API key:\", key=\"openai_key\")\nelse:\n    # Set default OpenAI API key\n    openai.api_key = \"sk-myNds72DQ22BVwcwqhfWjkashdouymxSnChJhPpN7OQ4vWi9\n\"\n\n# Create the input box for user question\nuser_input = st.text_input(\"Enter your question:\", key=\"input\")\n\n# If the user clicks the 'Ask' button, generate and display an answer\nif st.button(\"Ask\", key=\"ask_button\"):\n    st.markdown(\"---\")\n    res_box = st.empty()\n    report = []\n    # Looping over the response\n    for completions in openai.Completion.create(model='text-davinci-003',\n                                         prompt=user_input,\n                                         max_tokens=4000,\n                                         temperature=0.5,\n                                         stream=True):\n        report.append(completions.choices[0].text)\n        res_box.markdown(f'{\"\".join(report).strip()}')\n    st.markdown(\"---\")\n\n# Add some 'about' information and a link to the OpenAI API documentation\nst.subheader(\"About\")\nst.write(\"This application uses the OpenAI API to generate answers to user questions.\")\nst.write(\"For more information, see the [OpenAI API documentation](https://beta.openai.com/docs/api-reference).\")\n\n# Add some footer information for your application\nst.markdown(\"---\")\nst.write(\"Created by  tz\", \"https://chrisjxp.github.io/docx/\")\n\n</code></pre>"}]}